<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContaPrazo Calculadora</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%233b82f6;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2316a34a;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='15' fill='url(%23grad)'/%3E%3Ctext x='50' y='70' font-family='system-ui, sans-serif' font-size='50' font-weight='800' fill='white' text-anchor='middle'%3ECP%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Gradientes principais */
            --gradient-primary: linear-gradient(135deg, #3b82f6, #16a34a);
            --gradient-blue: linear-gradient(135deg, #3b82f6, #2563eb);
            --gradient-green: linear-gradient(135deg, #16a34a, #15803d);
            --gradient-header: linear-gradient(135deg, #f0f9ff 0%, #ecfdf5 100%);
            --gradient-border: linear-gradient(90deg, #3b82f6, #16a34a);

            /* Cores principais */
            --color-blue-500: #3b82f6;
            --color-blue-600: #2563eb;
            --color-green-600: #16a34a;
            --color-green-700: #15803d;

            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 10px 25px rgba(0, 0, 0, 0.3);

            /* Border radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;

            /* Transitions */
            --transition-fast: all 0.2s;
            --transition-normal: all 0.3s;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f9fafb;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            background: var(--gradient-header);
            border-bottom: 3px solid;
            border-image: var(--gradient-border) 1;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }

        .page-header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-header .brand-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
            margin: 0;
            padding: 0;
            line-height: 1;
            display: inline-flex;
            align-items: center;
            transform: translateY(4px);
        }

        .brand-separator {
            color: #d1d5db;
            margin: 0;
            padding: 0;
            font-weight: 300;
            line-height: 1;
            display: inline-flex;
            align-items: center;
        }

        .nav-tabs {
            max-width: 1200px;
            margin: 0 auto 30px;
            display: flex;
            gap: 8px;
            background: #f9fafb;
            padding: 6px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            color: #6b7280;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .nav-tab.active {
            background: white;
            color: #1f2937;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title svg {
            color: #3b82f6;
        }

        .section-divider {
            height: 2px;
            background: linear-gradient(to right, #3b82f6, transparent);
            margin-bottom: 20px;
        }

        .logo-cp {
            width: 56px;
            height: 56px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .brand-title {
            font-size: 2.25rem;
            color: #1f2937;
            font-weight: 800;
            letter-spacing: -0.5px;
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 0 !important;
            padding: 0 !important;
            line-height: 1;
            height: fit-content;
        }

        .brand-conta {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-flex;
            align-items: center;
            line-height: 1;
            margin: 0;
            padding: 0;
        }

        .brand-prazo {
            background: linear-gradient(135deg, #16a34a, #15803d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-flex;
            align-items: center;
            line-height: 1;
            margin: 0;
            padding: 0;
        }

        .brand-name {
            display: flex;
            align-items: center;
            gap: 0;
            line-height: 1;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Reduzir minmax do form-grid em telas pequenas */
        @media (max-width: 640px) {
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group-with-toggle {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dias-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .dias-input-container {
            flex: 1;
        }

        .data-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .data-input-wrapper input[type="date"] {
            flex: 1;
        }

        .btn-data-hoje {
            padding: 12px 16px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(59, 130, 246, 0.2);
            transition: all 0.2s;
            white-space: nowrap;
            cursor: pointer;
            flex-shrink: 0;
        }

        .btn-data-hoje:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
        }

        .btn-data-hoje:active {
            transform: translateY(0);
        }

        label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        input[type="date"],
        input[type="number"],
        textarea {
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Toggle Switch Moderno */
        .toggle-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-top: 8px;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 56px;
            height: 28px;
            background: #d1d5db;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.3s;
            flex-shrink: 0;
        }

        .toggle-switch.active {
            background: #16a34a;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 12px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(28px);
        }

        .toggle-label {
            font-size: 0.875rem;
            color: #374151;
            font-weight: 500;
        }

        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            flex: 1 1 auto;
            min-width: fit-content;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(107, 114, 128, 0.3);
        }

        .btn-success {
            background: #16a34a;
            color: white;
        }

        .btn-success:hover {
            background: #15803d;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(22, 163, 74, 0.3);
        }

        .btn-purple {
            background: #9333ea;
            color: white;
        }

        .btn-purple:hover {
            background: #7e22ce;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(147, 51, 234, 0.3);
        }

        .btn-red {
            background: #dc2626;
            color: white;
        }

        .btn-red:hover {
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
        }

        .btn-indigo {
            background: #6366f1;
            color: white;
        }

        .btn-indigo:hover {
            background: #4f46e5;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
        }

        .btn-quick {
            flex: 1;
            background: #f3f4f6;
            color: #374151;
            padding: 8px 12px;
        }

        .btn-quick:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-group .btn {
            flex: 1 1 calc(33.333% - 10px);
            min-width: 200px;
            white-space: normal;
            text-align: center;
            line-height: 1.3;
        }

        .btn svg {
            flex-shrink: 0;
            min-width: 18px;
            min-height: 18px;
        }

        /* Breakpoint inteligente: quando o espaço ficar apertado */
        @media (max-width: 900px) {
            .btn-group .btn {
                font-size: 0.85rem;
                min-width: 180px;
                padding: 10px 16px;
            }
        }

        @media (max-width: 768px) {
            .btn-group .btn {
                flex: 1 1 calc(50% - 10px);
                min-width: 160px;
            }
        }

        @media (max-width: 640px) {
            .btn-group .btn {
                flex: 1 1 100%;
                font-size: 0.95rem;
                white-space: nowrap;
            }
        }

        .resultado {
            background: linear-gradient(to right, #f0fdf4, #dbeafe);
            border: 2px solid #86efac;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .resultado h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .resultado-info {
            margin: 8px 0;
            font-size: 1rem;
        }

        .resultado-info strong {
            color: #374151;
        }

        .resultado-descricao {
            background: white;
            border-left: 4px solid #3b82f6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            font-style: italic;
            color: #1f2937;
            font-size: 0.95rem;
        }

        .resultado-descricao strong {
            font-style: normal;
            color: #3b82f6;
        }

        .data-final {
            color: #15803d;
            font-size: 1.25rem;
            font-weight: bold;
        }

        .detalhamento {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        /* Estilos de scrollbar para .detalhamento (Chromium/WebKit) */
        .detalhamento::-webkit-scrollbar {
            width: 8px;
        }

        .detalhamento::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 8px;
        }

        .detalhamento::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 8px;
            border: 2px solid white;
        }

        .detalhamento::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Estilos de scrollbar para Firefox */
        .detalhamento {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 transparent;
        }

        .detalhamento h3 {
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 1rem;
        }

        .dia-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            margin: 3px 0;
            border-radius: 6px;
            border-left: 4px solid;
            font-size: 0.9rem;
        }

        .dia-contado {
            background: #dcfce7;
            border-color: #22c55e;
        }

        .dia-nao-contado {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .dia-numero {
            font-weight: bold;
            min-width: 30px;
        }

        .dia-contado .dia-numero {
            color: #166534;
        }

        .dia-nao-contado .dia-numero {
            color: #991b1b;
        }

        /* Removido margin-top para alinhar com o formulário no layout de duas colunas */
        @media (max-width: 1024px) {
            .calendario {
                margin-top: 0;
            }
        }

        .calendario-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid;
            border-image: linear-gradient(90deg, #e5e7eb, #d1d5db, #e5e7eb) 1;
        }

        .calendario-nav-row {
            display: grid;
            grid-template-columns: 32px 1fr 32px;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .calendario-actions-row {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .calendario-header h2 {
            font-size: 1.5rem;
            color: #1f2937;
            margin: 0;
            text-align: center;
        }

        .btn-nav {
            width: 32px !important;
            height: 32px !important;
            min-width: 32px !important;
            padding: 0 !important;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            border-radius: 6px !important;
            background: #f3f4f6 !important;
            border: 1px solid #d1d5db !important;
            color: #374151 !important;
            transition: all 0.2s;
        }

        .btn-nav:hover {
            border-color: #3b82f6 !important;
            background: #dbeafe !important;
            color: #1e40af !important;
            transform: translateY(-1px);
        }

        .btn-nav svg {
            stroke: currentColor;
        }

        .btn-hoje {
            padding: 8px 14px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(59, 130, 246, 0.2);
            transition: all 0.2s;
            flex: 0 0 auto;
            white-space: nowrap;
            cursor: pointer;
        }

        .btn-hoje:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
        }

        .visualizacao-toggle {
            display: flex;
            gap: 5px;
            background: #f3f4f6;
            padding: 4px;
            border-radius: 8px;
        }

        .visualizacao-toggle button {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            color: #6b7280;
        }

        .visualizacao-toggle button.active {
            background: white;
            color: #1f2937;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .calendario-anual {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 900px) {
            .calendario-anual {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .calendario-anual {
                grid-template-columns: 1fr;
            }
        }

        .mes-mini {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
        }

        .mes-mini h4 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .calendario-mini-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .calendario-mini-dia-semana {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: #6b7280;
            padding: 4px 2px;
        }

        .calendario-mini-dia {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendario-mini-dia:hover:not(.fim-semana) {
            background: #f3f4f6;
        }

        .config-feriados {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0;
            margin-top: 20px;
            overflow: hidden;
        }

        .config-feriados-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            user-select: none;
            background: #f9fafb;
            transition: background 0.2s;
        }

        .config-feriados-header:hover {
            background: #f3f4f6;
        }

        .config-feriados-header h3 {
            margin: 0;
            color: #1f2937;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-feriados-toggle {
            font-size: 1.2rem;
            color: #6b7280;
            transition: transform 0.3s;
        }

        .config-feriados-toggle.aberto {
            transform: rotate(180deg);
        }

        .config-feriados-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .config-feriados-content.aberto {
            max-height: 1000px;
        }

        .config-feriados-body {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .config-secao {
            margin-bottom: 20px;
        }

        .config-secao h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .config-divisor {
            height: 1px;
            background: #e5e7eb;
            margin: 20px 0;
        }

        .toggle-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-ativo {
            background: #16a34a;
            color: white;
        }

        .toggle-inativo {
            background: #d1d5db;
            color: #4b5563;
        }

        .calendario-multi-meses {
            display: grid;
            gap: 20px;
            grid-template-columns: 1fr;
        }

        /* Layout responsivo para múltiplos meses */
        @media (min-width: 600px) and (max-width: 1023px) {
            .calendario-multi-meses.meses-2 {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .calendario-multi-meses.meses-3 {
                grid-template-columns: repeat(3, 1fr);
                gap: 12px;
            }

            /* Ajustes para calendários menores em multi-mês */
            .calendario-multi-meses .calendario-grid {
                gap: 3px;
            }

            .calendario-multi-meses .calendario-dia-semana {
                padding: 6px 2px;
                font-size: 0.65rem;
            }

            .calendario-multi-meses .calendario-dia {
                min-height: 32px;
                font-size: 0.75rem;
            }

            .mes-container h4 {
                font-size: 0.8rem;
                margin-bottom: 8px;
            }
        }

        .mes-container {
            display: flex;
            flex-direction: column;
        }

        .mes-container h4 {
            font-size: 0.9rem;
            color: #1f2937;
            margin: 0 0 10px 0;
            text-align: center;
            font-weight: 600;
        }

        .calendario-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendario-dia-semana {
            text-align: center;
            font-weight: bold;
            color: #4b5563;
            padding: 10px;
        }

        .calendario-dia {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            min-height: 40px;
        }

        .calendario-dia:hover:not(.fim-semana) {
            background: #f3f4f6;
            transform: scale(1.05);
        }

        .fim-semana {
            background: #e5e7eb;
            color: #6b7280;
            cursor: default;
        }

        .feriado {
            background: #fecaca;
            color: #991b1b;
            font-weight: 600;
        }

        .feriado-personalizado {
            background: #e9d5ff;
            color: #6b21a8;
            font-weight: 600;
        }

        .feriado-em-fds {
            /* Mantém o fundo cinza do fim-semana, mas texto vermelho negrito como feriado */
            color: #991b1b !important;
            font-weight: 700 !important;
        }

        .dia-inicio {
            background: #3b82f6;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 0 2px #2563eb;
        }

        .dia-final {
            background: #16a34a;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 0 2px #15803d;
        }

        .dia-percorrido {
            background: #fef3c7;
        }

        .legenda {
            background: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .legenda h3 {
            margin-bottom: 15px;
            color: #1f2937;
        }

        .legenda-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .legenda-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.875rem;
        }

        .legenda-cor {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
        }

        .rodape {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .rodape a {
            color: #6b7280;
            text-decoration: underline;
            font-size: 0.875rem;
        }

        .rodape a:hover {
            color: #374151;
        }

        /* Modal para importar feriados */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
        }

        .modal-body {
            margin-bottom: 20px;
            color: #374151;
            line-height: 1.6;
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .modal-option {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }

        .modal-option-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .modal-option-desc {
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* Estilos para itens do dropdown de conjuntos pré-definidos */
        .item-predefinido {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
            background: white;
        }

        .item-predefinido:hover {
            border-color: var(--primary-color);
            background: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .item-predefinido-nome {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 6px;
            font-size: 0.95rem;
        }

        .item-predefinido-desc {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .item-predefinido-data {
            font-size: 0.8rem;
            color: #9ca3af;
            font-style: italic;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Sistema de Perfis de Feriados Personalizados */
        .perfis-bar {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0 14px 0;
            margin-bottom: 14px;
            border-bottom: 1px solid #e5e7eb;
        }

        .perfis-bar-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .perfis-bar-label {
            font-size: 0.75rem;
            color: #64748b;
            font-weight: 500;
        }

        .perfil-dropdown {
            position: relative;
        }

        .perfil-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 5px 12px;
            background: #e2e8f0;
            border: 1px solid #cbd5e1;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s;
            max-width: 150px;
        }

        .perfil-pill:hover {
            background: #cbd5e1;
        }

        .perfil-pill.active {
            background: #dbeafe;
            border-color: #93c5fd;
            color: #1e40af;
        }

        .perfil-pill.unsaved {
            background: #fef3c7;
            border-color: #fcd34d;
            color: #92400e;
        }

        .perfil-pill-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 100px;
        }

        .perfil-pill-arrow {
            flex-shrink: 0;
            transition: transform 0.2s;
        }

        .perfil-pill-arrow.open {
            transform: rotate(180deg);
        }

        .perfil-dropdown-menu {
            position: absolute;
            top: 100%;
            left: 0;
            margin-top: 4px;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 180px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            display: none;
        }

        .perfil-dropdown-menu.show {
            display: block;
        }

        .perfil-dropdown-item {
            padding: 8px 12px;
            font-size: 0.8rem;
            color: #374151;
            cursor: pointer;
            transition: background 0.15s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .perfil-dropdown-item:hover {
            background: #f1f5f9;
        }

        .perfil-dropdown-item.selected {
            background: #dbeafe;
            color: #1e40af;
        }

        .perfil-dropdown-item.none {
            color: #64748b;
            font-style: italic;
        }

        .perfis-bar-right {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .perfil-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 28px;
            height: 28px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s;
        }

        .perfil-btn:hover {
            background: #f1f5f9;
            color: #374151;
            border-color: #cbd5e1;
        }

        .perfil-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .perfil-btn svg {
            width: 14px;
            height: 14px;
        }

        .perfil-btn-save {
            background: #dcfce7;
            border-color: #86efac;
            color: #166534;
            padding: 4px 10px;
            width: auto;
            font-size: 0.7rem;
            font-weight: 600;
            gap: 4px;
        }

        .perfil-btn-save:hover {
            background: #bbf7d0;
        }

        .perfil-unsaved-indicator {
            display: none;
            font-size: 0.7rem;
            color: #d97706;
            font-weight: 500;
        }

        .perfil-unsaved-indicator.show {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        /* Modal de Gerenciar Perfis */
        .modal-perfis-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }

        .modal-perfil-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .modal-perfil-item:last-child {
            border-bottom: none;
        }

        .modal-perfil-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .modal-perfil-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 0.9rem;
        }

        .modal-perfil-count {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .modal-perfil-actions {
            display: flex;
            gap: 8px;
        }

        .modal-perfil-btn {
            padding: 4px 8px;
            border: 1px solid #e5e7eb;
            border-radius: 4px;
            background: white;
            color: #6b7280;
            cursor: pointer;
            font-size: 0.75rem;
            transition: all 0.2s;
        }

        .modal-perfil-btn:hover {
            background: #f3f4f6;
        }

        .modal-perfil-btn.delete {
            color: #dc2626;
            border-color: #fecaca;
        }

        .modal-perfil-btn.delete:hover {
            background: #fef2f2;
        }

        .modal-perfis-empty {
            padding: 30px;
            text-align: center;
            color: #6b7280;
            font-size: 0.9rem;
        }

        .modal-input-small {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .modal-input-small:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        /* Modal de Aviso de Recálculo */
        .modal-aviso {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-aviso.active {
            display: flex;
            animation: fadeIn 0.2s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-aviso-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-aviso-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .modal-aviso-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
        }

        .modal-aviso-content p {
            color: #374151;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-aviso-checkbox {
            margin: 20px 0;
            text-align: left;
        }

        .modal-aviso-checkbox label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #4b5563;
            cursor: pointer;
        }

        .modal-aviso-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Página de Ajuda */
        .help-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .help-section h3 {
            color: #1f2937;
            font-size: 1.25rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-section p {
            color: #4b5563;
            line-height: 1.8;
            margin-bottom: 12px;
        }

        .help-section ul {
            margin-left: 20px;
            color: #4b5563;
            line-height: 1.8;
        }

        .help-section li {
            margin-bottom: 8px;
        }

        .help-section code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            color: #3b82f6;
        }

        /* Gerenciamento Avançado */
        .batch-editor {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .batch-editor h3 {
            color: #1f2937;
            font-size: 1.25rem;
            margin-bottom: 15px;
        }

        .batch-editor textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            resize: vertical;
        }

        .batch-editor textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .info-box {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .info-box p {
            margin: 0;
            color: #991b1b;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .warning-box p {
            margin: 0;
            color: #92400e;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .feriados-list {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .feriado-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }

        .feriado-item.fixo,
        .feriado-item.movel {
            border-left-color: #fecaca;
        }

        .feriado-item.personalizado {
            border-left-color: #e9d5ff;
        }

        /* Botão scroll to top */
        .scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .scroll-to-top:hover {
            background: rgba(37, 99, 235, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .scroll-to-top.visible {
            display: flex;
        }

        .scroll-to-top svg {
            width: 20px;
            height: 20px;
        }

        /* Responsividade mobile - densidade aumentada para evitar scroll horizontal */
        @media (max-width: 640px) {
            body {
                padding: 8px;
            }

            .container {
                max-width: 100%;
            }

            .page-header {
                padding: 12px;
                margin-bottom: 12px;
            }

            .page-header-content {
                gap: 8px;
            }

            .logo-cp {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }

            .nav-tabs {
                gap: 3px;
                padding: 3px;
                margin-bottom: 12px;
            }

            .nav-tab {
                padding: 8px 10px;
                font-size: 0.8rem;
                gap: 5px;
            }

            /* Proteger ícones SVG do menu de encolher demais */
            .nav-tab svg {
                flex-shrink: 0;
                min-width: 16px;
                min-height: 16px;
            }

            /* Reduzir fonte do cabeçalho para evitar quebra */
            .brand-title {
                font-size: 1.4rem;
            }

            .page-header .brand-subtitle {
                font-size: 0.7rem;
            }

            .card {
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 10px;
            }

            .resultado {
                padding: 15px;
                margin-bottom: 15px;
            }

            .resultado h2 {
                font-size: 1.15rem;
            }

            .resultado-info {
                font-size: 0.95rem;
            }

            .detalhamento h3 {
                font-size: 1rem;
            }

            .dia-item {
                padding: 8px;
                font-size: 0.85rem;
            }

            .calendario-header {
                margin-bottom: 12px;
                padding-bottom: 12px;
            }

            .calendario-header h2 {
                font-size: 1.15rem;
                min-width: 140px;
            }

            .calendario-actions-row {
                gap: 5px;
            }

            .btn-hoje {
                padding: 5px 8px;
                font-size: 0.75rem;
            }

            .visualizacao-toggle button {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            .calendario-grid {
                gap: 3px;
            }

            .calendario-dia {
                min-height: 35px;
                font-size: 0.8rem;
            }

            .calendario-dia-semana {
                padding: 6px;
                font-size: 0.7rem;
            }

            /* Reduzir espaçamento da legenda */
            .legenda {
                padding: 12px;
                margin-top: 12px;
            }

            .legenda h3 {
                font-size: 0.95rem;
                margin-bottom: 10px;
            }

            .legenda-grid {
                gap: 8px;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .legenda-item {
                font-size: 0.75rem;
            }

            /* Ajustar densidade nas abas de Feriados e Ajuda também */
            .info-box {
                padding: 12px;
                font-size: 0.85rem;
            }

            .feriado-item {
                padding: 10px;
                font-size: 0.85rem;
            }

            /* Ajustar inputs e labels */
            label {
                font-size: 0.85rem;
                margin-bottom: 6px;
            }

            input, select, textarea {
                font-size: 0.9rem;
                padding: 10px;
            }

            .btn-data-hoje {
                padding: 10px 12px;
                font-size: 0.8rem;
            }

            /* Reduzir tamanho dos parágrafos nas abas de editor e ajuda */
            .batch-editor p,
            .help-section p {
                font-size: 0.85rem;
            }

            .batch-editor h5 {
                font-size: 0.95rem;
            }

            .help-section h3 {
                font-size: 1.1rem;
            }

            .help-section h4 {
                font-size: 1rem;
            }

            /* Adicionar ajustes para listas e outros elementos da ajuda */
            .help-section ul,
            .help-section ol {
                font-size: 0.85rem;
            }

            .help-section li {
                font-size: inherit;
                margin-bottom: 6px;
            }

            .help-section code {
                font-size: 0.85em;
            }

            .help-section strong {
                font-size: inherit;
            }
        }

        /* Telas muito pequenas - ajustes adicionais com zoom out mais agressivo */
        @media (max-width: 480px) {
            body {
                padding: 6px;
            }

            .page-header {
                padding: 10px;
            }

            .logo-cp {
                width: 38px;
                height: 38px;
                font-size: 16px;
            }

            /* Cabeçalho ainda menor para telas muito pequenas */
            .brand-title {
                font-size: 1.2rem;
            }

            .page-header .brand-subtitle {
                font-size: 0.65rem;
            }

            .brand-separator {
                font-size: 0.9rem;
            }

            .card {
                padding: 12px;
            }

            .resultado {
                padding: 12px;
            }

            .btn-group {
                gap: 6px;
            }

            .form-group {
                margin-bottom: 12px;
            }

            label {
                font-size: 0.8rem;
            }

            input, select, textarea {
                font-size: 0.85rem;
                padding: 8px;
            }

            .calendario-nav-row {
                gap: 8px;
            }

            .calendario-header h2 {
                font-size: 1rem;
            }

            .legenda-item {
                font-size: 0.7rem;
            }

            .calendario-grid {
                gap: 2px;
            }

            .calendario-dia {
                min-height: 32px;
                font-size: 0.75rem;
            }

            /* Proteger ícones SVG em todos os botões */
            .btn svg, .nav-tab svg {
                flex-shrink: 0;
                min-width: 14px;
                min-height: 14px;
            }

            /* Ajustar botões para não quebrarem */
            .btn {
                font-size: 0.85rem;
                padding: 10px 14px;
            }

            .nav-tab {
                font-size: 0.75rem;
            }

            /* Ajustes completos para aba de Ajuda em telas muito pequenas */
            .help-section {
                padding: 15px;
            }

            .help-section h3 {
                font-size: 1rem !important;
            }

            .help-section h4 {
                font-size: 0.9rem !important;
            }

            .help-section p,
            .help-section ul,
            .help-section ol {
                font-size: 0.8rem !important;
            }

            .help-section li {
                font-size: inherit;
                margin-bottom: 6px;
            }

            .help-section code {
                font-size: 0.8em;
                padding: 1px 4px;
            }

            /* Sobrescrever estilos inline específicos em telas pequenas */
            .help-section h4[style*="font-size"],
            .help-section p[style*="font-size"]:not([style*="background"]),
            .help-section div[style*="font-size"],
            .help-section ol[style*="font-size"],
            .help-section ul[style*="font-size"] {
                font-size: 0.8rem !important;
            }

            /* h4 sem font-size mas com outros estilos inline */
            .help-section h4[style]:not([style*="font-size"]) {
                font-size: 0.8rem !important;
            }

            /* Ajustar boxes destacados (divs e parágrafos com backgrounds coloridos) */
            .help-section div[style*="background"],
            .help-section p[style*="background"] {
                padding: 10px !important;
                font-size: 0.75rem !important;
                line-height: 1.6 !important;
            }

            /* Ajustar elementos filhos dentro dos boxes com background */
            .help-section div[style*="background"] h4,
            .help-section div[style*="background"] h5,
            .help-section div[style*="background"] p,
            .help-section div[style*="background"] ul,
            .help-section div[style*="background"] ol {
                font-size: 0.75rem !important;
            }

            /* Ajustar strong dentro dos boxes */
            .help-section p[style*="background"] strong,
            .help-section div[style*="background"] strong {
                font-size: inherit;
            }

            /* Ajustar blocos de código */
            .help-section pre[style],
            .help-section code[style] {
                font-size: 0.75rem !important;
                padding: 10px !important;
            }

            .batch-editor {
                padding: 15px;
            }

            .batch-editor h3 {
                font-size: 1rem;
            }

            .batch-editor h4 {
                font-size: 0.9rem;
            }

            .batch-editor p {
                font-size: 0.8rem;
            }
        }

        @media print {
            body {
                padding: 0;
            }
            .card {
                box-shadow: none;
            }
            .btn, .calendario, .legenda, .rodape, .nav-tabs, .page-header {
                display: none !important;
            }
        }

        /* ==================== BANNER DE ATUALIZAÇÃO DE FERIADOS (ESTILO iOS) ==================== */
        .update-banner {
            display: none;
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-120%);
            width: 90%;
            max-width: 600px;
            z-index: 10000;
            background: linear-gradient(135deg, #eff6ff 0%, #f0fdf4 100%);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 18px 24px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15),
                        0 4px 12px rgba(59, 130, 246, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1),
                        opacity 0.4s ease-out;
            opacity: 0;
        }

        .update-banner.active {
            display: block;
            animation: slideDownBounce 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }

        .update-banner.hiding {
            animation: slideUpFade 0.4s cubic-bezier(0.4, 0, 0.6, 1) forwards;
        }

        @keyframes slideDownBounce {
            0% {
                opacity: 0;
                transform: translateX(-50%) translateY(-120%);
            }
            100% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        @keyframes slideUpFade {
            0% {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-50%) translateY(-120%);
            }
        }

        .update-banner-content {
            display: flex;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .update-banner-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .update-banner-text {
            flex: 1;
            min-width: 250px;
        }

        .update-banner-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .update-banner-description {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.4;
        }

        .update-banner-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .update-banner-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .update-banner-btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
        }

        .update-banner-btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.4);
        }

        .update-banner-btn-secondary {
            background: white;
            color: #6b7280;
            border: 1px solid #e5e7eb;
        }

        .update-banner-btn-secondary:hover {
            background: #f9fafb;
            color: #1f2937;
        }

        .update-banner-btn-close {
            background: transparent;
            color: #9ca3af;
            padding: 4px 8px;
            font-size: 1.2rem;
            line-height: 1;
        }

        .update-banner-btn-close:hover {
            color: #6b7280;
            background: rgba(0, 0, 0, 0.05);
        }

        @media (max-width: 768px) {
            .update-banner {
                top: 10px;
                width: 95%;
                max-width: calc(100% - 20px);
                padding: 16px 20px;
                border-radius: 12px;
            }

            .update-banner-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .update-banner-icon {
                font-size: 1.25rem;
            }

            .update-banner-title {
                font-size: 0.95rem;
            }

            .update-banner-description {
                font-size: 0.8rem;
            }

            .update-banner-actions {
                width: 100%;
            }

            .update-banner-btn {
                flex: 1;
                text-align: center;
                font-size: 0.8rem;
                padding: 8px 12px;
            }
        }

        /* ==================== MINHA AGENDA - ESTILOS ==================== */

        /* Separador elegante para botão Salvar na Agenda */
        .resultado-separador {
            margin: 30px 0 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .resultado-separador::before,
        .resultado-separador::after {
            content: '';
            flex: 1;
            height: 1px;
            background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
        }

        .resultado-separador-texto {
            font-size: 0.875rem;
            color: #9ca3af;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* Botão Salvar na Agenda */
        .btn-salvar-agenda {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.3);
            width: 100%;
        }

        .btn-salvar-agenda:hover {
            background: linear-gradient(135deg, #ea580c, #c2410c);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(249, 115, 22, 0.4);
        }

        .btn-salvar-agenda:active {
            transform: translateY(0);
        }

        .btn-salvar-agenda svg {
            flex-shrink: 0;
        }

        /* Filtros da Agenda */
        .agenda-filtros {
            display: flex;
            gap: 10px;
            background: #f9fafb;
            padding: 8px;
            border-radius: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .filtro-btn {
            flex: 1;
            min-width: 120px;
            padding: 10px 16px;
            border: 2px solid transparent;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem;
            color: #6b7280;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .filtro-btn:hover {
            border-color: #3b82f6;
            color: #3b82f6;
            background: #f0f9ff;
        }

        .filtro-btn.active {
            border-color: #3b82f6;
            background: #3b82f6;
            color: white;
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
        }

        .filtro-badge {
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .filtro-btn.active .filtro-badge {
            background: rgba(255, 255, 255, 0.25);
        }

        /* Barra de Seleção Múltipla */
        .barra-selecao {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            padding: 12px 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .barra-selecao-info {
            color: white;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .barra-selecao-acoes {
            display: flex;
            gap: 8px;
            align-items: center;
            position: relative;
        }

        .barra-selecao-divider {
            width: 1px;
            height: 24px;
            background: rgba(255, 255, 255, 0.3);
            margin: 0 4px;
        }

        .btn-selecao {
            padding: 6px 12px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.15);
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-selecao:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .btn-selecao-cancelar {
            background: rgba(239, 68, 68, 0.2);
            border-color: rgba(239, 68, 68, 0.4);
        }

        .btn-selecao-cancelar:hover {
            background: rgba(239, 68, 68, 0.3);
            border-color: rgba(239, 68, 68, 0.6);
        }

        .menu-acoes-selecao {
            position: absolute;
            top: 100%;
            right: 60px;
            margin-top: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            border: 1px solid #e5e7eb;
            min-width: 220px;
            overflow: hidden;
            z-index: 1000;
        }

        .menu-acoes-selecao button {
            width: 100%;
            padding: 12px 16px;
            border: none;
            background: white;
            color: #1f2937;
            text-align: left;
            cursor: pointer;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: background 0.2s;
        }

        .menu-acoes-selecao button:hover {
            background: #f3f4f6;
        }

        .menu-acoes-selecao button svg {
            width: 18px;
            height: 18px;
            stroke-width: 2;
        }

        /* Checkbox de Seleção no Card */
        .checkbox-selecao {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
        }

        .checkbox-selecao:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .checkbox-selecao.selecionado {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .checkbox-selecao.selecionado::after {
            content: '✓';
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .prazo-item.modo-selecao {
            grid-template-columns: 20px 32px 1fr auto;
        }

        /* Lista de Prazos Linear */
        .agenda-lista {
            display: flex;
            flex-direction: column;
            gap: 0;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            overflow: hidden;
        }

        .prazo-item {
            background: white;
            border-bottom: 1px solid #e5e7eb;
            padding: 16px 20px;
            transition: all 0.2s;
            display: grid;
            grid-template-columns: 32px 1fr auto;
            gap: 16px;
            align-items: center;
            cursor: default;
        }

        .prazo-item:last-child {
            border-bottom: none;
        }

        /* Coloração de fundo conforme status */
        .prazo-item-atrasado {
            background: #fef2f2;
            border-left: 3px solid #dc2626;
        }

        .prazo-item-vencendo {
            background: #fffbeb;
            border-left: 3px solid #ea580c;
        }

        /* Vence HOJE - mais urgente que vencendo */
        .prazo-item-vence-hoje {
            background: #fed7aa;
            border-left: 3px solid #f97316;
        }

        .prazo-item-concluido {
            background: #f0fdf4;
            border-left: 3px solid #16a34a;
        }

        .prazo-item:hover:not(.prazo-item-atrasado):not(.prazo-item-vencendo):not(.prazo-item-vence-hoje):not(.prazo-item-concluido) {
            background: #f9fafb;
        }

        .prazo-item-atrasado:hover {
            background: #fee2e2;
        }

        .prazo-item-vencendo:hover {
            background: #fef3c7;
        }

        .prazo-item-vence-hoje:hover {
            background: #fdba74;
        }

        .prazo-item-concluido:hover {
            background: #dcfce7;
        }

        .prazo-item:hover .prazo-acoes {
            opacity: 1;
            visibility: visible;
        }

        .prazo-item.concluido {
            opacity: 0.65;
            background: #fafafa;
        }

        .prazo-item.concluido:hover {
            opacity: 0.8;
            background: #f5f5f5;
        }

        /* Checkbox customizado */
        .prazo-checkbox-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .prazo-checkbox {
            width: 22px;
            height: 22px;
            border: 2px solid #d1d5db;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: white;
        }

        .prazo-checkbox:hover {
            border-color: #16a34a;
            background: #f0fdf4;
        }

        .prazo-checkbox.checked {
            background: #16a34a;
            border-color: #16a34a;
        }

        .prazo-checkbox.checked svg {
            display: block;
        }

        .prazo-checkbox svg {
            display: none;
            width: 14px;
            height: 14px;
            stroke: white;
            stroke-width: 3;
        }

        /* Conteúdo do prazo */
        .prazo-conteudo {
            display: flex;
            flex-direction: column;
            gap: 6px;
            min-width: 0;
        }

        .prazo-header {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .prazo-titulo {
            font-size: 1.05rem;
            font-weight: 700;
            color: #111827;
            margin: 0;
            word-break: break-word;
            flex: 1;
        }

        .prazo-item.concluido .prazo-titulo {
            text-decoration: line-through;
            color: #9ca3af;
        }

        .prazo-descricao {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.4;
            margin: 2px 0 0 0;
            word-break: break-word;
        }

        .prazo-item.concluido .prazo-descricao {
            color: #9ca3af;
        }

        /* Data Final - Destaque Principal */
        .prazo-data-final-destaque {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 8px;
            padding: 8px 12px;
            background: linear-gradient(135deg, #f0f9ff 0%, #f0fdf4 100%);
            border-left: 3px solid #3b82f6;
            border-radius: 4px;
        }

        .prazo-data-final-destaque svg {
            width: 18px;
            height: 18px;
            flex-shrink: 0;
            stroke: #3b82f6;
        }

        .prazo-data-final-texto {
            font-size: 0.95rem;
            color: #374151;
        }

        .prazo-data-final-texto strong {
            font-weight: 700;
            color: #1f2937;
            font-size: 1rem;
        }

        /* Badges de Status - Discreto */
        .prazo-badge {
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            white-space: nowrap;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge-atrasado {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-vencendo {
            background: #fed7aa;
            color: #9a3412;
        }

        .badge-pendente {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-concluido {
            background: #d1fae5;
            color: #065f46;
        }

        /* Informações secundárias */
        .prazo-info-secundaria {
            display: flex;
            flex-wrap: wrap;
            gap: 0;
            font-size: 0.8rem;
            color: #9ca3af;
            margin-top: 4px;
            align-items: center;
        }

        .prazo-info-secundaria-item {
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .prazo-info-secundaria-separador {
            color: #d1d5db;
            margin: 0 8px;
            user-select: none;
        }

        /* Contador Regressivo - Discreto mas Claro */
        .prazo-contador {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: center;
            gap: 2px;
            padding: 8px 12px;
            background: #f9fafb;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            min-width: 140px;
        }

        .contador-numero {
            font-size: 1.25rem;
            font-weight: 700;
            color: #374151;
            line-height: 1;
        }

        .contador-label {
            font-size: 0.7rem;
            color: #6b7280;
            font-weight: 500;
            text-align: right;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .prazo-item.concluido .prazo-contador {
            background: transparent;
            border-color: transparent;
        }

        .prazo-item.concluido .contador-numero,
        .prazo-item.concluido .contador-label {
            color: #9ca3af;
        }

        /* Atrasado - vermelho */
        .contador-atrasado .contador-numero {
            color: #dc2626;
        }

        /* Vencendo - laranja */
        .contador-vencendo .contador-numero {
            color: #ea580c;
        }

        /* Pendente - azul */
        .contador-pendente .contador-numero {
            color: #3b82f6;
        }

        /* Contador Inline (sem caixa, apenas texto destacado) */
        .prazo-contador-inline {
            display: inline-block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-left: 4px;
        }

        .prazo-contador-inline.atrasado {
            color: #dc2626;
        }

        .prazo-contador-inline.vence-hoje {
            color: #ea580c;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .prazo-contador-inline.vencendo {
            color: #ea580c;
        }

        .prazo-contador-inline.pendente {
            color: #3b82f6;
        }

        .prazo-contador-inline.concluido {
            color: #16a34a;
        }

        .prazo-contador-inline strong {
            font-weight: 700;
        }

        /* Botões de ação (menu três pontos) */
        .prazo-acoes {
            position: relative;
            display: flex;
            align-items: center;
        }

        .prazo-menu-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: transparent;
            color: #9ca3af;
        }

        .prazo-menu-btn:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .prazo-menu-btn svg {
            width: 20px;
            height: 20px;
        }

        .prazo-menu-dropdown {
            position: fixed;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            min-width: 160px;
            display: none;
            z-index: 10000;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .prazo-menu-dropdown.active {
            display: block;
            animation: menuSlideIn 0.2s ease-out;
        }

        @keyframes menuSlideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .prazo-menu-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            border: none;
            background: white;
            width: 100%;
            text-align: left;
            font-size: 0.875rem;
            color: #1f2937;
        }

        .prazo-menu-item:hover {
            background: #f9fafb;
        }

        .prazo-menu-item svg {
            width: 16px;
            height: 16px;
            stroke-width: 2;
        }

        .prazo-menu-item.menu-ver {
            color: #3b82f6;
        }

        .prazo-menu-item.menu-ver svg {
            stroke: #3b82f6;
        }

        .prazo-menu-item.menu-editar {
            color: #059669;
        }

        .prazo-menu-item.menu-editar svg {
            stroke: #059669;
        }

        .prazo-menu-item.menu-excluir {
            color: #dc2626;
            border-top: 1px solid #e5e7eb;
        }

        .prazo-menu-item.menu-excluir svg {
            stroke: #dc2626;
        }

        .prazo-btn-acao {
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            background: #f3f4f6;
            color: #6b7280;
        }

        .prazo-btn-acao:hover {
            transform: scale(1.1);
        }

        .prazo-btn-acao svg {
            width: 18px;
            height: 18px;
        }

        .prazo-btn-ver:hover {
            background: #dbeafe;
            color: #1e40af;
        }

        .prazo-btn-editar:hover {
            background: #fef3c7;
            color: #92400e;
        }

        .prazo-btn-excluir:hover {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Estado vazio */
        .agenda-vazia {
            text-align: center;
            padding: 60px 20px;
            color: #9ca3af;
        }

        .agenda-vazia svg {
            width: 64px;
            height: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .agenda-vazia h3 {
            font-size: 1.25rem;
            color: #6b7280;
            margin-bottom: 10px;
        }

        .agenda-vazia p {
            font-size: 0.95rem;
            color: #9ca3af;
        }

        /* Modal de Detalhes */
        .modal-detalhes {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-detalhes.active {
            display: flex;
        }

        .modal-detalhes-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-detalhes-header {
            padding: 12px 16px;
            border-bottom: 2px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            z-index: 10;
            border-radius: 16px 16px 0 0;
            flex-shrink: 0;
        }

        .modal-detalhes-titulo {
            font-size: 1.125rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .modal-detalhes-fechar {
            width: 32px;
            height: 32px;
            border: none;
            background: #f3f4f6;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            color: #6b7280;
        }

        .modal-detalhes-fechar:hover {
            background: #e5e7eb;
            color: #1f2937;
        }

        .modal-detalhes-body {
            padding: 12px 16px;
            overflow-y: auto;
            flex: 1;
        }

        /* Estilos de scrollbar para .modal-detalhes-body (Chromium/WebKit) */
        .modal-detalhes-body::-webkit-scrollbar {
            width: 8px;
        }

        .modal-detalhes-body::-webkit-scrollbar-track {
            background: transparent;
            border-radius: 16px;
        }

        .modal-detalhes-body::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 16px;
            border: 2px solid white;
        }

        .modal-detalhes-body::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Estilos de scrollbar para Firefox */
        .modal-detalhes-body {
            scrollbar-width: thin;
            scrollbar-color: #cbd5e1 transparent;
        }

        .modal-detalhes-acoes {
            padding: 12px 16px;
            border-top: 2px solid #e5e7eb;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            background: white;
            border-radius: 0 0 16px 16px;
            flex-shrink: 0;
        }

        .modal-fechar {
            background: transparent;
            border: none;
            font-size: 2rem;
            color: #9ca3af;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .modal-fechar:hover {
            background: #f3f4f6;
            color: #1f2937;
        }

        .opcao-arquivamento {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .opcao-arquivamento:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .opcao-arquivamento.opcao-perigo:hover {
            border-color: #dc2626;
            background: #fef2f2;
        }

        /* Toast de Undo */
        .toast-undo {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1f2937;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 16px;
            z-index: 3000;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toast-undo.active {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        .toast-undo-texto {
            font-size: 0.95rem;
        }

        .toast-undo-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .toast-undo-btn:hover {
            background: #2563eb;
        }

        /* Paginação da Agenda */
        .agenda-paginacao {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .paginacao-info {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .paginacao-info strong {
            color: #1f2937;
            font-weight: 600;
        }

        .paginacao-controles {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .paginacao-btn {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .paginacao-btn:hover:not(:disabled) {
            background: #f9fafb;
            border-color: #3b82f6;
            color: #3b82f6;
        }

        .paginacao-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .paginacao-numero {
            padding: 6px 12px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            min-width: 40px;
            text-align: center;
        }

        .paginacao-numero.ativa {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        /* Botões de Gerenciamento da Agenda */
        .agenda-acoes-gerenciamento {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        /* Modal de Input de Título */
        .modal-input-titulo {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-input-titulo.active {
            display: flex;
        }

        .modal-input-content {
            background: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        .modal-input-header {
            padding: 24px 30px 20px;
            border-bottom: 2px solid #e5e7eb;
        }

        .modal-input-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0;
        }

        .modal-input-body {
            padding: 25px 30px;
        }

        .modal-input-group {
            margin-bottom: 20px;
        }

        .modal-input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 0.95rem;
        }

        .modal-input-group input,
        .modal-input-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        .modal-input-group input:focus,
        .modal-input-group textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .modal-input-group textarea {
            resize: vertical;
            min-height: 80px;
            font-family: inherit;
        }

        .modal-input-footer {
            padding: 20px 30px;
            border-top: 2px solid #e5e7eb;
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Responsividade Mobile */
        @media (max-width: 768px) {
            .prazo-item {
                grid-template-columns: 32px 1fr;
                gap: 12px;
                padding: 16px;
            }

            .prazo-contador {
                grid-column: 2;
                align-items: flex-start;
                margin-top: 8px;
            }

            .prazo-acoes {
                opacity: 1;
                visibility: visible;
                grid-column: 2;
                justify-content: flex-end;
            }

            .filtro-btn {
                min-width: 100px;
                font-size: 0.85rem;
                padding: 8px 12px;
            }

            .modal-detalhes-content {
                max-height: 90vh;
            }

            .modal-detalhes-header,
            .modal-detalhes-body,
            .modal-detalhes-acoes {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            .prazo-titulo {
                font-size: 1rem;
            }

            .contador-numero {
                font-size: 1.5rem;
            }

            .agenda-filtros {
                gap: 6px;
                padding: 6px;
            }

            .filtro-btn {
                font-size: 0.8rem;
                padding: 6px 10px;
                min-width: 90px;
            }
        }
    </style>
    <!-- Biblioteca html2canvas para exportação de PNG -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- Cabeçalho Global -->
    <div class="page-header">
        <div class="page-header-content">
            <div class="logo-cp">CP</div>
            <div class="brand-title">
                <div class="brand-name">
                    <span class="brand-conta">Conta</span><span class="brand-prazo">Prazo</span>
                </div>
                <span class="brand-separator">|</span>
                <span class="brand-subtitle">Calculadora de Prazos</span>
            </div>
        </div>
    </div>

    <!-- Banner de Atualização de Feriados -->
    <div id="updateBanner" class="update-banner">
        <div class="update-banner-content">
            <div class="update-banner-icon">🔔</div>
            <div class="update-banner-text">
                <div class="update-banner-title" id="updateBannerTitle">
                    Atualizações disponíveis
                </div>
                <div class="update-banner-description" id="updateBannerDescription">
                    Verificando atualizações...
                </div>
            </div>
            <div class="update-banner-actions">
                <button class="update-banner-btn update-banner-btn-primary" onclick="atualizarFeriadosAPartirDoBanner()">
                    Atualizar
                </button>
                <button class="update-banner-btn update-banner-btn-secondary" onclick="fecharBannerAtualizacao()">
                    Agora não
                </button>
                <button class="update-banner-btn update-banner-btn-close" onclick="fecharBannerAtualizacao()" title="Fechar">
                    ✕
                </button>
            </div>
        </div>
    </div>

    <!-- Menu de Navegação -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="trocarPagina('calculo')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            Calculadora
        </button>
        <button class="nav-tab" onclick="trocarPagina('gerenciamento')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="
            M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06
            a2 2 0 1 1-2.83 2.83l-.06-.06
            a1.65 1.65 0 0 0-1.82-.33
            1.65 1.65 0 0 0-1 1.51V21
            a2 2 0 1 1-4 0v-.09
            a1.65 1.65 0 0 0-1-1.51
            1.65 1.65 0 0 0-1.82.33l-.06.06
            a2 2 0 1 1-2.83-2.83l.06-.06
            a1.65 1.65 0 0 0 .33-1.82
            1.65 1.65 0 0 0-1.51-1H3
            a2 2 0 1 1 0-4h.09
            a1.65 1.65 0 0 0 1.51-1
            1.65 1.65 0 0 0-.33-1.82l-.06-.06
            a2 2 0 1 1 2.83-2.83l.06.06
            a1.65 1.65 0 0 0 1.82.33H9
            a1.65 1.65 0 0 0 1-1.51V3
            a2 2 0 1 1 4 0v.09
            a1.65 1.65 0 0 0 1 1.51
            1.65 1.65 0 0 0 1.82-.33l.06-.06
            a2 2 0 1 1 2.83 2.83l-.06.06
            a1.65 1.65 0 0 0-.33 1.82V9
            a1.65 1.65 0 0 0 1.51 1H21
            a2 2 0 1 1 0 4h-.09
            a1.65 1.65 0 0 0-1.51 1z
    "></path>
            </svg>
            Editor de Feriados
        </button>
        <button class="nav-tab" onclick="trocarPagina('agenda')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
                <path d="M8 14h.01"></path>
                <path d="M12 14h.01"></path>
                <path d="M16 14h.01"></path>
                <path d="M8 18h.01"></path>
                <path d="M12 18h.01"></path>
                <path d="M16 18h.01"></path>
            </svg>
            Minha Agenda
        </button>
        <button class="nav-tab" onclick="trocarPagina('ajuda')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Ajuda
        </button>
    </div>

    <div class="container">
        <!-- Página de Cálculo -->
        <div id="paginaCalculo" class="page-content active">
        <div class="main-layout">
            <!-- Coluna esquerda: Formulário e Resultado -->
            <div>
                <div class="card">
                    <h3 class="section-title">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Formulário de Cálculo
                    </h3>
                    <div class="section-divider"></div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="dataInicio">Data de Início do Prazo</label>
                    <div class="data-input-wrapper">
                        <input type="date" id="dataInicio">
                        <button class="btn-data-hoje" onclick="setDataHoje()" title="Definir data de hoje">Hoje</button>
                    </div>
                </div>
                <div class="form-group-with-toggle">
                    <label for="diasUteis">Quantidade de Dias</label>
                    <div class="dias-input-wrapper">
                        <div class="dias-input-container">
                            <input type="number" id="diasUteis" min="1" placeholder="Ex: 15">
                        </div>
                        <div class="toggle-container">
                            <div class="toggle-wrapper">
                                <div class="toggle-switch active" id="toggleTipoDias" onclick="toggleTipoDias()">
                                    <div class="toggle-slider"></div>
                                </div>
                                <span class="toggle-label" id="labelTipoDias">Dias Úteis</span>
                            </div>
                        </div>
                    </div>
                    <div class="quick-buttons">
                        <button class="btn btn-quick" onclick="setDias(5)">5 dias</button>
                        <button class="btn btn-quick" onclick="setDias(10)">10 dias</button>
                        <button class="btn btn-quick" onclick="setDias(15)">15 dias</button>
                        <button class="btn btn-quick" onclick="setDias(30)">30 dias</button>
                    </div>
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="descricaoPrazo">Descrição (Opcional)</label>
                <textarea id="descricaoPrazo" placeholder="Ex: Prazo para recurso administrativo, contestação, etc."></textarea>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calcularPrazo()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Calcular Prazo
                </button>
                <button class="btn btn-secondary" onclick="limparResultado()" id="btnLimpar" style="display:none">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Limpar
                </button>
            </div>
            <input type="file" id="importarFeriados" accept=".json" style="display:none" onchange="importarFeriados(event)">

            <div id="resultado" style="display:none"></div>
                </div>
            </div>

            <!-- Coluna direita: Calendário -->
            <div>
                <div class="card calendario">
                    <h3 class="section-title">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Calendário Interativo
                    </h3>
                    <div class="section-divider"></div>

                    <!-- Barra de Perfis de Feriados -->
                    <div class="perfis-bar">
                        <div class="perfis-bar-left">
                            <span class="perfis-bar-label" title="Salve e alterne entre diferentes conjuntos de feriados personalizados (ex: TJSP, TJRJ, TRF3)">Perfil:</span>
                            <div class="perfil-dropdown">
                                <div class="perfil-pill" id="perfilPill" onclick="togglePerfilDropdown()" title="Clique para alternar entre perfis de feriados">
                                    <span class="perfil-pill-text" id="perfilPillText">Nenhum</span>
                                    <svg class="perfil-pill-arrow" id="perfilPillArrow" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="6 9 12 15 18 9"></polyline>
                                    </svg>
                                </div>
                                <div class="perfil-dropdown-menu" id="perfilDropdownMenu">
                                    <div class="perfil-dropdown-item none" onclick="selecionarPerfil(null)">Nenhum</div>
                                </div>
                            </div>
                            <span class="perfil-unsaved-indicator" id="perfilUnsavedIndicator">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                </svg>
                                Alterações
                            </span>
                        </div>
                        <div class="perfis-bar-right">
                            <button class="perfil-btn perfil-btn-save" id="btnSalvarPerfil" onclick="salvarAlteracoesPerfil()" style="display: none;" title="Salvar alterações no perfil">
                                <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                    <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                    <polyline points="7 3 7 8 15 8"></polyline>
                                </svg>
                                Salvar
                            </button>
                            <button class="perfil-btn" onclick="abrirModalCriarPerfil()" title="Criar novo perfil">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </button>
                            <button class="perfil-btn" onclick="abrirModalGerenciarPerfis()" title="Gerenciar perfis">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="3"></circle>
                                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>

            <div class="calendario-header">
                <div class="calendario-nav-row">
                    <button class="btn-nav" onclick="mudarMes(-1)" id="btnNavAnterior">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <h2 id="mesAtual"></h2>
                    <button class="btn-nav" onclick="mudarMes(1)" id="btnNavProximo">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
                <div class="calendario-actions-row">
                    <div class="visualizacao-toggle">
                        <button onclick="alternarVisualizacao('mensal')" id="btnMensal" class="active">Mensal</button>
                        <button onclick="alternarVisualizacao('anual')" id="btnAnual">Anual</button>
                    </div>
                    <button class="btn-hoje" onclick="irParaHoje()">
                        📅 Hoje
                    </button>
                </div>
            </div>

            <div class="calendario-grid" id="calendarioGrid"></div>

            <div class="config-feriados">
                <div class="config-feriados-header" onclick="toggleConfigFeriados()">
                    <h3><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 6px;"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg> Configurar Feriados</h3>
                    <span class="config-feriados-toggle" id="configToggleIcon">▼</span>
                </div>
                <div class="config-feriados-content" id="configFeriadosContent">
                    <div class="config-feriados-body">
                        <div class="config-secao">
                            <h4>Incluir no Cálculo</h4>
                            <div class="btn-group">
                                <button class="toggle-btn toggle-ativo" id="toggleFixos" onclick="toggleFeriados('fixos')">
                                    ✓ Feriados Nacionais
                                </button>
                                <button class="toggle-btn toggle-ativo" id="toggleMoveis" onclick="toggleFeriados('moveis')">
                                    ✓ Feriados Móveis
                                </button>
                                <button class="toggle-btn toggle-ativo" id="togglePersonalizados" onclick="toggleFeriados('personalizados')">
                                    ✓ Feriados Personalizados
                                </button>
                            </div>
                        </div>

                        <div class="config-divisor"></div>

                        <div class="config-secao">
                            <h4>Gerenciar Feriados Personalizados</h4>
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="exportarFeriados()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                    Exportar
                                </button>
                                <button class="btn btn-purple" onclick="abrirModalSelecionarFonte()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Importar Feriados
                                </button>
                                <button class="btn btn-secondary" onclick="verificarAtualizacoesFeriados(true)" title="Verificar se há atualizações disponíveis para os conjuntos de feriados importados">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="23 4 23 10 17 10"></polyline>
                                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                                    </svg>
                                    Verificar Atualizações
                                </button>
                                <button class="btn btn-red" onclick="limparFeriadosPersonalizados()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Limpar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="legenda">
                <h3>Legenda:</h3>
                <div class="legenda-grid">
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #e5e7eb"></div>
                        <span>Fim de semana</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #fecaca"></div>
                        <span>Feriados Fixos/Móveis</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #e9d5ff"></div>
                        <span>Feriados Personalizados</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #3b82f6"></div>
                        <span>Data de início</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #16a34a"></div>
                        <span>Data final</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #fef3c7"></div>
                        <span>Dias contados</span>
                    </div>
                </div>
                <p style="margin-top: 15px; font-size: 0.875rem; color: #6b7280;">
                    <strong>Dica:</strong> Clique em qualquer dia útil para marcá-lo como feriado personalizado.
                </p>
            </div>
                </div>
            </div>
        </div>

        </div>
        <!-- Fim Página de Cálculo -->

        <!-- Página de Gerenciamento de Feriados -->
        <div id="paginaGerenciamento" class="page-content">
            <div class="batch-editor">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Gerenciamento Avançado de Feriados
                </h3>
                <p style="color: #6b7280; margin-bottom: 20px;">
                    Configure os feriados fixos e móveis da calculadora. Estas configurações são diferentes dos feriados personalizados que você adiciona clicando no calendário.
                </p>

                <!-- Seção 1: Feriados Fixos e Móveis -->
                <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h4 style="color: #dc2626; margin-bottom: 15px; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Feriados Fixos e Móveis
                    </h4>

                    <div class="info-box">
                        <p><strong>ℹ️ Formatos aceitos:</strong></p>
                        <ul style="margin-top: 8px; margin-left: 20px; line-height: 1.8;">
                            <li><strong>Feriados Fixos:</strong> <code>DD-MM Nome</code> (sem ano) - Ex: <code>25-12 Natal</code></li>
                            <li><strong>Feriados Móveis:</strong> <code>DD-MM-YYYY Nome</code> (com ano) - Ex: <code>04-03-2025 Carnaval</code></li>
                        </ul>
                    </div>

                    <h5 style="color: #1f2937; margin-top: 20px; margin-bottom: 10px; font-size: 1rem;">Feriados Fixos</h5>
                    <p style="color: #6b7280; font-size: 0.85rem; margin-bottom: 10px;">Feriados que ocorrem na mesma data todos os anos. <strong>Formato: DD-MM Nome</strong> (sem especificar o ano):</p>
                    <textarea id="editorFeriadosFixos" placeholder="01-01 Ano Novo&#10;25-12 Natal"></textarea>

                    <h5 style="color: #1f2937; margin-top: 20px; margin-bottom: 10px; font-size: 1rem;">Feriados Móveis</h5>
                    <p style="color: #6b7280; font-size: 0.85rem; margin-bottom: 10px;">Feriados que variam de data a cada ano. <strong>Formato: DD-MM-YYYY Nome</strong> (com o ano completo):</p>
                    <textarea id="editorFeriadosMoveis" placeholder="04-03-2025 Carnaval&#10;18-04-2025 Sexta-feira Santa"></textarea>

                    <div class="warning-box" style="margin-top: 15px;">
                        <p><strong>⚠️ Atenção:</strong> Ao salvar, as configurações atuais de fixos/móveis serão substituídas pelas novas. Esta ação não afeta os feriados personalizados.</p>
                    </div>

                    <div class="btn-group" style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="salvarFeriadosBatch()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Salvar Fixos e Móveis
                        </button>
                        <button class="btn btn-secondary" onclick="resetarFeriadosPadrao()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Resetar Fixos/Móveis
                        </button>
                    </div>
                </div>

                <!-- Divisor visual -->
                <div style="border-top: 3px solid #d1d5db; margin: 30px 0;"></div>

                <!-- Seção 2: Feriados Personalizados -->
                <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px;">
                    <h4 style="color: #9333ea; margin-bottom: 15px; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Feriados Personalizados
                    </h4>

                    <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 15px;">
                        Gerencie feriados específicos adicionados por você (via calendário ou importação JSON). <strong>Formato: DD-MM-YYYY Nome</strong> (nome opcional)
                    </p>

                    <textarea id="editorFeriadosPersonalizados" placeholder="25-12-2025 Natal&#10;01-01-2026 Ano Novo&#10;15-06-2026"></textarea>

                    <div class="btn-group" style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="salvarFeriadosPersonalizadosEditor()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Salvar Personalizados
                        </button>
                        <button class="btn btn-red" onclick="limparFeriadosPersonalizados()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                            Limpar Personalizados
                        </button>
                    </div>

                    <div class="btn-group" style="margin-top: 10px;">
                        <button class="btn btn-purple" onclick="abrirModalSelecionarFonte()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Importar Feriados
                        </button>
                        <button class="btn btn-secondary" onclick="exportarFeriados()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Exportar JSON
                        </button>
                    </div>

                    <div class="btn-group" style="margin-top: 10px;">
                        <button class="btn btn-secondary" onclick="verificarAtualizacoesFeriados(true)" style="width: 100%;" title="Verificar se há atualizações disponíveis">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Verificar Atualizações
                        </button>
                    </div>
                </div>
            </div>

            <div class="batch-editor">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                    Visualização de Feriados Configurados
                </h3>

                <h4 style="color: #dc2626; margin-top: 20px; margin-bottom: 10px;">Feriados Fixos Ativos</h4>
                <div id="listaFeriadosFixos" class="feriados-list"></div>

                <h4 style="color: #dc2626; margin-top: 20px; margin-bottom: 10px;">Feriados Móveis Ativos</h4>
                <div id="listaFeriadosMoveis" class="feriados-list"></div>

                <h4 style="color: #9333ea; margin-top: 20px; margin-bottom: 10px;">Feriados Personalizados Ativos</h4>
                <div id="listaFeriadosPersonalizados" class="feriados-list"></div>
            </div>
        </div>
        <!-- Fim Página de Gerenciamento -->

        <!-- Página de Ajuda -->
        <div id="paginaAjuda" class="page-content">
            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <!-- brilho principal -->
    <path d="M12 3l1.5 3.5L17 8l-3.5 1.5L12 13l-1.5-3.5L7 8l3.5-1.5L12 3z" />

    <!-- brilhos secundários -->
    <path d="M5 14l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z" />
    <path d="M17 14l.8 1.6 1.6.8-1.6.8-.8 1.6-.8-1.6-1.6-.8 1.6-.8.8-1.6z" />
                    </svg>
                    Bem-vindo ao ContaPrazo
                </h3>
                <p>
                    O <strong>ContaPrazo</strong> é uma calculadora de prazos que auxilia no cálculo de datas finais, considerando prazos em dias úteis ou corridos, bem como feriados nacionais, móveis e personalizados.
                </p>
				<p>
				A ferramenta nasceu da experiência cotidiana com a gestão de múltiplos prazos, em contextos nos quais diferentes regras de contagem convivem e exigem atenção constante. A necessidade de organizar datas, evitar inconsistências e tornar os fluxos mais previsíveis motivou o desenvolvimento de uma solução simples, capaz de centralizar a contagem de prazos e apoiar a administração de compromissos que dependem de precisão e confiabilidade.
				</p>

				<p>
				Espero que seja útil!
				</p>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Como Usar a Calculadora
                </h3>
                <ul>
                    <li><strong>Data de Início:</strong> Selecione a data inicial do prazo.</li>
                    <li><strong>Quantidade de Dias:</strong> Informe quantos dias você deseja contar. Use os botões rápidos (5, 10, 15, 30 dias) para agilizar.</li>
                    <li><strong>Tipo de Dias:</strong> Use o botão de alternância para escolher entre <strong>Dias Úteis</strong> (exclui fins de semana e feriados) ou <strong>Dias Corridos</strong> (conta todos os dias).</li>
                    <li><strong>Descrição:</strong> Adicione uma descrição opcional para identificar o cálculo (ex: "Prazo para recurso administrativo").</li>
                    <li><strong>Calcular:</strong> Clique no botão "Calcular Prazo" para ver o resultado.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    Entendendo os Resultados
                </h3>
                <ul>
                    <li><strong>Data de Início:</strong> A data inicial informada, exibida por extenso.</li>
                    <li><strong>Dias Contados:</strong> Quantidade de dias úteis ou corridos que foram contados.</li>
                    <li><strong>Data Final do Prazo:</strong> A data final calculada, destacada em verde.</li>
                    <li><strong>Detalhamento:</strong> Lista completa de todos os dias percorridos, mostrando quais foram contados (em verde) e quais foram pulados (em vermelho) com o motivo.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    Exportando Resultados
                </h3>
                <p>Você pode exportar os resultados em diferentes formatos:</p>
                <ul>
                    <li><strong>Exportar PDF:</strong> Gera um documento HTML que pode ser impresso ou salvo como PDF (use Ctrl+P ou Cmd+P). Você pode escolher entre a versão resumida (com visualização gráfica dos dias) ou completa (com detalhamento dia a dia).</li>
                    <li><strong>Exportar PNG:</strong> Salva uma imagem do cálculo. Você pode escolher entre a versão resumida (com visualização gráfica dos dias) ou completa (com detalhamento dia a dia).</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Usando o Calendário
                </h3>
                <ul>
                    <li><strong>Visualização:</strong> Alterne entre visualização <strong>Mensal</strong> e <strong>Anual</strong> usando os botões correspondentes.</li>
                    <li><strong>Navegação:</strong> Use as setas para navegar entre meses ou anos. O botão <strong>"Hoje"</strong> retorna para o mês/ano atual.</li>
                    <li><strong>Feriados Personalizados:</strong> Clique em qualquer dia útil no calendário para marcá-lo ou desmarcá-lo como feriado personalizado. Você pode adicionar nomes descritivos aos feriados na aba "Editor de Feriados".</li>
                    <li><strong>Legenda:</strong> Consulte a legenda abaixo do calendário para entender as cores de cada tipo de dia.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Minha Agenda de Prazos
                </h3>
                <p><strong>Salve e organize</strong> seus prazos calculados em uma agenda completa com filtros, edição e arquivamento.</p>
                <ul>
                    <li><strong>Salvar Prazo:</strong> Após calcular, clique em "Salvar na Minha Agenda" para adicionar título e descrição.</li>
                    <li><strong>Filtros Inteligentes:</strong> Visualize prazos por status - Todos, Atrasados, Vencendo (≤3 dias), Pendentes, Concluídos.</li>
                    <li><strong>Marcar como Concluído:</strong> Clique no checkbox verde ao lado de cada prazo para marcar/desmarcar conclusão.</li>
                    <li><strong>Seleção Múltipla:</strong> Clique em "Selecionar" para entrar no modo de seleção e realizar ações em lote (marcar concluídos, arquivar ou excluir vários prazos de uma vez).</li>
                    <li><strong>Menu de Ações (⋮):</strong> Ver detalhes completos, editar, arquivar ou excluir cada prazo individualmente.</li>
                    <li><strong>Arquivamento:</strong> Prazos podem ser arquivados individualmente ou em lote. Use "Ver Arquivados" para acessar prazos arquivados. Você pode desarquivar (escolhendo voltar como pendente ou concluído) ou excluir permanentemente.</li>
                    <li><strong>Exportar/Importar:</strong> Exporte sua agenda completa em JSON para backup ou compartilhe com outros dispositivos através da função "Importar Agenda".</li>
                    <li><strong>Notificações:</strong> Ao abrir a página, um banner alerta sobre prazos vencendo nos próximos dias.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06
            a2 2 0 1 1-2.83 2.83l-.06-.06
            a1.65 1.65 0 0 0-1.82-.33
            1.65 1.65 0 0 0-1 1.51V21
            a2 2 0 1 1-4 0v-.09
            a1.65 1.65 0 0 0-1-1.51
            1.65 1.65 0 0 0-1.82.33l-.06.06
            a2 2 0 1 1-2.83-2.83l.06-.06
            a1.65 1.65 0 0 0 .33-1.82
            1.65 1.65 0 0 0-1.51-1H3
            a2 2 0 1 1 0-4h.09
            a1.65 1.65 0 0 0 1.51-1
            1.65 1.65 0 0 0-.33-1.82l-.06-.06
            a2 2 0 1 1 2.83-2.83l.06.06
            a1.65 1.65 0 0 0 1.82.33H9
            a1.65 1.65 0 0 0 1-1.51V3
            a2 2 0 1 1 4 0v.09
            a1.65 1.65 0 0 0 1 1.51
            1.65 1.65 0 0 0 1.82-.33l.06-.06
            a2 2 0 1 1 2.83 2.83l-.06.06
            a1.65 1.65 0 0 0-.33 1.82V9
            a1.65 1.65 0 0 0 1.51 1H21
            a2 2 0 1 1 0 4h-.09
            a1.65 1.65 0 0 0-1.51 1z
    "></path>
                    </svg>
                    Configurando Feriados
                </h3>
                <p>Existem três tipos de feriados na calculadora:</p>
                <ul>
                    <li><strong>Feriados Nacionais:</strong> Feriados fixos do Brasil (Ano Novo, Tiradentes, Natal, etc.). Podem ser ativados/desativados na seção "Configurar Feriados".</li>
                    <li><strong>Feriados Móveis:</strong> Feriados que mudam de data a cada ano (Carnaval, Páscoa, Corpus Christi). Também podem ser ativados/desativados.</li>
                    <li><strong>Feriados Personalizados:</strong> Datas específicas que você marca clicando no calendário (ex: feriados municipais, ponto facultativo local).</li>
                </ul>
                <h4 style="margin-top: 24px; font-size: 1rem; color: #1f2937; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Exportar/Importar Feriados Personalizados
                </h4>
                <p style="margin-top: 12px;">
                    Você pode salvar seus feriados personalizados em um arquivo JSON e compartilhá-lo com colegas, equipes ou setores que precisem das mesmas exceções de calendário. Isso é especialmente útil para:
                </p>
                <ul style="margin-top: 8px;">
                    <li>Equipes jurídicas que seguem o mesmo calendário forense</li>
                    <li>Departamentos que compartilham feriados municipais ou estaduais</li>
                    <li>Grupos de trabalho com pontos facultativos específicos</li>
                    <li>Backup e restauração de suas configurações personalizadas</li>
                </ul>
                <p style="margin-top: 12px; padding: 12px; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 4px; font-size: 0.9rem;">
                    <strong>Como funciona:</strong> Exporte seus feriados clicando em "Exportar JSON" na aba de Feriados. Compartilhe o arquivo com outras pessoas (e-mail, chat, drive). Ao importar, escolha <strong>"Substituir"</strong> para sobrescrever os atuais ou <strong>"Mesclar"</strong> para adicionar aos existentes.
                </p>

                <h4 style="margin-top: 20px; font-size: 0.95rem; color: #4b5563; font-weight: 600;">
                    📋 Formato do arquivo exportado
                </h4>
                <p style="margin-top: 8px; font-size: 0.875rem;">
                    O arquivo JSON segue esta estrutura:
                </p>
                <pre style="background: #f3f4f6; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6; overflow-x: auto; font-size: 0.875rem; line-height: 1.5; margin-top: 8px;"><code>{
  "feriadosPersonalizados": [
    "25-12-2025 Natal",
    "24-12-2025 Véspera de Natal",
    "01-01-2026 Ano Novo",
    "15-06-2026"
  ],
  "dataExportacao": "2025-12-16T12:35:09.540Z"
}</code></pre>
                <p style="margin-top: 8px; font-size: 0.875rem; color: #6b7280;">
                    <strong>Nota:</strong> As datas dos feriados personalizados devem estar no formato <code>DD-MM-YYYY Nome</code> (dia-mês-ano seguido do nome). O nome é opcional - se omitido, o feriado será exibido como "Feriado/Ponto Facultativo" no cálculo. O campo "dataExportacao" é gerado automaticamente.
                </p>

                <h4 style="margin-top: 24px; font-size: 1rem; color: #1f2937; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    ☁️ Conjuntos Pré-definidos Online (NOVO!)
                </h4>
                <p style="margin-top: 12px;">
                    Agora você pode importar conjuntos de feriados pré-configurados diretamente online, sem precisar baixar ou compartilhar arquivos! Ao clicar em <strong>"Importar Feriados"</strong>, escolha a opção <strong>"Conjuntos Pré-definidos Online"</strong> para acessar:
                </p>
                <ul style="margin-top: 8px;">
                    <li><strong>TJBA - Tribunal de Justiça da Bahia:</strong> Calendário forense oficial com feriados e pontos facultativos</li>
                    <li><strong>Prefeituras Municipais:</strong> Feriados municipais e pontos facultativos de cidades específicas</li>
                    <li><strong>Outros conjuntos:</strong> Calendários atualizados para diversos órgãos e jurisdições</li>
                </ul>
                <p style="margin-top: 12px; padding: 12px; background: #ecfdf5; border-left: 4px solid #10b981; border-radius: 4px; font-size: 0.9rem;">
                    <strong>💡 Vantagem:</strong> Os conjuntos online são atualizados automaticamente conforme novos decretos e portarias são publicados. Você sempre terá acesso à versão mais recente sem precisar baixar novos arquivos!
                </p>
                <p style="margin-top: 12px; font-size: 0.875rem;">
                    <strong>Como usar:</strong>
                </p>
                <ol style="margin-top: 8px; font-size: 0.875rem;">
                    <li>Clique em <strong>"Importar Feriados"</strong> (disponível no menu Calculadora ou Editor de Feriados)</li>
                    <li>Escolha <strong>"☁️ Conjuntos Pré-definidos Online"</strong></li>
                    <li>Selecione o conjunto desejado da lista (ex: TJBA, PMVC, etc.)</li>
                    <li>Escolha se deseja <strong>Substituir</strong> (apagar atuais) ou <strong>Mesclar</strong> (adicionar aos existentes)</li>
                    <li>Pronto! Os feriados serão importados automaticamente</li>
                </ol>
                <p style="margin-top: 12px; padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px; font-size: 0.875rem;">
                    <strong>⚠️ Observação:</strong> Se você também tiver feriados personalizados específicos (ex: aniversário do setor), recomendamos escolher <strong>"Mesclar"</strong> para manter seus feriados e adicionar os do conjunto online.
                </p>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    Perfis de Feriados
                </h3>
                <p>
                    Perfis permitem salvar e alternar entre diferentes conjuntos de feriados personalizados. Isso é útil para quem trabalha com múltiplas jurisdições ou precisa alternar entre calendários forenses distintos (ex: TJSP, TJRJ, TRF3).
                </p>
                <ul style="margin-top: 8px;">
                    <li><strong>Criar perfil:</strong> Clique no botão <strong>"+"</strong> na barra de perfis (acima do calendário). O perfil salvará os feriados personalizados atuais.</li>
                    <li><strong>Alternar perfis:</strong> Clique na pílula do perfil ativo para abrir o dropdown e selecionar outro perfil. Selecionar <strong>"Nenhum"</strong> limpa os feriados personalizados.</li>
                    <li><strong>Alterações não salvas:</strong> Um indicador amarelo aparece quando os feriados atuais diferem dos salvos no perfil. Clique em <strong>"Salvar"</strong> para atualizar o perfil.</li>
                    <li><strong>Gerenciar:</strong> Clique no ícone de engrenagem <strong>"⚙"</strong> para renomear ou excluir perfis existentes.</li>
                </ul>
                <p style="margin-top: 12px; padding: 12px; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 4px; font-size: 0.9rem;">
                    <strong>Limite:</strong> Você pode criar até 10 perfis, com nomes de até 30 caracteres. Os perfis são salvos localmente no navegador.
                </p>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                    Gerenciamento Avançado de Feriados
                </h3>
                <p>
                    Na aba <strong>"Editor de Feriados"</strong>, você pode editar feriados em modo batch (lote):
                </p>
                <ul>
                    <li><strong>Feriados Fixos:</strong> Edite os feriados que ocorrem na mesma data todos os anos (formato: <code>DD-MM Nome</code>).</li>
                    <li><strong>Feriados Móveis:</strong> Edite os feriados que mudam de ano para ano (formato: <code>DD-MM-YYYY Nome</code>).</li>
                    <li><strong>Feriados Personalizados:</strong> Gerencie os feriados adicionados clicando no calendário ou importados de JSON (formato: <code>DD-MM-YYYY Nome</code>, nome é opcional). Você pode adicionar, editar ou remover feriados específicos diretamente no editor de texto, incluindo nomes descritivos para melhor identificação.</li>
                </ul>
                <p style="margin-top: 12px;">
                    <strong>Ações disponíveis:</strong>
                </p>
                <ul>
                    <li><strong>Salvar:</strong> Substitui as configurações atuais pelas novas.</li>
                    <li><strong>Resetar:</strong> Restaura os feriados fixos/móveis padrão do Brasil.</li>
                    <li><strong>Importar/Exportar JSON:</strong> Permite importar ou exportar feriados personalizados em formato JSON.</li>
                    <li><strong>Limpar Todos:</strong> Remove todos os feriados personalizados.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Compartilhando a Calculadora
                </h3>
                <p>
                    No rodapé da página de cálculo, você encontrará a opção <strong>"Baixar esta calculadora para compartilhar"</strong>. Isso permite que você:
                </p>
                <ul>
                    <li>Baixe o arquivo HTML completo da calculadora</li>
                    <li>Compartilhe com colegas, clientes ou qualquer pessoa</li>
                    <li>Use a calculadora offline, sem necessidade de internet</li>
                    <li>Mantenha uma cópia local para uso futuro</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="8"></line>
                        <line x1="12" y1="12" x2="12" y2="16"></line>
                    </svg>
                    Dicas e Boas Práticas
                </h3>
                <ul>
                    <li>Sempre verifique se o tipo de dias (úteis ou corridos) está correto antes de calcular.</li>
                    <li>Use a descrição para documentar o motivo do cálculo - isso ajuda ao exportar ou revisar depois.</li>
                    <li>Confira a legenda do calendário para entender como cada dia está sendo categorizado.</li>
                    <li>Exporte seus feriados personalizados periodicamente para não perdê-los (são salvos localmente no navegador).</li>
                    <li>Use o detalhamento para conferir se algum dia foi contado ou não contado corretamente.</li>
                    <li>O botão "Limpar" remove o resultado atual e permite fazer um novo cálculo rapidamente.</li>
                </ul>

                <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #e5e7eb; text-align: center;">
                    <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 15px;">
                        Precisa restaurar a calculadora para as configurações originais?
                    </p>
                    <button class="btn btn-secondary" onclick="confirmarResetCompleto()" style="font-size: 0.875rem; padding: 8px 16px;">
                        🔄 Restaurar Configurações Padrão
                    </button>
                </div>
            </div>
        </div>
        <!-- Fim Página de Ajuda -->

        <!-- Página Minha Agenda -->
        <div id="paginaAgenda" class="page-content">
            <div class="card">
                <h3 class="section-title">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Minha Agenda de Prazos
                </h3>
                <div class="section-divider"></div>

                <!-- Filtros -->
                <div class="agenda-filtros">
                    <button class="filtro-btn active" onclick="filtrarPrazos('todos')" data-filtro="todos">
                        <span>Todos</span>
                        <span class="filtro-badge" id="badge-todos">0</span>
                    </button>
                    <button class="filtro-btn" onclick="filtrarPrazos('atrasados')" data-filtro="atrasados">
                        <span>🔴 Atrasados</span>
                        <span class="filtro-badge" id="badge-atrasados">0</span>
                    </button>
                    <button class="filtro-btn" onclick="filtrarPrazos('vencendo')" data-filtro="vencendo">
                        <span>🟠 Vencendo</span>
                        <span class="filtro-badge" id="badge-vencendo">0</span>
                    </button>
                    <button class="filtro-btn" onclick="filtrarPrazos('pendentes')" data-filtro="pendentes">
                        <span>🔵 Pendentes</span>
                        <span class="filtro-badge" id="badge-pendentes">0</span>
                    </button>
                    <button class="filtro-btn" onclick="filtrarPrazos('concluidos')" data-filtro="concluidos">
                        <span>✅ Concluídos</span>
                        <span class="filtro-badge" id="badge-concluidos">0</span>
                    </button>
                    <button class="filtro-btn filtro-toggle" onclick="entrarModoSelecao()" id="btnSelecionar" title="Selecionar múltiplos prazos">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 5px;">
                            <polyline points="9 11 12 14 22 4"></polyline>
                            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
                        </svg>
                        <span>Selecionar</span>
                    </button>
                    <button class="filtro-btn filtro-toggle" onclick="toggleVisualizacaoArquivados()" id="btnVerArquivados" title="Ver prazos arquivados">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 5px;">
                            <polyline points="21 8 21 21 3 21 3 8"></polyline>
                            <rect x="1" y="3" width="22" height="5"></rect>
                            <line x1="10" y1="12" x2="14" y2="12"></line>
                        </svg>
                        <span id="textoVerArquivados">Ver Arquivados</span>
                        <span class="filtro-badge" id="badge-arquivados">0</span>
                    </button>
                </div>

                <!-- Barra de Ações de Seleção Múltipla -->
                <div id="barraSelecao" class="barra-selecao" style="display: none;">
                    <div class="barra-selecao-info">
                        <strong id="contadorSelecionados">0</strong> selecionado(s)
                    </div>
                    <div class="barra-selecao-acoes">
                        <button class="btn-selecao btn-selecao-todos" onclick="selecionarTodos()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 11l3 3L22 4"></path>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                            </svg>
                            Todos
                        </button>
                        <button class="btn-selecao btn-selecao-nenhum" onclick="selecionarNenhum()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                            </svg>
                            Nenhum
                        </button>
                        <div class="barra-selecao-divider"></div>
                        <button class="btn-selecao btn-selecao-acoes" onclick="toggleMenuAcoesSelecao()">
                            Ações
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="6 9 12 15 18 9"></polyline>
                            </svg>
                        </button>
                        <div id="menuAcoesSelecao" class="menu-acoes-selecao" style="display: none;">
                            <button onclick="marcarSelecionadosConcluidos()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <polyline points="20 6 9 17 4 12"></polyline>
                                </svg>
                                Marcar como Concluídos
                            </button>
                            <button onclick="arquivarSelecionados()">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <polyline points="21 8 21 21 3 21 3 8"></polyline>
                                    <rect x="1" y="3" width="22" height="5"></rect>
                                    <line x1="10" y1="12" x2="14" y2="12"></line>
                                </svg>
                                Arquivar Selecionados
                            </button>
                            <button onclick="excluirSelecionados()" style="color: #dc2626;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                </svg>
                                Excluir Selecionados
                            </button>
                        </div>
                        <button class="btn-selecao btn-selecao-cancelar" onclick="sairModoSelecao()">
                            ✕ Cancelar
                        </button>
                    </div>
                </div>

                <!-- Paginação -->
                <div id="agendaPaginacao" class="agenda-paginacao" style="display: none;">
                    <div class="paginacao-info">
                        Mostrando <strong id="paginacaoMostrando">0</strong> de <strong id="paginacaoTotal">0</strong> prazos
                    </div>
                    <div class="paginacao-controles">
                        <button class="paginacao-btn" id="btnPaginaAnterior" onclick="mudarPagina(paginaAtual - 1)">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                            Anterior
                        </button>
                        <div class="paginacao-numero">
                            Página <strong id="paginacaoNumero">1</strong> de <strong id="paginacaoPaginas">1</strong>
                        </div>
                        <button class="paginacao-btn" id="btnProximaPagina" onclick="mudarPagina(paginaAtual + 1)">
                            Próxima
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Lista de Prazos -->
                <div id="agendaLista" class="agenda-lista">
                    <!-- Prazos serão renderizados aqui via JavaScript -->
                </div>

                <!-- Estado Vazio -->
                <div id="agendaVazia" class="agenda-vazia" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    <h3>Nenhum prazo encontrado</h3>
                    <p>Calcule prazos na aba "Calculadora" e salve-os na agenda.</p>
                </div>

                <!-- Botões de gerenciamento ao final -->
                <div class="agenda-acoes-gerenciamento">
                    <div class="btn-group">
                        <button class="btn btn-success" onclick="exportarAgendaJSON()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Exportar Agenda
                        </button>
                        <button class="btn btn-primary" onclick="importarAgendaJSON()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Importar Agenda
                        </button>
                        <button class="btn btn-secondary" onclick="arquivarConcluidos()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="21 8 21 21 3 21 3 8"></polyline>
                                <rect x="1" y="3" width="22" height="5"></rect>
                                <line x1="10" y1="12" x2="14" y2="12"></line>
                            </svg>
                            Arquivar Concluídos
                        </button>
                    </div>
                </div>
            </div>
        </div>
        <!-- Fim Página Minha Agenda -->

        <!-- Rodapé Persistente -->
        <div class="rodape">
            <p>
                <a href="#" onclick="baixarCalculadora(); return false;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 5px;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Baixar esta calculadora para compartilhar
                </a>
            </p>
            <p style="margin-top: 10px; color: #9ca3af; font-size: 0.75rem; font-style: italic;">
                ContaPrazo Calculadora v1.4 • 2026 • Um projeto de Italoan F. • <a href="mailto:prazocerto@outlook.com" style="color: #9ca3af; font-size: 0.75rem; font-style: italic; text-decoration: underline;">Entre em Contato</a>
            </p>
        </div>
    </div>

    <!-- Botão scroll to top -->
    <button class="scroll-to-top" id="scrollToTopBtn" onclick="scrollToTop()" aria-label="Voltar ao topo">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
    </button>

    <!-- Modal para selecionar fonte de importação -->
    <div class="modal" id="modalSelecionarFonte">
        <div class="modal-content">
            <div class="modal-header">Importar Feriados</div>
            <div class="modal-body">
                Escolha a origem dos feriados:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="abrirDropdownPredefinidos()">
                    <div class="modal-option-title">☁️ Conjuntos Pré-definidos Online</div>
                    <div class="modal-option-desc">Baixe automaticamente conjuntos de feriados mantidos e atualizados online.</div>
                </div>
                <div class="modal-option" onclick="escolherArquivoLocal()">
                    <div class="modal-option-title">📁 Arquivo Local</div>
                    <div class="modal-option-desc">Importe um arquivo JSON personalizado do seu computador.</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalSelecionarFonte()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para escolher conjunto pré-definido -->
    <div class="modal" id="modalPredefinidos">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">Conjuntos Pré-definidos Online</div>
            <div class="modal-body">
                <div id="listaPredefinidos" style="max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; padding: 20px; color: #6b7280;">
                        Carregando conjuntos disponíveis...
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalPredefinidos()">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Modal para importar feriados -->
    <div class="modal" id="modalImportar">
        <div class="modal-content">
            <div class="modal-header">Importar Feriados</div>
            <div class="modal-body">
                Escolha como deseja importar os feriados:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="finalizarImportacao('substituir')">
                    <div class="modal-option-title">🔄 Substituir</div>
                    <div class="modal-option-desc">Remove todos os feriados personalizados atuais e substitui pelos do arquivo.</div>
                </div>
                <div class="modal-option" onclick="finalizarImportacao('mesclar')">
                    <div class="modal-option-title">➕ Mesclar</div>
                    <div class="modal-option-desc">Mantém os feriados atuais e adiciona os novos do arquivo (sem duplicatas).</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para escolher tipo de export PDF -->
    <div class="modal" id="modalExportPDF">
        <div class="modal-content">
            <div class="modal-header">Exportar PDF</div>
            <div class="modal-body">
                <div style="text-align: center; font-size: 0.85rem; color: #6b7280; margin-bottom: 15px;">
                    Abre a janela de impressão do navegador. Use "Salvar como PDF" para gerar o arquivo.
                </div>
                Escolha o tipo de export PDF:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="finalizarExportPDF('resumido')">
                    <div class="modal-option-title">📄 Resumido</div>
                    <div class="modal-option-desc">Export compacto com visualização gráfica dos dias considerados.</div>
                </div>
                <div class="modal-option" onclick="finalizarExportPDF('completo')">
                    <div class="modal-option-title">📋 Completo</div>
                    <div class="modal-option-desc">Export detalhado com lista completa de todos os dias do período.</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalExportPDF()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para criar novo perfil -->
    <div class="modal" id="modalCriarPerfil">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">Criar Novo Perfil</div>
            <div class="modal-body">
                <p style="font-size: 0.85rem; color: #6b7280; margin-bottom: 15px;">
                    O perfil salvará os <strong id="qtdFeriadosAtuais">0</strong> feriados personalizados atuais.
                </p>
                <div class="modal-input-group">
                    <label for="inputNomePerfil">Nome do perfil (máx. 30 caracteres)</label>
                    <input type="text" id="inputNomePerfil" class="modal-input-small" maxlength="30" placeholder="Ex: TJSP, TJRJ, Escritório X...">
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalCriarPerfil()">Cancelar</button>
                <button class="btn btn-primary" onclick="confirmarCriarPerfil()">Criar Perfil</button>
            </div>
        </div>
    </div>

    <!-- Modal para gerenciar perfis -->
    <div class="modal" id="modalGerenciarPerfis">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">Gerenciar Perfis</div>
            <div class="modal-body">
                <div class="modal-perfis-list" id="listaPerfisModal">
                    <div class="modal-perfis-empty">Nenhum perfil criado ainda.</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalGerenciarPerfis()">Fechar</button>
            </div>
        </div>
    </div>

    <!-- Modal para renomear perfil -->
    <div class="modal" id="modalRenomearPerfil">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">Renomear Perfil</div>
            <div class="modal-body">
                <div class="modal-input-group">
                    <label for="inputRenomearPerfil">Novo nome (máx. 30 caracteres)</label>
                    <input type="text" id="inputRenomearPerfil" class="modal-input-small" maxlength="30">
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalRenomearPerfil()">Cancelar</button>
                <button class="btn btn-primary" onclick="confirmarRenomearPerfil()">Salvar</button>
            </div>
        </div>
    </div>

    <!-- Modal de confirmação para trocar perfil com alterações não salvas -->
    <div class="modal" id="modalConfirmarTrocaPerfil">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">Alterações Não Salvas</div>
            <div class="modal-body">
                <p style="font-size: 0.9rem; color: #374151;">
                    Existem alterações não salvas no perfil atual. Deseja salvar antes de trocar?
                </p>
            </div>
            <div class="modal-buttons" style="justify-content: space-between;">
                <button class="btn btn-secondary" onclick="descartarETrocarPerfil()">Descartar</button>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-secondary" onclick="fecharModalConfirmarTrocaPerfil()">Cancelar</button>
                    <button class="btn btn-primary" onclick="salvarETrocarPerfil()">Salvar e Trocar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para escolher tipo de export PNG -->
    <div class="modal" id="modalExportPNG">
        <div class="modal-content">
            <div class="modal-header">Exportar PNG</div>
            <div class="modal-body">
                Escolha o tipo de export PNG:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="finalizarExportPNG('resumido')">
                    <div class="modal-option-title">🖼️ Resumido</div>
                    <div class="modal-option-desc">Salva uma imagem com as informações principais e visualização gráfica dos dias considerados.</div>
                </div>
                <div class="modal-option" onclick="finalizarExportPNG('completo')">
                    <div class="modal-option-title">📸 Completo</div>
                    <div class="modal-option-desc">Salva uma imagem completa incluindo o detalhamento dia a dia do período.</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalExportPNG()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Estado da aplicação
        let mesAtual = new Date();

        // Carregar feriados personalizados do localStorage com retrocompatibilidade
        let feriadosPersonalizados = new Map();
        const feriadosPersonalizadosStorage = JSON.parse(localStorage.getItem('feriadosPersonalizados') || '[]');

        // Retrocompatibilidade: se for array de strings (formato antigo), converte para Map
        if (Array.isArray(feriadosPersonalizadosStorage)) {
            feriadosPersonalizadosStorage.forEach(item => {
                if (typeof item === 'string') {
                    // Formato antigo: apenas data
                    feriadosPersonalizados.set(item, '');
                } else if (item && typeof item === 'object') {
                    // Formato novo: objeto {data, nome}
                    feriadosPersonalizados.set(item.data, item.nome || '');
                }
            });
        }

        let feriadosFixosAtivos = true;
        let feriadosMoveisAtivos = true;
        let feriadosPersonalizadosAtivos = true;
        let dataInicio = null;
        let diasUteis = null;
        let todosOsDias = [];
        let dataFinal = null;
        let visualizacaoCalendario = 'mensal'; // 'mensal' ou 'anual'
        let usarDiasUteis = true; // true = dias úteis, false = dias corridos
        let descricaoPrazo = '';
        let configImportacaoPendente = null;
        let conjuntoPendenteMetadata = null; // Armazena metadata do conjunto sendo importado
        let calculoRealizado = false; // Controla se já foi feito um cálculo

        // ========================================
        // SISTEMA DE PERFIS DE FERIADOS
        // ========================================
        const PERFIS_STORAGE_KEY = 'contaprazo_perfis';
        const PERFIL_ATIVO_KEY = 'contaprazo_perfil_ativo';
        const MAX_PERFIS = 10;
        const MAX_NOME_PERFIL = 30;

        let perfisData = JSON.parse(localStorage.getItem(PERFIS_STORAGE_KEY) || '[]');
        let perfilAtivoId = localStorage.getItem(PERFIL_ATIVO_KEY) || null;
        let perfilTemAlteracoes = false;
        let perfilPendenteId = null; // ID do perfil para trocar quando há alterações não salvas
        let perfilRenomeandoId = null; // ID do perfil sendo renomeado
        let feriadosSnapshotPerfil = null; // Snapshot dos feriados quando o perfil foi carregado

        function obterSnapshotDePerfilSalvo(perfilId) {
            if (!perfilId) return null;
            const perfil = perfisData.find(p => p.id === perfilId);
            if (!perfil || !perfil.feriados) return null;
            const entries = perfil.feriados
                .filter(f => f && f.data)
                .map(f => [f.data, f.nome || ''])
                .sort((a, b) => a[0].localeCompare(b[0]));
            return JSON.stringify(entries);
        }

        function inicializarPerfis() {
            const importouAntes = sessionStorage.getItem('contaprazo_importou_feriados');
            if (importouAntes) {
                sessionStorage.removeItem('contaprazo_importou_feriados');
                // Não sobrescreve feriados importados - mantém o que veio do localStorage
                // Snapshot vem do perfil salvo (não dos feriados atuais), para detectar divergência
                if (perfilAtivoId) {
                    feriadosSnapshotPerfil = obterSnapshotDePerfilSalvo(perfilAtivoId) || obterSnapshotFeriados();
                } else {
                    feriadosSnapshotPerfil = obterSnapshotFeriados();
                }
            } else if (perfilAtivoId) {
                const perfil = perfisData.find(p => p.id === perfilAtivoId);
                if (perfil) {
                    carregarFeriadosDoPerfil(perfil);
                } else {
                    perfilAtivoId = null;
                    localStorage.removeItem(PERFIL_ATIVO_KEY);
                }
                feriadosSnapshotPerfil = obterSnapshotFeriados();
            } else {
                feriadosSnapshotPerfil = obterSnapshotFeriados();
            }
            atualizarUIPerfilAtivo();
            atualizarDropdownPerfis();
            // Verifica se já há divergência (ex: após importação com perfil ativo)
            verificarAlteracoesPerfil();

            // Mostra notificação pendente do reload anterior (se houver)
            const notifPendente = sessionStorage.getItem('contaprazo_notificacao_pendente');
            if (notifPendente) {
                sessionStorage.removeItem('contaprazo_notificacao_pendente');
                try {
                    const notif = JSON.parse(notifPendente);
                    setTimeout(() => mostrarNotificacao(notif.mensagem, notif.tipo), 300);
                } catch(e) {}
            }
        }

        function obterSnapshotFeriados() {
            return JSON.stringify(
                Array.from(feriadosPersonalizados.entries()).sort((a, b) => a[0].localeCompare(b[0]))
            );
        }

        function verificarAlteracoesPerfil() {
            if (!perfilAtivoId) {
                perfilTemAlteracoes = false;
                atualizarIndicadorAlteracoes();
                return;
            }
            const snapshotAtual = obterSnapshotFeriados();
            perfilTemAlteracoes = (snapshotAtual !== feriadosSnapshotPerfil);
            atualizarIndicadorAlteracoes();
        }

        function atualizarIndicadorAlteracoes() {
            const indicator = document.getElementById('perfilUnsavedIndicator');
            const btnSalvar = document.getElementById('btnSalvarPerfil');
            const pill = document.getElementById('perfilPill');

            if (perfilTemAlteracoes && perfilAtivoId) {
                indicator.classList.add('show');
                btnSalvar.style.display = 'flex';
                pill.classList.add('unsaved');
                pill.classList.remove('active');
            } else {
                indicator.classList.remove('show');
                btnSalvar.style.display = 'none';
                pill.classList.remove('unsaved');
                if (perfilAtivoId) {
                    pill.classList.add('active');
                }
            }
        }

        function atualizarUIPerfilAtivo() {
            const pillText = document.getElementById('perfilPillText');
            const pill = document.getElementById('perfilPill');

            if (perfilAtivoId) {
                const perfil = perfisData.find(p => p.id === perfilAtivoId);
                if (perfil) {
                    pillText.textContent = perfil.nome;
                    pillText.title = perfil.nome;
                    pill.classList.add('active');
                } else {
                    pillText.textContent = 'Nenhum';
                    pillText.title = '';
                    pill.classList.remove('active');
                    perfilAtivoId = null;
                    localStorage.removeItem(PERFIL_ATIVO_KEY);
                }
            } else {
                pillText.textContent = 'Nenhum';
                pillText.title = '';
                pill.classList.remove('active');
            }
            atualizarIndicadorAlteracoes();
        }

        function atualizarDropdownPerfis() {
            const menu = document.getElementById('perfilDropdownMenu');
            let html = '<div class="perfil-dropdown-item none' + (!perfilAtivoId ? ' selected' : '') + '" onclick="selecionarPerfil(null)">Nenhum</div>';

            perfisData.forEach(perfil => {
                const selected = perfil.id === perfilAtivoId ? ' selected' : '';
                const nomeDisplay = perfil.nome.length > 20 ? perfil.nome.substring(0, 20) + '...' : perfil.nome;
                html += '<div class="perfil-dropdown-item' + selected + '" onclick="selecionarPerfil(\'' + perfil.id + '\')" title="' + perfil.nome + '">' + nomeDisplay + '</div>';
            });

            menu.innerHTML = html;
        }

        function togglePerfilDropdown() {
            const menu = document.getElementById('perfilDropdownMenu');
            const arrow = document.getElementById('perfilPillArrow');
            const isOpen = menu.classList.contains('show');

            if (isOpen) {
                menu.classList.remove('show');
                arrow.classList.remove('open');
            } else {
                atualizarDropdownPerfis();
                menu.classList.add('show');
                arrow.classList.add('open');

                // Fecha ao clicar fora
                setTimeout(() => {
                    const fecharDropdown = (e) => {
                        if (!e.target.closest('.perfil-dropdown')) {
                            menu.classList.remove('show');
                            arrow.classList.remove('open');
                            document.removeEventListener('click', fecharDropdown);
                        }
                    };
                    document.addEventListener('click', fecharDropdown);
                }, 10);
            }
        }

        function selecionarPerfil(id) {
            // Fecha dropdown
            document.getElementById('perfilDropdownMenu').classList.remove('show');
            document.getElementById('perfilPillArrow').classList.remove('open');

            // Se é o mesmo perfil, não faz nada
            if (id === perfilAtivoId) return;

            // Se há alterações não salvas no perfil atual, pergunta
            if (perfilTemAlteracoes && perfilAtivoId) {
                perfilPendenteId = id;
                abrirModalConfirmarTrocaPerfil();
                return;
            }

            efetuarTrocaPerfil(id);
        }

        function efetuarTrocaPerfil(id) {
            if (id === null) {
                // Selecionou "Nenhum" - limpa feriados personalizados
                perfilAtivoId = null;
                localStorage.removeItem(PERFIL_ATIVO_KEY);
                feriadosPersonalizados.clear();
                salvarFeriadosNoLocalStorage();
                feriadosSnapshotPerfil = obterSnapshotFeriados();
                perfilTemAlteracoes = false;
            } else {
                const perfil = perfisData.find(p => p.id === id);
                if (perfil) {
                    carregarFeriadosDoPerfil(perfil);
                    perfilAtivoId = id;
                    localStorage.setItem(PERFIL_ATIVO_KEY, id);
                    feriadosSnapshotPerfil = obterSnapshotFeriados();
                    perfilTemAlteracoes = false;
                }
            }

            atualizarUIPerfilAtivo();
            renderizarCalendario();
            mostrarAvisoRecalculo();
        }

        function carregarFeriadosDoPerfil(perfil) {
            feriadosPersonalizados.clear();
            if (perfil.feriados && Array.isArray(perfil.feriados)) {
                perfil.feriados.forEach(item => {
                    if (item && item.data) {
                        feriadosPersonalizados.set(item.data, item.nome || '');
                    }
                });
            }
            // Atualiza localStorage dos feriados
            salvarFeriadosNoLocalStorage();
        }

        function salvarFeriadosNoLocalStorage() {
            const dadosParaSalvar = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                data,
                nome: nome || ''
            }));
            localStorage.setItem('feriadosPersonalizados', JSON.stringify(dadosParaSalvar));
        }

        function salvarPerfisNoLocalStorage() {
            localStorage.setItem(PERFIS_STORAGE_KEY, JSON.stringify(perfisData));
        }

        // === Modais de Perfil ===

        function abrirModalCriarPerfil() {
            if (perfisData.length >= MAX_PERFIS) {
                mostrarNotificacao('Limite de ' + MAX_PERFIS + ' perfis atingido. Exclua um perfil existente antes de criar outro.', 'erro');
                return;
            }
            document.getElementById('qtdFeriadosAtuais').textContent = feriadosPersonalizados.size;
            document.getElementById('inputNomePerfil').value = '';
            document.getElementById('modalCriarPerfil').classList.add('active');
            setTimeout(() => document.getElementById('inputNomePerfil').focus(), 100);
        }

        function fecharModalCriarPerfil() {
            document.getElementById('modalCriarPerfil').classList.remove('active');
        }

        function confirmarCriarPerfil() {
            const nome = document.getElementById('inputNomePerfil').value.trim();
            if (!nome) {
                mostrarNotificacao('Digite um nome para o perfil.', 'erro');
                return;
            }
            if (nome.length > MAX_NOME_PERFIL) {
                mostrarNotificacao('O nome do perfil deve ter no máximo ' + MAX_NOME_PERFIL + ' caracteres.', 'erro');
                return;
            }

            // Verifica duplicatas
            if (perfisData.some(p => p.nome.toLowerCase() === nome.toLowerCase())) {
                mostrarNotificacao('Já existe um perfil com esse nome.', 'erro');
                return;
            }

            const novoPerfil = {
                id: 'perfil_' + Date.now(),
                nome: nome,
                feriados: Array.from(feriadosPersonalizados.entries()).map(([data, nomeFeriado]) => ({
                    data,
                    nome: nomeFeriado || ''
                })),
                criadoEm: new Date().toISOString()
            };

            perfisData.push(novoPerfil);
            salvarPerfisNoLocalStorage();

            // Ativa o perfil recém-criado
            perfilAtivoId = novoPerfil.id;
            localStorage.setItem(PERFIL_ATIVO_KEY, novoPerfil.id);
            feriadosSnapshotPerfil = obterSnapshotFeriados();
            perfilTemAlteracoes = false;

            fecharModalCriarPerfil();
            atualizarUIPerfilAtivo();
            atualizarDropdownPerfis();
            mostrarNotificacao('Perfil "' + nome + '" criado com sucesso!', 'sucesso');
        }

        function abrirModalGerenciarPerfis() {
            renderizarListaPerfis();
            document.getElementById('modalGerenciarPerfis').classList.add('active');
        }

        function fecharModalGerenciarPerfis() {
            document.getElementById('modalGerenciarPerfis').classList.remove('active');
        }

        function renderizarListaPerfis() {
            const container = document.getElementById('listaPerfisModal');

            if (perfisData.length === 0) {
                container.innerHTML = '<div class="modal-perfis-empty">Nenhum perfil criado ainda.</div>';
                return;
            }

            let html = '';
            perfisData.forEach(perfil => {
                const qtdFeriados = perfil.feriados ? perfil.feriados.length : 0;
                const ehAtivo = perfil.id === perfilAtivoId;
                html += '<div class="modal-perfil-item">';
                html += '  <div class="modal-perfil-info">';
                html += '    <span class="modal-perfil-name">' + perfil.nome + (ehAtivo ? ' <span style="color: #3b82f6; font-size: 0.75rem;">(ativo)</span>' : '') + '</span>';
                html += '    <span class="modal-perfil-count">' + qtdFeriados + ' feriado' + (qtdFeriados !== 1 ? 's' : '') + '</span>';
                html += '  </div>';
                html += '  <div class="modal-perfil-actions">';
                html += '    <button class="modal-perfil-btn" onclick="abrirModalRenomearPerfil(\'' + perfil.id + '\')">Renomear</button>';
                html += '    <button class="modal-perfil-btn delete" onclick="excluirPerfil(\'' + perfil.id + '\')">Excluir</button>';
                html += '  </div>';
                html += '</div>';
            });

            container.innerHTML = html;
        }

        function excluirPerfil(id) {
            const perfil = perfisData.find(p => p.id === id);
            if (!perfil) return;

            if (!confirm('Excluir o perfil "' + perfil.nome + '"?\n\nOs feriados carregados atualmente não serão afetados.')) {
                return;
            }

            perfisData = perfisData.filter(p => p.id !== id);
            salvarPerfisNoLocalStorage();

            // Se o perfil excluído era o ativo, desvincula
            if (perfilAtivoId === id) {
                perfilAtivoId = null;
                localStorage.removeItem(PERFIL_ATIVO_KEY);
                feriadosSnapshotPerfil = obterSnapshotFeriados();
                perfilTemAlteracoes = false;
            }

            renderizarListaPerfis();
            atualizarUIPerfilAtivo();
            atualizarDropdownPerfis();
            mostrarNotificacao('Perfil "' + perfil.nome + '" excluído.', 'sucesso');
        }

        function abrirModalRenomearPerfil(id) {
            const perfil = perfisData.find(p => p.id === id);
            if (!perfil) return;

            perfilRenomeandoId = id;
            document.getElementById('inputRenomearPerfil').value = perfil.nome;
            document.getElementById('modalRenomearPerfil').classList.add('active');
            setTimeout(() => document.getElementById('inputRenomearPerfil').focus(), 100);
        }

        function fecharModalRenomearPerfil() {
            document.getElementById('modalRenomearPerfil').classList.remove('active');
            perfilRenomeandoId = null;
        }

        function confirmarRenomearPerfil() {
            const novoNome = document.getElementById('inputRenomearPerfil').value.trim();
            if (!novoNome) {
                mostrarNotificacao('Digite um nome para o perfil.', 'erro');
                return;
            }
            if (novoNome.length > MAX_NOME_PERFIL) {
                mostrarNotificacao('O nome do perfil deve ter no máximo ' + MAX_NOME_PERFIL + ' caracteres.', 'erro');
                return;
            }

            // Verifica duplicatas (excluindo o próprio perfil)
            if (perfisData.some(p => p.id !== perfilRenomeandoId && p.nome.toLowerCase() === novoNome.toLowerCase())) {
                mostrarNotificacao('Já existe um perfil com esse nome.', 'erro');
                return;
            }

            const perfil = perfisData.find(p => p.id === perfilRenomeandoId);
            if (perfil) {
                perfil.nome = novoNome;
                salvarPerfisNoLocalStorage();
                renderizarListaPerfis();
                atualizarUIPerfilAtivo();
                atualizarDropdownPerfis();
                mostrarNotificacao('Perfil renomeado para "' + novoNome + '".', 'sucesso');
            }

            fecharModalRenomearPerfil();
        }

        function salvarAlteracoesPerfil() {
            if (!perfilAtivoId) return;

            const perfil = perfisData.find(p => p.id === perfilAtivoId);
            if (!perfil) return;

            perfil.feriados = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                data,
                nome: nome || ''
            }));

            salvarPerfisNoLocalStorage();
            feriadosSnapshotPerfil = obterSnapshotFeriados();
            perfilTemAlteracoes = false;
            atualizarIndicadorAlteracoes();
            mostrarNotificacao('Alterações salvas no perfil "' + perfil.nome + '".', 'sucesso');
        }

        // === Modal de confirmação de troca com alterações não salvas ===

        function abrirModalConfirmarTrocaPerfil() {
            document.getElementById('modalConfirmarTrocaPerfil').classList.add('active');
        }

        function fecharModalConfirmarTrocaPerfil() {
            document.getElementById('modalConfirmarTrocaPerfil').classList.remove('active');
            perfilPendenteId = null;
        }

        function salvarETrocarPerfil() {
            salvarAlteracoesPerfil();
            fecharModalConfirmarTrocaPerfil();
            const idPendente = perfilPendenteId;
            perfilPendenteId = null;
            efetuarTrocaPerfil(idPendente);
        }

        function descartarETrocarPerfil() {
            fecharModalConfirmarTrocaPerfil();
            perfilTemAlteracoes = false;
            const idPendente = perfilPendenteId;
            perfilPendenteId = null;
            efetuarTrocaPerfil(idPendente);
        }

        // Hook: marcar alterações quando feriados mudam (chamado pelo toggleDia e importação)
        function notificarAlteracaoFeriados() {
            if (perfilAtivoId) {
                verificarAlteracoesPerfil();
            }
        }

        // ========================================
        // VARIÁVEIS DA AGENDA DE PRAZOS
        // ========================================
        let prazos = []; // Array de prazos salvos
        let prazosArquivados = []; // Array de prazos arquivados
        let modoVisualizacao = 'ativos'; // 'ativos' ou 'arquivados'
        let filtroAtual = 'todos'; // Filtro ativo
        let prazoEmEdicao = null; // ID do prazo sendo editado
        let undoState = null; // Estado para desfazer ações
        let undoTimeout = null; // Timeout para limpar undo
        let paginaAtual = 1; // Página atual na lista
        const ITENS_POR_PAGINA = 20; // Limite de itens por página
        const DIAS_PARA_ARQUIVAR = 90; // Dias após conclusão para arquivar automaticamente
        let modoSelecao = false; // Modo de seleção múltipla ativo
        let prazosSelecionados = new Set(); // IDs dos prazos selecionados

        // ========================================
        // CONSTANTES
        // ========================================
        const TEMPOS = {
            PRINT: 500,
            DEBOUNCE_AVISO: 300,
            SCROLL_SUAVE: 100
        };

        const DIMENSOES = {
            BTN_NAV: 32,
            LOGO: 56,
            LOGO_MOBILE: 44,
            LOGO_SMALL: 38,
            EXPORT_WIDTH: 900
        };

        const ESCALAS = {
            HTML2CANVAS: 2,
            CALENDARIO_MOBILE: 0.95,
            CALENDARIO_SMALL: 0.88
        };

        // ========================================
        // FUNÇÕES HELPER
        // ========================================

        // Conversão de formatos de data
        function converterParaFormatoBrasileiro(dataISO) {
            // YYYY-MM-DD → DD-MM-YYYY
            const [ano, mes, dia] = dataISO.split('-');
            return `${dia}-${mes}-${ano}`;
        }

        function converterParaFormatoISO(dataBR) {
            // DD-MM-YYYY → YYYY-MM-DD
            const [dia, mes, ano] = dataBR.split('-');
            return `${ano}-${mes}-${dia}`;
        }

        function converterParaFormatoMesDia(dataBR) {
            // DD-MM → MM-DD (para feriados fixos - formato interno)
            const [dia, mes] = dataBR.split('-');
            return `${mes}-${dia}`;
        }

        function converterMesDiaParaBrasileiro(mesdia) {
            // MM-DD → DD-MM (de formato interno para exibição)
            const [mes, dia] = mesdia.split('-');
            return `${dia}-${mes}`;
        }

        // Obtém nome de feriado de todas as fontes possíveis
        function obterNomeFeriado(data) {
            const dataStr = formatarData(data);
            const dataCompleta = formatarDataCompleta(data);
            const ano = data.getFullYear();

            // Personalizados têm prioridade de nomeação sobre fixos e móveis
            if (feriadosPersonalizadosAtivos && feriadosPersonalizados.has(dataCompleta)) return feriadosPersonalizados.get(dataCompleta) || null;
            if (feriadosFixosAtivos && feriadosFixos[dataStr]) return feriadosFixos[dataStr];
            if (feriadosMoveisAtivos && feriadosMoveis[ano] && feriadosMoveis[ano][dataStr]) return feriadosMoveis[ano][dataStr];

            return null;
        }

        // Cache de seletores DOM
        let cacheDom = null;
        function inicializarCacheDom() {
            const navTabElements = document.querySelectorAll('.nav-tab');
            cacheDom = {
                navTabs: {
                    calculo: navTabElements[0],
                    gerenciamento: navTabElements[1],
                    agenda: navTabElements[2],
                    ajuda: navTabElements[3]
                },
                paginas: {
                    calculo: document.getElementById('paginaCalculo'),
                    gerenciamento: document.getElementById('paginaGerenciamento'),
                    agenda: document.getElementById('paginaAgenda'),
                    ajuda: document.getElementById('paginaAjuda')
                }
            };
        }

        // Controle de avisos (com debounce)
        let avisoRecalculoTimeout = null;
        function mostrarAvisoRecalculo() {
            // Verifica se o usuário optou por não mostrar o aviso
            const naoMostrar = localStorage.getItem('naoMostrarAvisoRecalculo') === 'true';
            if (naoMostrar || !calculoRealizado) return;

            // Debounce: aguarda 300ms antes de mostrar para evitar múltiplos avisos
            clearTimeout(avisoRecalculoTimeout);
            avisoRecalculoTimeout = setTimeout(() => {
                const modal = document.getElementById('modalAvisoRecalculo');
                modal.classList.add('active');
            }, TEMPOS.DEBOUNCE_AVISO);
        }

        function fecharAvisoRecalculo() {
            const modal = document.getElementById('modalAvisoRecalculo');
            const checkbox = document.getElementById('naoMostrarAvisoNovamente');

            // Se o checkbox estiver marcado, salva a preferência
            if (checkbox.checked) {
                localStorage.setItem('naoMostrarAvisoRecalculo', 'true');
            }

            modal.classList.remove('active');
            // Desmarca o checkbox para a próxima vez
            checkbox.checked = false;
        }

        // Controle de reset completo
        function confirmarResetCompleto() {
            const modal = document.getElementById('modalResetCompleto');
            modal.classList.add('active');
        }

        function fecharModalReset() {
            const modal = document.getElementById('modalResetCompleto');
            modal.classList.remove('active');
        }

        function executarResetCompleto() {
            // Limpa feriados personalizados
            feriadosPersonalizados.clear();
            localStorage.removeItem('feriadosPersonalizados');

            // Remove feriados fixos e móveis customizados (volta ao padrão do código)
            localStorage.removeItem('feriadosFixos');
            localStorage.removeItem('feriadosMoveis');

            // Remove preferência de não mostrar aviso
            localStorage.removeItem('naoMostrarAvisoRecalculo');

            // Limpa perfis de feriados
            localStorage.removeItem(PERFIS_STORAGE_KEY);
            localStorage.removeItem(PERFIL_ATIVO_KEY);
            perfisData = [];
            perfilAtivoId = null;

            // Fecha o modal
            fecharModalReset();

            // Marca flags para o reload
            sessionStorage.setItem('reloadToTop', 'true');
            sessionStorage.setItem('contaprazo_notificacao_pendente', JSON.stringify({ mensagem: 'Configurações restauradas com sucesso!', tipo: 'sucesso' }));

            // Recarrega a página para aplicar as configurações padrão
            location.reload();
        }

        // Feriados fixos
        const feriadosFixos = {
            '01-01': 'Ano Novo',
            '04-21': 'Tiradentes',
            '05-01': 'Dia do Trabalho',
            '09-07': 'Independência',
            '10-12': 'Nossa Senhora Aparecida',
            '11-02': 'Finados',
            '11-15': 'Proclamação da República',
            '11-20': 'Consciência Negra',
            '12-25': 'Natal'
        };

        // Feriados móveis
        const feriadosMoveis = {
            2025: {
                '03-03': 'Carnaval (seg)',
                '03-04': 'Carnaval (ter)',
                '04-18': 'Sexta-feira Santa',
                '06-19': 'Corpus Christi'
            },
            2026: {
                '02-16': 'Carnaval (seg)',
                '02-17': 'Carnaval (ter)',
                '04-03': 'Sexta-feira Santa',
                '06-04': 'Corpus Christi'
            }
        };

        function toggleTipoDias() {
            usarDiasUteis = !usarDiasUteis;
            const toggle = document.getElementById('toggleTipoDias');
            const label = document.getElementById('labelTipoDias');

            if (usarDiasUteis) {
                toggle.classList.add('active');
                label.textContent = 'Dias Úteis';
            } else {
                toggle.classList.remove('active');
                label.textContent = 'Dias Corridos';
            }

            // Mostra aviso se já houver cálculo realizado
            mostrarAvisoRecalculo();
        }

        function formatarData(data) {
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const dia = String(data.getDate()).padStart(2, '0');
            return `${mes}-${dia}`;
        }

        function formatarDataCompleta(data) {
            const ano = data.getFullYear();
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const dia = String(data.getDate()).padStart(2, '0');
            return `${ano}-${mes}-${dia}`;
        }

        function ehFimDeSemana(data) {
            const dia = data.getDay();
            return dia === 0 || dia === 6;
        }

        function ehFeriado(data) {
            const dataStr = formatarData(data);
            const dataCompleta = formatarDataCompleta(data);
            const ano = data.getFullYear();

            if (feriadosFixosAtivos && feriadosFixos[dataStr]) return true;
            if (feriadosMoveisAtivos && feriadosMoveis[ano] && feriadosMoveis[ano][dataStr]) return true;
            if (feriadosPersonalizadosAtivos && feriadosPersonalizados.has(dataCompleta)) return true;

            return false;
        }

        function getTipoFeriado(data) {
            const dataStr = formatarData(data);
            const dataCompleta = formatarDataCompleta(data);
            const ano = data.getFullYear();

            if (feriadosFixosAtivos && feriadosFixos[dataStr]) return 'fixo';
            if (feriadosMoveisAtivos && feriadosMoveis[ano] && feriadosMoveis[ano][dataStr]) return 'movel';
            if (feriadosPersonalizadosAtivos && feriadosPersonalizados.has(dataCompleta)) return 'personalizado';

            return null;
        }

        function obterClassesDia(data, baseClass, diasPercorridos, primeiroDiaPercorrido, ultimoDiaPercorrido) {
            const dataStr = formatarDataCompleta(data);
            const ehFds = ehFimDeSemana(data);
            const tipoFeriado = getTipoFeriado(data);
            const ehInicio = dataInicio === dataStr;
            const ehFim = dataFinal && formatarDataCompleta(dataFinal) === dataStr;
            const ehPercorrido = todosOsDias.some(d => d.contado && formatarDataCompleta(d.data) === dataStr);

            let className = baseClass;

            // Adiciona classes de cor - permitindo combinação de fim de semana com feriado
            if (ehFds && tipoFeriado) {
                // Fim de semana + feriado: mantém fundo cinza, mas texto vermelho
                className += ' fim-semana feriado-em-fds';
            } else if (ehFds) {
                className += ' fim-semana';
            } else if (tipoFeriado === 'personalizado') {
                className += ' feriado-personalizado';
            } else if (tipoFeriado) {
                className += ' feriado';
            } else if (ehInicio) {
                className += ' dia-inicio';
            } else if (ehFim) {
                className += ' dia-final';
            } else if (ehPercorrido) {
                className += ' dia-percorrido';
            }

            return { className, ehFds };
        }

        function setDias(dias) {
            document.getElementById('diasUteis').value = dias;
            mostrarAvisoRecalculo();
        }

        function setDataHoje() {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const dia = String(hoje.getDate()).padStart(2, '0');
            document.getElementById('dataInicio').value = `${ano}-${mes}-${dia}`;
            mostrarAvisoRecalculo();
        }

        function calcularPrazo() {
            dataInicio = document.getElementById('dataInicio').value;
            diasUteis = document.getElementById('diasUteis').value;
            descricaoPrazo = document.getElementById('descricaoPrazo').value.trim();

            if (!dataInicio || !diasUteis) {
                mostrarNotificacao('Por favor, preencha a data de início e a quantidade de dias.', 'aviso');
                return;
            }

            const inicio = new Date(dataInicio + 'T00:00:00');
            let diasContados = 0;
            let dataAtual = new Date(inicio);
            todosOsDias = [];
            let contador = 0;

            while (diasContados < parseInt(diasUteis)) {
                dataAtual.setDate(dataAtual.getDate() + 1);

                const ehFds = ehFimDeSemana(dataAtual);
                const ehFer = ehFeriado(dataAtual);

                let motivo = '';
                let contado = false;

                if (usarDiasUteis) {
                    // Modo dias úteis: só conta se não for fim de semana nem feriado
                    if (!ehFds && !ehFer) {
                        diasContados++;
                        contador++;
                        contado = true;
                        motivo = `Dia ${contador}`;
                    } else {
                        // Verifica ambas as condições independentemente
                        const nomeFeriado = obterNomeFeriado(dataAtual);

                        if (ehFds && ehFer) {
                            motivo = `Final de Semana e ${nomeFeriado || 'Feriado'}`;
                        } else if (ehFds) {
                            motivo = 'Final de Semana';
                        } else if (ehFer) {
                            motivo = nomeFeriado || 'Feriado/Ponto Facultativo';
                        }
                    }
                } else {
                    // Modo dias corridos: conta todos os dias
                    diasContados++;
                    contador++;
                    contado = true;

                    // Verifica ambas as condições independentemente
                    const nomeFeriado = obterNomeFeriado(dataAtual);

                    if (ehFds && ehFer) {
                        motivo = `Dia ${contador} - Final de Semana e ${nomeFeriado || 'Feriado'}`;
                    } else if (ehFds) {
                        motivo = `Dia ${contador} - Final de Semana`;
                    } else if (ehFer) {
                        motivo = `Dia ${contador} - ${nomeFeriado || 'Feriado'}`;
                    } else {
                        motivo = `Dia ${contador}`;
                    }
                }

                todosOsDias.push({
                    data: new Date(dataAtual),
                    contado: contado,
                    motivo: motivo,
                    numero: contado ? contador : null
                });
            }

            dataFinal = dataAtual;
            calculoRealizado = true; // Marca que o cálculo foi realizado
            mostrarResultado();
            renderizarCalendario();
            document.getElementById('btnLimpar').style.display = 'inline-flex';

            // Scroll suave até os resultados
            setTimeout(() => {
                const resultadoElement = document.getElementById('resultado');
                if (resultadoElement) {
                    resultadoElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function mostrarResultado() {
            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div class="resultado-descricao">
                        <strong>Descrição:</strong> ${descricaoPrazo}
                    </div>
                `;
            }

            let html = `
                <div class="resultado">
                    <h2>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Resultado do Cálculo
                    </h2>
                    ${descricaoHTML}
                    <div class="resultado-info">
                        <strong>Data de Início:</strong> ${dataInicioFormatada}
                    </div>
                    <div class="resultado-info">
                        <strong>Dias ${tipoDias} Contados:</strong> ${diasUteis}
                    </div>
                    <div class="resultado-info">
                        <strong>Data Final do Prazo:</strong> <span class="data-final">${dataFinalFormatada}</span>
                    </div>

                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-red" onclick="abrirModalExportPDF()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            Exportar PDF
                        </button>
                        <button class="btn btn-indigo" onclick="abrirModalExportPNG()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            Exportar PNG
                        </button>
                    </div>

                    <!-- Separador e Botão Salvar na Agenda -->
                    <div class="resultado-separador">
                        <span class="resultado-separador-texto">GERENCIAR PRAZO</span>
                    </div>
                    <button class="btn-salvar-agenda" onclick="salvarNaAgenda()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                            <polyline points="17 21 17 13 7 13 7 21"/>
                            <polyline points="7 3 7 8 15 8"/>
                        </svg>
                        Salvar na Minha Agenda
                    </button>

                    <div class="detalhamento">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            Detalhamento
                        </h3>
                        ${todosOsDias.map(dia => {
                            const dataFormatada = dia.data.toLocaleDateString('pt-BR', {
                                weekday: 'short',
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric'
                            });

                            if (dia.contado) {
                                return `<div class="dia-item dia-contado">
                                    <span class="dia-numero">${dia.numero}</span>
                                    <span>${dataFormatada}</span>
                                </div>`;
                            } else {
                                return `<div class="dia-item dia-nao-contado">
                                    <span class="dia-numero">X</span>
                                    <span>${dataFormatada} - ${dia.motivo}</span>
                                </div>`;
                            }
                        }).join('')}
                    </div>
                </div>
            `;

            document.getElementById('resultado').innerHTML = html;
            document.getElementById('resultado').style.display = 'block';
        }

        function limparResultado() {
            // Ocultar resultado e botão limpar
            document.getElementById('resultado').style.display = 'none';
            document.getElementById('btnLimpar').style.display = 'none';

            // Limpar campos do formulário
            document.getElementById('dataInicio').value = '';
            document.getElementById('diasUteis').value = '';
            document.getElementById('descricaoPrazo').value = '';

            // Resetar variáveis de estado
            dataInicio = null;
            dataFinal = null;
            todosOsDias = [];
            descricaoPrazo = '';
            calculoRealizado = false; // Resetar flag de cálculo realizado

            // Resetar para dias úteis (padrão)
            usarDiasUteis = true;
            document.getElementById('toggleTipoDias').classList.add('active');
            document.getElementById('labelTipoDias').textContent = 'Dias Úteis';

            renderizarCalendario();
        }

        function toggleFeriados(tipo) {
            const btn = document.getElementById('toggle' + tipo.charAt(0).toUpperCase() + tipo.slice(1));

            if (tipo === 'fixos') {
                feriadosFixosAtivos = !feriadosFixosAtivos;
                btn.className = feriadosFixosAtivos ? 'toggle-btn toggle-ativo' : 'toggle-btn toggle-inativo';
                btn.textContent = (feriadosFixosAtivos ? '✓' : '✗') + ' Feriados Nacionais';
            } else if (tipo === 'moveis') {
                feriadosMoveisAtivos = !feriadosMoveisAtivos;
                btn.className = feriadosMoveisAtivos ? 'toggle-btn toggle-ativo' : 'toggle-btn toggle-inativo';
                btn.textContent = (feriadosMoveisAtivos ? '✓' : '✗') + ' Feriados Móveis';
            } else if (tipo === 'personalizados') {
                feriadosPersonalizadosAtivos = !feriadosPersonalizadosAtivos;
                btn.className = feriadosPersonalizadosAtivos ? 'toggle-btn toggle-ativo' : 'toggle-btn toggle-inativo';
                btn.textContent = (feriadosPersonalizadosAtivos ? '✓' : '✗') + ' Feriados Personalizados';
            }

            renderizarCalendario();

            // Mostra aviso se já houver cálculo realizado
            mostrarAvisoRecalculo();
        }

        function atualizarTextoBotaoVisualizacao() {
            const btnMensal = document.getElementById('btnMensal');
            if (!btnMensal) return;

            // Só atualiza se estiver em visualização mensal
            if (visualizacaoCalendario === 'mensal') {
                const mesesVisiveis = calcularMesesVisiveis();

                switch(mesesVisiveis) {
                    case 3:
                        btnMensal.textContent = 'Trimestral';
                        break;
                    case 2:
                        btnMensal.textContent = 'Bimestral';
                        break;
                    case 1:
                    default:
                        btnMensal.textContent = 'Mensal';
                        break;
                }
            }
        }

        function alternarVisualizacao(tipo) {
            visualizacaoCalendario = tipo;

            document.getElementById('btnMensal').className = tipo === 'mensal' ? 'active' : '';
            document.getElementById('btnAnual').className = tipo === 'anual' ? 'active' : '';

            // Atualizar texto do botão se for mensal
            if (tipo === 'mensal') {
                atualizarTextoBotaoVisualizacao();
            }

            renderizarCalendario();
        }

        function mudarMes(direcao) {
            if (visualizacaoCalendario === 'mensal') {
                const mesesVisiveis = calcularMesesVisiveis();
                // Avançar/retroceder pela quantidade de meses visíveis
                mesAtual = new Date(mesAtual.getFullYear(), mesAtual.getMonth() + (direcao * mesesVisiveis), 1);
            } else {
                mesAtual = new Date(mesAtual.getFullYear() + direcao, 0, 1);
            }
            renderizarCalendario();
        }

        function irParaHoje() {
            mesAtual = new Date();
            renderizarCalendario();
        }

        function toggleConfigFeriados() {
            const content = document.getElementById('configFeriadosContent');
            const icon = document.getElementById('configToggleIcon');

            content.classList.toggle('aberto');
            icon.classList.toggle('aberto');
        }

        function limparFeriadosPersonalizados() {
            if (feriadosPersonalizados.size === 0) {
                mostrarNotificacao('Não há feriados personalizados para limpar.', 'info');
                return;
            }

            const quantidade = feriadosPersonalizados.size;
            if (confirm(`🗑️ Deseja realmente limpar ${quantidade} feriado(s) personalizado(s)?\n\nEsta ação não pode ser desfeita.\n\nA página será recarregada para aplicar as mudanças.`)) {
                feriadosPersonalizados.clear();
                localStorage.setItem('feriadosPersonalizados', JSON.stringify([]));

                // Marca flags para o reload (não altera o perfil salvo — o usuário decide se quer salvar)
                sessionStorage.setItem('reloadToTop', 'true');
                sessionStorage.setItem('contaprazo_importou_feriados', 'true');
                sessionStorage.setItem('contaprazo_notificacao_pendente', JSON.stringify({ mensagem: 'Feriados personalizados limpos com sucesso!', tipo: 'sucesso' }));

                // Recarrega a página para aplicar as configurações
                location.reload();
            }
        }

        function renderizarCalendario() {
            if (visualizacaoCalendario === 'mensal') {
                renderizarCalendarioMensal();
            } else {
                renderizarCalendarioAnual();
            }
        }

        function calcularMesesVisiveis() {
            const largura = window.innerWidth;

            // Desktop: 1 mês
            if (largura > 1023) {
                return 1;
            }
            // Tablets/telas médias: 2 ou 3 meses
            else if (largura >= 800) {
                return 3;
            }
            else if (largura >= 600) {
                return 2;
            }
            // Mobile: 1 mês
            else {
                return 1;
            }
        }

        function renderizarCalendarioMensal() {
            const mesesVisiveis = calcularMesesVisiveis();

            // Identificar primeiro e último dia percorrido
            const diasPercorridos = todosOsDias.filter(d => d.contado).map(d => formatarDataCompleta(d.data));
            const primeiroDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[0] : null;
            const ultimoDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[diasPercorridos.length - 1] : null;

            // Atualizar display do mês/ano
            if (mesesVisiveis === 1) {
                document.getElementById('mesAtual').textContent =
                    mesAtual.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }).toUpperCase();
            } else {
                const mesInicio = mesAtual;
                const mesFim = new Date(mesAtual.getFullYear(), mesAtual.getMonth() + mesesVisiveis - 1, 1);

                if (mesInicio.getFullYear() === mesFim.getFullYear()) {
                    const mesInicioNome = mesInicio.toLocaleDateString('pt-BR', { month: 'short' });
                    const mesFimNome = mesFim.toLocaleDateString('pt-BR', { month: 'short' });
                    document.getElementById('mesAtual').textContent =
                        `${mesInicioNome.toUpperCase()} - ${mesFimNome.toUpperCase()} ${mesInicio.getFullYear()}`;
                } else {
                    const mesInicioCompleto = mesInicio.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' });
                    const mesFimCompleto = mesFim.toLocaleDateString('pt-BR', { month: 'short', year: 'numeric' });
                    document.getElementById('mesAtual').textContent =
                        `${mesInicioCompleto.toUpperCase()} - ${mesFimCompleto.toUpperCase()}`;
                }
            }

            // Renderizar meses
            let htmlContainer = '';

            for (let i = 0; i < mesesVisiveis; i++) {
                const mesRenderizar = new Date(mesAtual.getFullYear(), mesAtual.getMonth() + i, 1);
                const ano = mesRenderizar.getFullYear();
                const mes = mesRenderizar.getMonth();
                const primeiroDia = new Date(ano, mes, 1);
                const ultimoDia = new Date(ano, mes + 1, 0);
                const diasNoMes = ultimoDia.getDate();
                const diaSemanaInicio = primeiroDia.getDay();

                let htmlMes = '';

                // Título do mês (apenas se múltiplos meses)
                if (mesesVisiveis > 1) {
                    const nomeMes = mesRenderizar.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' });
                    htmlMes += `<h4>${nomeMes.toUpperCase()}</h4>`;
                }

                htmlMes += '<div class="calendario-grid">';

                // Dias da semana
                htmlMes += ['DOM', 'SEG', 'TER', 'QUA', 'QUI', 'SEX', 'SÁB'].map(dia =>
                    `<div class="calendario-dia-semana">${dia}</div>`
                ).join('');

                // Espaços vazios antes do primeiro dia
                for (let j = 0; j < diaSemanaInicio; j++) {
                    htmlMes += '<div></div>';
                }

                // Dias do mês
                for (let dia = 1; dia <= diasNoMes; dia++) {
                    const data = new Date(ano, mes, dia);
                    const dataStr = formatarDataCompleta(data);
                    const { className, ehFds } = obterClassesDia(data, 'calendario-dia', diasPercorridos, primeiroDiaPercorrido, ultimoDiaPercorrido);
                    const onclick = ehFds ? '' : `onclick="toggleDia('${dataStr}')"`;
                    htmlMes += `<div class="${className}" ${onclick}>${dia}</div>`;
                }

                htmlMes += '</div>';

                if (mesesVisiveis > 1) {
                    htmlContainer += `<div class="mes-container">${htmlMes}</div>`;
                } else {
                    htmlContainer = htmlMes;
                }
            }

            const gridElement = document.getElementById('calendarioGrid');
            if (mesesVisiveis > 1) {
                gridElement.innerHTML = htmlContainer;
                gridElement.className = `calendario-multi-meses meses-${mesesVisiveis}`;
            } else {
                gridElement.innerHTML = htmlContainer;
                gridElement.className = 'calendario-single';
            }
        }

        function renderizarCalendarioAnual() {
            const ano = mesAtual.getFullYear();

            // Identificar primeiro e último dia percorrido
            const diasPercorridos = todosOsDias.filter(d => d.contado).map(d => formatarDataCompleta(d.data));
            const primeiroDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[0] : null;
            const ultimoDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[diasPercorridos.length - 1] : null;

            document.getElementById('mesAtual').textContent = ano.toString();

            let html = '';

            for (let mes = 0; mes < 12; mes++) {
                const primeiroDia = new Date(ano, mes, 1);
                const ultimoDia = new Date(ano, mes + 1, 0);
                const diasNoMes = ultimoDia.getDate();
                const diaSemanaInicio = primeiroDia.getDay();

                const nomeMes = new Date(ano, mes, 1).toLocaleDateString('pt-BR', { month: 'long' });

                html += `<div class="mes-mini">`;
                html += `<h4>${nomeMes.toUpperCase()}</h4>`;
                html += `<div class="calendario-mini-grid">`;

                // Dias da semana
                ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].forEach(dia => {
                    html += `<div class="calendario-mini-dia-semana">${dia}</div>`;
                });

                // Espaços vazios antes do primeiro dia
                for (let i = 0; i < diaSemanaInicio; i++) {
                    html += '<div></div>';
                }

                // Dias do mês
                for (let dia = 1; dia <= diasNoMes; dia++) {
                    const data = new Date(ano, mes, dia);
                    const dataStr = formatarDataCompleta(data);
                    const { className, ehFds } = obterClassesDia(data, 'calendario-mini-dia', diasPercorridos, primeiroDiaPercorrido, ultimoDiaPercorrido);
                    const onclick = ehFds ? '' : `onclick="toggleDia('${dataStr}')"`;
                    html += `<div class="${className}" ${onclick}>${dia}</div>`;
                }

                html += `</div></div>`;
            }

            document.getElementById('calendarioGrid').innerHTML = html;
            document.getElementById('calendarioGrid').className = 'calendario-anual';
        }

        function toggleDia(dataStr) {
            if (feriadosPersonalizados.has(dataStr)) {
                feriadosPersonalizados.delete(dataStr);
            } else {
                // Adiciona sem nome (usuário pode editar depois no Editor de Feriados)
                feriadosPersonalizados.set(dataStr, '');
            }

            // Salva no formato novo: array de objetos {data, nome}
            const dadosParaSalvar = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                data,
                nome: nome || ''
            }));
            localStorage.setItem('feriadosPersonalizados', JSON.stringify(dadosParaSalvar));
            renderizarCalendario();

            // Notifica o sistema de perfis sobre alteração
            notificarAlteracaoFeriados();

            // Mostra aviso se já houver cálculo realizado
            mostrarAvisoRecalculo();
        }

        function exportarFeriados() {
            // Solicita nome personalizado para o arquivo
            const nomePersonalizado = prompt('Digite um nome para o arquivo (sem extensão):\n\nDeixe em branco para usar o nome padrão.', '');

            // Se usuário cancelar, interrompe a exportação
            if (nomePersonalizado === null) {
                return;
            }

            // Converte feriados personalizados para formato brasileiro DD-MM-YYYY Nome
            const feriadosBrasileiro = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => {
                const [ano, mes, dia] = data.split('-');
                const dataFormatada = `${dia}-${mes}-${ano}`;
                // Se tiver nome, inclui; senão, só a data
                return nome ? `${dataFormatada} ${nome}` : dataFormatada;
            });

            const config = {
                feriadosPersonalizados: feriadosBrasileiro,
                dataExportacao: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;

            // Usa nome personalizado ou padrão
            const nomeArquivo = nomePersonalizado.trim() ?
                `${nomePersonalizado.trim()}.json` :
                `feriados-${Date.now()}.json`;
            link.download = nomeArquivo;

            link.click();
            URL.revokeObjectURL(url);
        }

        function importarFeriados(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const config = JSON.parse(e.target.result);
                    configImportacaoPendente = config;
                    document.getElementById('modalImportar').classList.add('active');
                } catch (error) {
                    mostrarNotificacao('Erro ao importar configuração. Verifique o arquivo.', 'erro');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function finalizarImportacao(tipo) {
            if (!configImportacaoPendente) return;

            // Converte datas do formato brasileiro DD-MM-YYYY Nome para formato interno {data: YYYY-MM-DD, nome: Nome}
            // Também aceita formatos antigos para retrocompatibilidade
            const converterParaInterno = (datas) => {
                return datas.map(item => {
                    // Se for string, pode ser "DD-MM-YYYY Nome" ou só "DD-MM-YYYY"
                    if (typeof item === 'string') {
                        // Tenta extrair data e nome usando regex
                        // Formato esperado: DD-MM-YYYY seguido opcionalmente por espaço e nome
                        const matchComNome = item.match(/^(\d{2})-(\d{2})-(\d{4})\s+(.+)$/);
                        const matchSemNome = item.match(/^(\d{2})-(\d{2})-(\d{4})$/);

                        if (matchComNome) {
                            // Formato: DD-MM-YYYY Nome
                            const [, dia, mes, ano, nome] = matchComNome;
                            return {
                                data: `${ano}-${mes}-${dia}`,
                                nome: nome.trim()
                            };
                        } else if (matchSemNome) {
                            // Formato: DD-MM-YYYY (sem nome)
                            const [, dia, mes, ano] = matchSemNome;
                            return {
                                data: `${ano}-${mes}-${dia}`,
                                nome: ''
                            };
                        } else {
                            // Tenta formato YYYY-MM-DD (retrocompatibilidade)
                            const matchYMD = item.match(/^(\d{4})-(\d{2})-(\d{2})$/);
                            if (matchYMD) {
                                return {
                                    data: item,
                                    nome: ''
                                };
                            }
                        }
                    }

                    // Formato já convertido: retorna como está
                    return item;
                });
            };

            const dadosConvertidos = converterParaInterno(configImportacaoPendente.feriadosPersonalizados);
            const quantidade = dadosConvertidos.length;

            let msgNotificacao = '';
            if (tipo === 'substituir') {
                feriadosPersonalizados.clear();
                dadosConvertidos.forEach(item => {
                    if (item && item.data) {
                        feriadosPersonalizados.set(item.data, item.nome || '');
                    }
                });
                msgNotificacao = `Feriados substituídos com sucesso! ${quantidade} data(s) importada(s).`;
            } else if (tipo === 'mesclar') {
                dadosConvertidos.forEach(item => {
                    if (item && item.data) {
                        feriadosPersonalizados.set(item.data, item.nome || '');
                    }
                });
                msgNotificacao = `Feriados mesclados com sucesso! ${quantidade} data(s) importada(s).`;
            }

            // Salva no formato novo: array de objetos {data, nome}
            const dadosParaSalvar = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                data,
                nome: nome || ''
            }));
            localStorage.setItem('feriadosPersonalizados', JSON.stringify(dadosParaSalvar));

            // Salva metadata do conjunto importado (se for de um conjunto predefinido)
            if (conjuntoPendenteMetadata) {
                salvarMetadataConjunto(
                    conjuntoPendenteMetadata.nome,
                    conjuntoPendenteMetadata.arquivo,
                    conjuntoPendenteMetadata.dataAtualizacao
                );
            }

            fecharModal();

            // Marca flags para o reload
            sessionStorage.setItem('reloadToTop', 'true');
            sessionStorage.setItem('contaprazo_importou_feriados', 'true');
            sessionStorage.setItem('contaprazo_notificacao_pendente', JSON.stringify({ mensagem: msgNotificacao, tipo: 'sucesso' }));

            // Recarrega a página para aplicar as configurações
            location.reload();
        }

        function fecharModal() {
            document.getElementById('modalImportar').classList.remove('active');
            configImportacaoPendente = null;
            conjuntoPendenteMetadata = null; // Limpa metadata pendente
        }

        // ==================== IMPORTAÇÃO DE CONJUNTOS PRÉ-DEFINIDOS ====================

        // Constantes
        const GITHUB_RAW_BASE_URL = 'https://raw.githubusercontent.com/italoanfreitas-ui/contaprazo/main/feriados-predefinidos';

        // Funções auxiliares
        function adicionarCacheBusting(url) {
            const timestamp = new Date().getTime();
            const separator = url.includes('?') ? '&' : '?';
            return `${url}${separator}t=${timestamp}`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function mostrarMensagemLoading(elemento, mensagem) {
            elemento.innerHTML = `<div style="text-align: center; padding: 20px; color: #6b7280;">${escapeHtml(mensagem)}</div>`;
        }

        function mostrarMensagemErro(elemento, mensagem) {
            elemento.innerHTML = `<div style="text-align: center; padding: 20px; color: #ef4444;">❌ ${escapeHtml(mensagem)}</div>`;
        }

        // Funções principais
        function abrirModalSelecionarFonte() {
            document.getElementById('modalSelecionarFonte').classList.add('active');
        }

        function fecharModalSelecionarFonte() {
            document.getElementById('modalSelecionarFonte').classList.remove('active');
        }

        function escolherArquivoLocal() {
            fecharModalSelecionarFonte();
            document.getElementById('importarFeriados').click();
        }

        async function abrirDropdownPredefinidos() {
            fecharModalSelecionarFonte();
            document.getElementById('modalPredefinidos').classList.add('active');

            const listaPredefinidos = document.getElementById('listaPredefinidos');
            mostrarMensagemLoading(listaPredefinidos, 'Carregando conjuntos disponíveis...');

            try {
                // Busca manifest.json com cache-busting
                const manifestUrl = adicionarCacheBusting(`${GITHUB_RAW_BASE_URL}/manifest.json`);
                const response = await fetch(manifestUrl);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const manifest = await response.json();

                if (!manifest.conjuntos || manifest.conjuntos.length === 0) {
                    mostrarMensagemLoading(listaPredefinidos, 'Nenhum conjunto disponível no momento.');
                    return;
                }

                // Renderiza os itens usando map().join() (mais eficiente que +=)
                const html = manifest.conjuntos.map(conjunto => {
                    const urlArquivo = `${GITHUB_RAW_BASE_URL}/${conjunto.arquivo}`;
                    return `
                        <div class="item-predefinido"
                             data-url="${escapeHtml(urlArquivo)}"
                             data-nome="${escapeHtml(conjunto.nome)}"
                             data-arquivo="${escapeHtml(conjunto.arquivo)}"
                             data-data-atualizacao="${escapeHtml(conjunto.dataAtualizacao)}">
                            <div class="item-predefinido-nome">${escapeHtml(conjunto.nome)}</div>
                            <div class="item-predefinido-desc">${escapeHtml(conjunto.descricao)}</div>
                            <div class="item-predefinido-data">📅 Atualizado em: ${escapeHtml(conjunto.dataAtualizacao)}</div>
                        </div>
                    `;
                }).join('');

                listaPredefinidos.innerHTML = html;

                // Event delegation: adiciona listener único no container
                listaPredefinidos.querySelectorAll('.item-predefinido').forEach(item => {
                    item.addEventListener('click', function() {
                        importarFeriadoPredefinido(
                            this.dataset.url,
                            this.dataset.nome,
                            this.dataset.arquivo,
                            this.dataset.dataAtualizacao
                        );
                    });
                });

            } catch (error) {
                console.error('Erro ao carregar conjuntos pré-definidos:', error);
                mostrarMensagemErro(listaPredefinidos, `Erro ao carregar conjuntos pré-definidos.\nVerifique sua conexão com a internet.`);
            }
        }

        function fecharModalPredefinidos() {
            document.getElementById('modalPredefinidos').classList.remove('active');
            abrirModalSelecionarFonte();
        }

        async function importarFeriadoPredefinido(url, nome, arquivo = null, dataAtualizacao = null) {
            const listaPredefinidos = document.getElementById('listaPredefinidos');
            mostrarMensagemLoading(listaPredefinidos, `⏳ Baixando ${nome}...`);

            try {
                // Busca o JSON com cache-busting
                const urlComCacheBusting = adicionarCacheBusting(url);
                const response = await fetch(urlComCacheBusting);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const config = await response.json();

                // Valida estrutura básica do JSON
                if (!config.feriadosPersonalizados || !Array.isArray(config.feriadosPersonalizados)) {
                    throw new Error('Formato de arquivo inválido');
                }

                // Fecha o modal de pré-definidos e abre o modal de importação
                document.getElementById('modalPredefinidos').classList.remove('active');

                // Define a configuração pendente e abre o modal de substituir/mesclar
                configImportacaoPendente = config;

                // Armazena metadata do conjunto sendo importado
                if (arquivo && dataAtualizacao) {
                    conjuntoPendenteMetadata = {
                        nome: nome,
                        arquivo: arquivo,
                        dataAtualizacao: dataAtualizacao
                    };
                } else {
                    conjuntoPendenteMetadata = null;
                }

                document.getElementById('modalImportar').classList.add('active');

            } catch (error) {
                console.error('Erro ao importar conjunto pré-definido:', error);
                mostrarMensagemErro(listaPredefinidos, `Erro ao baixar o conjunto.\nTente novamente mais tarde.`);

                // Volta para a lista após 2 segundos
                setTimeout(() => {
                    abrirDropdownPredefinidos();
                }, 2000);
            }
        }

        // ==================== VERIFICAÇÃO DE ATUALIZAÇÕES DE FERIADOS ====================

        // Variável global para armazenar as atualizações disponíveis
        let atualizacoesDisponiveis = [];

        // Constantes de configuração
        const INTERVALO_VERIFICACAO = 6 * 60 * 60 * 1000; // 6 horas em milissegundos
        let intervaloVerificacaoId = null;

        // Funções de gerenciamento de metadata no localStorage

        function obterMetadataConjuntos() {
            try {
                const metadata = localStorage.getItem('conjuntosPredefinidosImportados');
                return metadata ? JSON.parse(metadata) : [];
            } catch (error) {
                console.error('Erro ao obter metadata de conjuntos:', error);
                return [];
            }
        }

        function salvarMetadataConjunto(nome, arquivo, dataAtualizacao) {
            try {
                const metadata = obterMetadataConjuntos();

                // Remove entrada anterior se existir
                const novaMetadata = metadata.filter(item => item.arquivo !== arquivo);

                // Adiciona nova entrada
                novaMetadata.push({
                    nome: nome,
                    arquivo: arquivo,
                    dataAtualizacao: dataAtualizacao,
                    dataImportacao: new Date().toISOString()
                });

                localStorage.setItem('conjuntosPredefinidosImportados', JSON.stringify(novaMetadata));
            } catch (error) {
                console.error('Erro ao salvar metadata de conjunto:', error);
            }
        }

        // Função principal para verificar atualizações
        async function verificarAtualizacoesFeriados(mostrarFeedback = false) {
            try {
                // Busca o manifest online
                const manifestUrl = adicionarCacheBusting(`${GITHUB_RAW_BASE_URL}/manifest.json`);
                const response = await fetch(manifestUrl);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const manifestOnline = await response.json();

                if (!manifestOnline.conjuntos || manifestOnline.conjuntos.length === 0) {
                    if (mostrarFeedback) {
                        mostrarBannerInformativo(
                            'Nenhum conjunto disponível',
                            'Não há conjuntos de feriados disponíveis no momento.',
                            'ℹ️'
                        );
                    }
                    return;
                }

                // Obtém metadata dos conjuntos importados localmente
                const metadataLocal = obterMetadataConjuntos();

                // Se não há conjuntos importados, verifica se há atualizações gerais
                if (metadataLocal.length === 0) {
                    // Usuário não importou nenhum conjunto ainda
                    // Mostra notificação genérica apenas se há conjuntos disponíveis
                    if (mostrarFeedback) {
                        const totalConjuntos = manifestOnline.conjuntos.length;
                        mostrarBannerInformativo(
                            'Conjuntos disponíveis',
                            `Há <strong>${totalConjuntos} conjunto(s)</strong> de feriados disponível(is) para importação.<br>
                            <small style="color: #9ca3af;">Acesse "Gerenciamento" → "Importar/Exportar" → "Importar de Fonte" para ver os conjuntos disponíveis.</small>`,
                            'ℹ️'
                        );
                    }
                    return;
                }

                // Compara versões
                const conjuntosAtualizados = [];

                metadataLocal.forEach(metadataItem => {
                    // Procura o conjunto correspondente no manifest online
                    const conjuntoOnline = manifestOnline.conjuntos.find(
                        c => c.arquivo === metadataItem.arquivo
                    );

                    if (conjuntoOnline) {
                        // Compara as datas de atualização
                        if (conjuntoOnline.dataAtualizacao !== metadataItem.dataAtualizacao) {
                            conjuntosAtualizados.push({
                                nome: conjuntoOnline.nome,
                                arquivo: conjuntoOnline.arquivo,
                                descricao: conjuntoOnline.descricao,
                                dataAtualizacaoNova: conjuntoOnline.dataAtualizacao,
                                dataAtualizacaoAntiga: metadataItem.dataAtualizacao,
                                url: `${GITHUB_RAW_BASE_URL}/${conjuntoOnline.arquivo}`
                            });
                        }
                    }
                });

                // Armazena as atualizações disponíveis globalmente
                atualizacoesDisponiveis = conjuntosAtualizados;

                // Mostra feedback
                if (conjuntosAtualizados.length > 0) {
                    mostrarBannerAtualizacao(conjuntosAtualizados);
                } else if (mostrarFeedback) {
                    mostrarBannerInformativo(
                        'Tudo atualizado!',
                        'Todos os seus conjuntos de feriados estão atualizados.',
                        '✅'
                    );
                }

            } catch (error) {
                console.error('Erro ao verificar atualizações de feriados:', error);
                if (mostrarFeedback) {
                    mostrarBannerInformativo(
                        'Erro ao verificar atualizações',
                        'Não foi possível verificar as atualizações. Verifique sua conexão com a internet e tente novamente.',
                        '❌',
                        false // Não auto-fecha em caso de erro
                    );
                }
            }
        }

        // Função para mostrar o banner de atualização
        function mostrarBannerAtualizacao(conjuntosAtualizados) {
            const banner = document.getElementById('updateBanner');
            const title = document.getElementById('updateBannerTitle');
            const description = document.getElementById('updateBannerDescription');

            // Verifica se o banner já foi fechado nesta sessão
            const bannerFechadoNaSessao = sessionStorage.getItem('updateBannerClosed');
            if (bannerFechadoNaSessao === 'true') {
                return; // Não mostra o banner se foi fechado nesta sessão
            }

            if (conjuntosAtualizados.length === 1) {
                const conjunto = conjuntosAtualizados[0];
                title.textContent = `Nova atualização disponível`;
                description.innerHTML = `
                    O conjunto <strong>${escapeHtml(conjunto.nome)}</strong> foi atualizado em ${escapeHtml(conjunto.dataAtualizacaoNova)}.<br>
                    <small style="color: #9ca3af;">Atualizar seus feriados evita erros nos cálculos de prazos.</small>
                `;
            } else {
                title.textContent = `${conjuntosAtualizados.length} atualizações disponíveis`;
                const nomes = conjuntosAtualizados.map(c => escapeHtml(c.nome)).join(', ');
                description.innerHTML = `
                    Os seguintes conjuntos foram atualizados: <strong>${nomes}</strong>.<br>
                    <small style="color: #9ca3af;">Atualizar seus feriados evita erros nos cálculos de prazos.</small>
                `;
            }

            banner.classList.add('active');
        }

        // Função para mostrar mensagem informativa no banner (sem botão de atualizar)
        function mostrarBannerInformativo(titulo, mensagem, icone = '💡', autoFechar = true) {
            const banner = document.getElementById('updateBanner');
            const title = document.getElementById('updateBannerTitle');
            const description = document.getElementById('updateBannerDescription');
            const actions = banner.querySelector('.update-banner-actions');
            const iconElement = banner.querySelector('.update-banner-icon');

            // Atualiza conteúdo
            title.textContent = titulo;
            description.innerHTML = mensagem;
            iconElement.textContent = icone;

            // Esconde botões de ação
            actions.style.display = 'none';

            // Mostra o banner
            banner.classList.add('active');

            // Auto-fecha após 5 segundos se especificado
            if (autoFechar) {
                setTimeout(() => {
                    fecharBannerInformativo();
                }, 5000);
            }
        }

        // Função para fechar banner informativo e restaurar estado original
        function fecharBannerInformativo() {
            const banner = document.getElementById('updateBanner');
            const actions = banner.querySelector('.update-banner-actions');
            const iconElement = banner.querySelector('.update-banner-icon');

            // Adiciona classe de animação de saída
            banner.classList.add('hiding');

            // Remove o banner após a animação
            setTimeout(() => {
                banner.classList.remove('active', 'hiding');
                actions.style.display = 'flex';
                iconElement.textContent = '🔔';
            }, 400); // Duração da animação slideUpFade
        }

        // Função para fechar o banner
        function fecharBannerAtualizacao() {
            const banner = document.getElementById('updateBanner');
            const actions = banner.querySelector('.update-banner-actions');

            // Verifica se é um banner informativo (botões escondidos)
            const ehBannerInformativo = actions.style.display === 'none';

            if (ehBannerInformativo) {
                fecharBannerInformativo();
            } else {
                // Adiciona classe de animação de saída
                banner.classList.add('hiding');

                // Remove o banner após a animação
                setTimeout(() => {
                    banner.classList.remove('active', 'hiding');
                }, 400); // Duração da animação slideUpFade

                // Salva no sessionStorage para não mostrar novamente nesta sessão
                sessionStorage.setItem('updateBannerClosed', 'true');
            }
        }

        // Função para atualizar feriados a partir do banner
        function atualizarFeriadosAPartirDoBanner() {
            if (atualizacoesDisponiveis.length === 0) {
                mostrarNotificacao('Nenhuma atualização disponível.', 'info');
                return;
            }

            // Fecha o banner
            fecharBannerAtualizacao();

            // Se há apenas uma atualização, importa diretamente
            if (atualizacoesDisponiveis.length === 1) {
                const conjunto = atualizacoesDisponiveis[0];
                importarFeriadoPredefinido(conjunto.url, conjunto.nome, conjunto.arquivo, conjunto.dataAtualizacaoNova);
            } else {
                // Se há múltiplas atualizações, abre o modal de seleção
                abrirModalPredefinidosComAtualizacoes();
            }
        }

        // Função para abrir modal de predefinidos com destaque nas atualizações
        async function abrirModalPredefinidosComAtualizacoes() {
            document.getElementById('modalPredefinidos').classList.add('active');

            const listaPredefinidos = document.getElementById('listaPredefinidos');
            mostrarMensagemLoading(listaPredefinidos, 'Carregando conjuntos disponíveis...');

            try {
                const manifestUrl = adicionarCacheBusting(`${GITHUB_RAW_BASE_URL}/manifest.json`);
                const response = await fetch(manifestUrl);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const manifest = await response.json();

                if (!manifest.conjuntos || manifest.conjuntos.length === 0) {
                    mostrarMensagemLoading(listaPredefinidos, 'Nenhum conjunto disponível no momento.');
                    return;
                }

                // Renderiza os itens, destacando os atualizados
                const arquivosAtualizados = atualizacoesDisponiveis.map(a => a.arquivo);

                const html = manifest.conjuntos.map(conjunto => {
                    const urlArquivo = `${GITHUB_RAW_BASE_URL}/${conjunto.arquivo}`;
                    const isAtualizado = arquivosAtualizados.includes(conjunto.arquivo);
                    const badgeAtualizado = isAtualizado ? '<span style="background: #16a34a; color: white; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; margin-left: 8px;">ATUALIZADO</span>' : '';

                    return `
                        <div class="item-predefinido"
                             data-url="${escapeHtml(urlArquivo)}"
                             data-nome="${escapeHtml(conjunto.nome)}"
                             data-arquivo="${escapeHtml(conjunto.arquivo)}"
                             data-data-atualizacao="${escapeHtml(conjunto.dataAtualizacao)}"
                             style="${isAtualizado ? 'border-left: 4px solid #16a34a;' : ''}">
                            <div class="item-predefinido-nome">${escapeHtml(conjunto.nome)}${badgeAtualizado}</div>
                            <div class="item-predefinido-desc">${escapeHtml(conjunto.descricao)}</div>
                            <div class="item-predefinido-data">📅 Atualizado em: ${escapeHtml(conjunto.dataAtualizacao)}</div>
                        </div>
                    `;
                }).join('');

                listaPredefinidos.innerHTML = html;

                listaPredefinidos.querySelectorAll('.item-predefinido').forEach(item => {
                    item.addEventListener('click', function() {
                        importarFeriadoPredefinido(
                            this.dataset.url,
                            this.dataset.nome,
                            this.dataset.arquivo,
                            this.dataset.dataAtualizacao
                        );
                    });
                });

            } catch (error) {
                console.error('Erro ao carregar conjuntos pré-definidos:', error);
                mostrarMensagemErro(listaPredefinidos, `Erro ao carregar conjuntos pré-definidos.\nVerifique sua conexão com a internet.`);
            }
        }

        // Função para iniciar a verificação periódica
        function iniciarVerificacaoPeriodica() {
            // Limpa qualquer intervalo anterior
            if (intervaloVerificacaoId) {
                clearInterval(intervaloVerificacaoId);
            }

            // Verifica imediatamente ao carregar
            verificarAtualizacoesFeriados(false);

            // Configura verificação periódica
            intervaloVerificacaoId = setInterval(() => {
                verificarAtualizacoesFeriados(false);
            }, INTERVALO_VERIFICACAO);
        }

        // Função chamada ao finalizar importação - salva metadata
        function salvarMetadataAposImportacao(nomeConjunto, arquivoConjunto, dataAtualizacaoConjunto) {
            salvarMetadataConjunto(nomeConjunto, arquivoConjunto, dataAtualizacaoConjunto);
        }

        function abrirModalExportPDF() {
            if (!dataFinal) {
                mostrarNotificacao('Calcule um prazo primeiro para exportar.', 'aviso');
                return;
            }
            document.getElementById('modalExportPDF').classList.add('active');
        }

        function fecharModalExportPDF() {
            document.getElementById('modalExportPDF').classList.remove('active');
        }

        function finalizarExportPDF(tipo) {
            fecharModalExportPDF();
            if (tipo === 'resumido') {
                exportarPDFResumido();
            } else {
                exportarPDFCompleto();
            }
        }

        function abrirModalExportPNG() {
            if (!dataFinal) {
                mostrarNotificacao('Calcule um prazo primeiro para exportar.', 'aviso');
                return;
            }
            document.getElementById('modalExportPNG').classList.add('active');
        }

        function fecharModalExportPNG() {
            document.getElementById('modalExportPNG').classList.remove('active');
        }

        function finalizarExportPNG(tipo) {
            fecharModalExportPNG();
            if (tipo === 'resumido') {
                exportarImagemResumo();
            } else {
                exportarImagemCompleta();
            }
        }

        // ==================== FUNÇÕES AUXILIARES PARA EXPORTS ====================

        /**
         * Gera o cabeçalho HTML padronizado para exports PDF/PNG
         * @param {Object} params - Parâmetros do cabeçalho
         * @param {string} params.dataInicioFormatada - Data inicial formatada
         * @param {string} params.dataFinalFormatada - Data final formatada
         * @param {string} params.tipoDias - "Úteis" ou "Corridos"
         * @param {number} params.diasContados - Quantidade de dias contados
         * @param {string} params.descricaoHTML - HTML da descrição (opcional)
         * @param {string} params.conteudoEspecifico - HTML do conteúdo específico (visualização ou lista)
         * @param {string} params.diasVisuaisHTML - HTML da visualização dos dias (opcional, para incluir dentro do header)
         * @param {string} params.estilosAdicionais - CSS adicional (opcional)
         * @returns {string} HTML completo do documento
         */
        function gerarCabecalhoExportHTML(params) {
            const {
                dataInicioFormatada,
                dataFinalFormatada,
                tipoDias,
                diasContados,
                descricaoHTML = '',
                conteudoEspecifico,
                diasVisuaisHTML = '',
                estilosAdicionais = ''
            } = params;

            return `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cálculo de Prazo - ContaPrazo</title>
    <style>
        body { font-family: system-ui; padding: 30px; max-width: 900px; margin: 0 auto; }
        .brand-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .logo-cp { width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #16a34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 20px; color: white; }
        .brand-title { font-size: 1.8rem; font-weight: 700; display: flex; align-items: center; gap: 10px; margin: 0 !important; padding: 0 !important; line-height: 1; height: fit-content; }
        .brand-name { display: flex; align-items: center; line-height: 1; }
        .brand-conta { color: #3b82f6; display: inline-flex; align-items: center; line-height: 1; margin: 0; padding: 0; }
        .brand-prazo { color: #16a34a; display: inline-flex; align-items: center; line-height: 1; margin: 0; padding: 0; }
        .brand-separator { color: #d1d5db; font-weight: 300; margin: 0; padding: 0; line-height: 1; display: inline-flex; align-items: center; }
        .brand-subtitle { font-size: 0.875rem; color: #6b7280; margin: 0; padding: 0; line-height: 1; display: inline-flex; align-items: center; transform: translateY(4px); }
        .header { background: linear-gradient(to right, #f0fdf4, #dbeafe); padding: 30px; border: 4px solid #86efac; border-radius: 12px; margin-bottom: 30px; }
        h1 { color: #1f2937; font-size: 28px; margin-bottom: 25px; border-bottom: 2px solid #d1d5db; padding-bottom: 15px; }
        .info { margin: 15px 0; font-size: 16px; }
        .destaque { color: #15803d; font-size: 20px; font-weight: bold; }
        @media print {
            body { padding: 15px; }
            .no-print { display: none; }
        }
        ${estilosAdicionais}
    </style>
</head>
<body>
    <div class="brand-header">
        <div class="logo-cp">CP</div>
        <div class="brand-title">
            <div class="brand-name">
                <span class="brand-conta">Conta</span><span class="brand-prazo">Prazo</span>
            </div>
            <span class="brand-separator">|</span>
            <span class="brand-subtitle">Calculadora de Prazos</span>
        </div>
    </div>
    <div class="header">
        <h1>Resultado do Cálculo de Prazo</h1>
        ${descricaoHTML}
        <div class="info"><strong>Data de Início:</strong> ${dataInicioFormatada}</div>
        <div class="info"><strong>Dias ${tipoDias} Contados:</strong> ${diasContados} dias</div>
        <div class="info"><strong>Data Final do Prazo:</strong> <span class="destaque">${dataFinalFormatada}</span></div>
        ${diasVisuaisHTML}
    </div>
    ${conteudoEspecifico}
    <div class="no-print" style="text-align: center; margin-top: 30px; padding: 20px; background: #fef3c7; border-radius: 8px;">
        <p style="margin-bottom: 15px;"><strong>📌 Para salvar como PDF:</strong></p>
        <p>Use Ctrl+P (Windows/Linux) ou Cmd+P (Mac) e selecione "Salvar como PDF"</p>
        <button onclick="window.print()" style="margin-top: 15px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
            🖨️ Imprimir / Salvar como PDF
        </button>
    </div>
</body>
</html>`;
        }

        // ==================== FUNÇÕES DE EXPORTAÇÃO ====================

        function exportarPDFResumido() {
            if (!dataFinal) {
                mostrarNotificacao('Calcule um prazo primeiro para exportar.', 'aviso');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            // Gerar visualização dos dias
            let diasVisuaisHTML = '';
            todosOsDias.forEach((dia, index) => {
                const diaNum = dia.data.getDate();
                const isInicio = index === 0;
                const isFinal = index === todosOsDias.length - 1;

                const ehFds = ehFimDeSemana(dia.data);
                const ehFer = ehFeriado(dia.data);
                const dataStr = `${dia.data.getFullYear()}-${String(dia.data.getMonth() + 1).padStart(2, '0')}-${String(dia.data.getDate()).padStart(2, '0')}`;
                const ehPersonalizado = feriadosPersonalizados.has(dataStr);

                let cor = '#fef3c7';
                let borda = '1px solid #fbbf24';
                let textoCor = '#92400e';

                if (isInicio) {
                    cor = '#3b82f6';
                    borda = '2px solid #2563eb';
                    textoCor = '#ffffff';
                } else if (isFinal) {
                    cor = '#16a34a';
                    borda = '2px solid #15803d';
                    textoCor = '#ffffff';
                } else if (usarDiasUteis) {
                    if (ehPersonalizado) {
                        cor = '#e9d5ff';
                        borda = '1px solid #c084fc';
                        textoCor = '#6b21a8';
                    } else if (ehFer) {
                        cor = '#fecaca';
                        borda = '1px solid #f87171';
                        textoCor = '#991b1b';
                    } else if (ehFds) {
                        cor = '#e5e7eb';
                        borda = '1px solid #d1d5db';
                        textoCor = '#6b7280';
                    }
                }

                let mesIndicador = '';
                if (index === 0 || dia.data.getMonth() !== todosOsDias[index - 1].data.getMonth()) {
                    const nomeMes = dia.data.toLocaleDateString('pt-BR', { month: 'short' });
                    mesIndicador = `<span style="font-size: 10px; color: #6b7280; font-weight: 600; margin-right: 5px; display: inline-block; text-transform: uppercase;">${nomeMes}</span>`;
                }

                diasVisuaisHTML += `${mesIndicador}<div style="display: inline-block; width: 28px; height: 28px; background: ${cor}; border: ${borda}; border-radius: 4px; text-align: center; line-height: 28px; font-size: 12px; font-weight: 600; color: ${textoCor}; margin: 2px;">${diaNum}</div>`;
            });

            // Formatar visualização dos dias com legenda para incluir dentro do header
            const diasVisuaisHTMLFormatado = `
                <div class="info" style="margin-top: 25px; border-top: 2px solid #e5e7eb; padding-top: 20px;">
                    <div style="margin-bottom: 12px;"><strong>Dias considerados:</strong></div>
                    <div style="line-height: 36px; text-align: left;">${diasVisuaisHTML}</div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; font-size: 13px; line-height: 24px;">
                        <span style="display: inline-block; width: 14px; height: 14px; background: #3b82f6; border: 1px solid #2563eb; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Início</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #16a34a; border: 1px solid #15803d; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Final</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Dias contados</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #e5e7eb; border: 1px solid #d1d5db; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">FDS</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #fecaca; border: 1px solid #f87171; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Feriado</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #e9d5ff; border: 1px solid #c084fc; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span>Feriados Personalizados</span>
                    </div>
                </div>
            `;

            // Gerar HTML usando função helper (dias considerados agora dentro do header)
            const htmlContent = gerarCabecalhoExportHTML({
                dataInicioFormatada,
                dataFinalFormatada,
                tipoDias,
                diasContados: diasUteis,
                descricaoHTML,
                diasVisuaisHTML: diasVisuaisHTMLFormatado,
                conteudoEspecifico: ''
            });

            const popup = window.open('', '_blank', 'width=900,height=700');
            if (popup) {
                popup.document.write(htmlContent);
                popup.document.close();
                setTimeout(() => {
                    popup.print();
                }, 500);
            } else {
                mostrarNotificacao('Pop-up bloqueado. Por favor, permita pop-ups para este site.', 'aviso');
            }
        }

        function exportarPDFCompleto() {
            if (!dataFinal) {
                mostrarNotificacao('Calcule um prazo primeiro para exportar.', 'aviso');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            // Gerar lista detalhada dos dias
            let listaHTML = '';
            todosOsDias.forEach(dia => {
                const dataFormatada = dia.data.toLocaleDateString('pt-BR', {
                    weekday: 'short',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });

                if (dia.contado) {
                    listaHTML += `<div style="padding: 12px; background: #dcfce7; margin: 5px 0; border-left: 4px solid #22c55e; border-radius: 4px; display: flex;">
                        <span style="color: #166534; font-weight: bold; min-width: 40px;">${dia.numero}</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada}</span>
                    </div>`;
                } else {
                    listaHTML += `<div style="padding: 12px; background: #fef2f2; margin: 5px 0; border-left: 4px solid #ef4444; border-radius: 4px; display: flex;">
                        <span style="color: #991b1b; font-weight: bold; min-width: 40px;">X</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada} - ${dia.motivo}</span>
                    </div>`;
                }
            });

            // Conteúdo específico: lista detalhada
            const conteudoEspecifico = `
                <div class="secao">
                    <h3>Detalhamento</h3>
                    ${listaHTML}
                </div>
            `;

            // Estilos adicionais para a seção de detalhamento
            const estilosAdicionais = `
                .secao { margin: 30px 0; padding: 20px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; }
                h3 { color: #374151; font-size: 18px; margin-bottom: 15px; }
            `;

            // Gerar HTML usando função helper
            const htmlContent = gerarCabecalhoExportHTML({
                dataInicioFormatada,
                dataFinalFormatada,
                tipoDias,
                diasContados: diasUteis,
                descricaoHTML,
                conteudoEspecifico,
                estilosAdicionais
            });

            const popup = window.open('', '_blank', 'width=900,height=700');
            if (popup) {
                popup.document.write(htmlContent);
                popup.document.close();
                // Auto-invocar impressão após carregar
                setTimeout(() => {
                    popup.print();
                }, 500);
            } else {
                mostrarNotificacao('Pop-up bloqueado. Por favor, permita pop-ups para este site ou use os botões de exportar imagem.', 'aviso');
            }
        }

		function sanitizarNomeArquivo(descricao) {
            if (!descricao || descricao.trim() === '') return '';

            // Normaliza e remove acentos/diacríticos
            let nome = descricao
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                // Remove caracteres inválidos em nomes de arquivo
                .replace(/[<>:"/\\|?*]/g, '')
                // Substitui espaços por hífens
                .replace(/\s+/g, '-')
                // Remove hífens duplicados
                .replace(/-+/g, '-')
                // Converte para minúsculas
                .toLowerCase()
                // Limita a 50 caracteres
                .substring(0, 50)
                // Remove hífens no início ou fim
                .replace(/^-|-$/g, '');

            return nome ? `${nome}-` : '';
        }

        function exportarImagemResumo() {
            if (!dataFinal) {
                mostrarNotificacao('Calcule um prazo primeiro.', 'aviso');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            // Gerar visualização dos dias (código compartilhado com exportarPDFResumido)
            let diasVisuaisHTML = '';
            todosOsDias.forEach((dia, index) => {
                const diaNum = dia.data.getDate();
                const isInicio = index === 0;
                const isFinal = index === todosOsDias.length - 1;

                const ehFds = ehFimDeSemana(dia.data);
                const ehFer = ehFeriado(dia.data);
                const dataStr = `${dia.data.getFullYear()}-${String(dia.data.getMonth() + 1).padStart(2, '0')}-${String(dia.data.getDate()).padStart(2, '0')}`;
                const ehPersonalizado = feriadosPersonalizados.has(dataStr);

                let cor = '#fef3c7';
                let borda = '1px solid #fbbf24';
                let textoCor = '#92400e';

                if (isInicio) {
                    cor = '#3b82f6';
                    borda = '2px solid #2563eb';
                    textoCor = '#ffffff';
                } else if (isFinal) {
                    cor = '#16a34a';
                    borda = '2px solid #15803d';
                    textoCor = '#ffffff';
                } else if (usarDiasUteis) {
                    if (ehPersonalizado) {
                        cor = '#e9d5ff';
                        borda = '1px solid #c084fc';
                        textoCor = '#6b21a8';
                    } else if (ehFer) {
                        cor = '#fecaca';
                        borda = '1px solid #f87171';
                        textoCor = '#991b1b';
                    } else if (ehFds) {
                        cor = '#e5e7eb';
                        borda = '1px solid #d1d5db';
                        textoCor = '#6b7280';
                    }
                }

                let mesIndicador = '';
                if (index === 0 || dia.data.getMonth() !== todosOsDias[index - 1].data.getMonth()) {
                    const nomeMes = dia.data.toLocaleDateString('pt-BR', { month: 'short' });
                    mesIndicador = `<span style="font-size: 10px; color: #6b7280; font-weight: 600; margin-right: 5px; display: inline-block; text-transform: uppercase;">${nomeMes}</span>`;
                }

                diasVisuaisHTML += `${mesIndicador}<div style="display: inline-block; width: 28px; height: 28px; background: ${cor}; border: ${borda}; border-radius: 4px; text-align: center; line-height: 28px; font-size: 12px; font-weight: 600; color: ${textoCor}; margin: 2px;">${diaNum}</div>`;
            });

            // HTML específico para PNG (nota: usa classes diferentes do PDF para evitar conflitos com html2canvas)
            const htmlContent = `
<style>
    .export-wrapper { font-family: system-ui; padding: 30px; max-width: 900px; margin: 0 auto; background: white; }
    .export-wrapper .brand-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .export-wrapper .logo-cp { width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #16a34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 20px; color: white; }
    .export-wrapper .brand-title { font-size: 1.8rem; font-weight: 700; display: flex; align-items: center; gap: 10px; margin: 0 !important; padding: 0 !important; line-height: 1; height: fit-content; }
    .export-wrapper .brand-name { display: flex; align-items: center; line-height: 1; background: transparent !important; }
    .export-wrapper .brand-conta { color: #3b82f6 !important; display: inline-flex; align-items: center; line-height: 1; margin: 0; padding: 0; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-prazo { color: #16a34a !important; display: inline-flex; align-items: center; line-height: 1; margin: 0; padding: 0; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-separator { color: #d1d5db; font-weight: 300; margin: 0; padding: 0; line-height: 1; display: inline-flex; align-items: center; }
    .export-wrapper .brand-subtitle { font-size: 0.875rem; color: #6b7280; margin: 0; padding: 0; line-height: 1; display: inline-flex; align-items: center; transform: translateY(4px); }
    .export-wrapper .header { background: linear-gradient(to right, #f0fdf4, #dbeafe); padding: 30px; border: 4px solid #86efac; border-radius: 12px; margin-bottom: 30px; }
    .export-wrapper h1 { color: #1f2937; font-size: 28px; margin: 0 0 25px 0; border-bottom: 2px solid #d1d5db; padding-bottom: 15px; }
    .export-wrapper .info { margin: 15px 0; font-size: 16px; }
    .export-wrapper .destaque { color: #15803d; font-size: 20px; font-weight: bold; }
</style>
<div class="export-wrapper">
    <div class="brand-header">
        <div class="logo-cp">CP</div>
        <div class="brand-title">
            <div class="brand-name">
                <span class="brand-conta" style="background: none; background-color: transparent;">Conta</span><span class="brand-prazo" style="background: none; background-color: transparent;">Prazo</span>
            </div>
            <span class="brand-separator">|</span>
            <span class="brand-subtitle">Calculadora de Prazos</span>
        </div>
    </div>
    <div class="header">
        <h1>Resultado do Cálculo de Prazo</h1>
        ${descricaoHTML}
        <div class="info"><strong>Data de Início:</strong> ${dataInicioFormatada}</div>
        <div class="info"><strong>Dias ${tipoDias} Contados:</strong> ${diasUteis} dias</div>
        <div class="info"><strong>Data Final do Prazo:</strong> <span class="destaque">${dataFinalFormatada}</span></div>
        <div class="info" style="margin-top: 25px; border-top: 2px solid #e5e7eb; padding-top: 20px;">
            <div style="margin-bottom: 12px;"><strong>Dias considerados:</strong></div>
            <div style="line-height: 36px; text-align: left;">${diasVisuaisHTML}</div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; font-size: 13px; line-height: 24px;">
                <span style="display: inline-block; width: 14px; height: 14px; background: #3b82f6; border: 1px solid #2563eb; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Início</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #16a34a; border: 1px solid #15803d; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Final</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Dias contados</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #e5e7eb; border: 1px solid #d1d5db; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">FDS</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #fecaca; border: 1px solid #f87171; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Feriado</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #e9d5ff; border: 1px solid #c084fc; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span>Feriados Personalizados</span>
            </div>
        </div>
    </div>
</div>`;

            // Renderizar com html2canvas
            const container = document.createElement('div');
            container.style.position = 'absolute';
            container.style.left = '-9999px';
            container.style.top = '0';
            container.style.width = '900px';
            container.innerHTML = htmlContent;
            document.body.appendChild(container);

            html2canvas(container, {
                backgroundColor: '#ffffff',
                scale: 2,
                logging: false,
                width: 900
            }).then(canvas => {
                document.body.removeChild(container);

                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    const prefixo = sanitizarNomeArquivo(descricaoPrazo);
                    link.download = prefixo ? `${prefixo}-contaprazo-resumo.png` : `contaprazo-resumo-${Date.now()}.png`;
                    link.click();
                    URL.revokeObjectURL(url);
                });
            }).catch(error => {
                document.body.removeChild(container);
                console.error('Erro ao gerar imagem:', error);
                mostrarNotificacao('Erro ao gerar imagem. Por favor, tente novamente.', 'erro');
            });
        }

        function exportarImagemCompleta() {
            if (!dataFinal) {
                mostrarNotificacao('Calcule um prazo primeiro.', 'aviso');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            let listaHTML = '';
            todosOsDias.forEach(dia => {
                const dataFormatada = dia.data.toLocaleDateString('pt-BR', {
                    weekday: 'short',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });

                if (dia.contado) {
                    listaHTML += `<div style="padding: 12px; background: #dcfce7; margin: 5px 0; border-left: 4px solid #22c55e; border-radius: 4px; display: flex;">
                        <span style="color: #166534; font-weight: bold; min-width: 40px;">${dia.numero}</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada}</span>
                    </div>`;
                } else {
                    listaHTML += `<div style="padding: 12px; background: #fef2f2; margin: 5px 0; border-left: 4px solid #ef4444; border-radius: 4px; display: flex;">
                        <span style="color: #991b1b; font-weight: bold; min-width: 40px;">X</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada} - ${dia.motivo}</span>
                    </div>`;
                }
            });

            const htmlContent = `
<style>
    .export-wrapper { font-family: system-ui; padding: 30px; max-width: 900px; margin: 0 auto; background: white; }
    .export-wrapper .brand-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .export-wrapper .logo-cp { width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #16a34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 20px; color: white; }
    .export-wrapper .brand-title { font-size: 1.8rem; font-weight: 700; display: flex; align-items: center; gap: 10px; margin: 0 !important; padding: 0 !important; line-height: 1; height: fit-content; }
    .export-wrapper .brand-name { display: flex; align-items: center; line-height: 1; background: transparent !important; }
    .export-wrapper .brand-conta { color: #3b82f6 !important; display: inline-flex; align-items: center; line-height: 1; margin: 0; padding: 0; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-prazo { color: #16a34a !important; display: inline-flex; align-items: center; line-height: 1; margin: 0; padding: 0; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-separator { color: #d1d5db; font-weight: 300; margin: 0; padding: 0; line-height: 1; display: inline-flex; align-items: center; }
    .export-wrapper .brand-subtitle { font-size: 0.875rem; color: #6b7280; margin: 0; padding: 0; line-height: 1; display: inline-flex; align-items: center; transform: translateY(4px); }
    .export-wrapper .header { background: linear-gradient(to right, #f0fdf4, #dbeafe); padding: 30px; border: 4px solid #86efac; border-radius: 12px; margin-bottom: 30px; }
    .export-wrapper h1 { color: #1f2937; font-size: 28px; margin: 0 0 25px 0; border-bottom: 2px solid #d1d5db; padding-bottom: 15px; }
    .export-wrapper .info { margin: 15px 0; font-size: 16px; }
    .export-wrapper .destaque { color: #15803d; font-size: 20px; font-weight: bold; }
    .export-wrapper .secao { margin: 30px 0; padding: 20px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; }
    .export-wrapper h3 { color: #374151; font-size: 18px; margin: 0 0 15px 0; }
</style>
<div class="export-wrapper">
    <div class="brand-header">
        <div class="logo-cp">CP</div>
        <div class="brand-title">
            <div class="brand-name">
                <span class="brand-conta" style="background: none; background-color: transparent;">Conta</span><span class="brand-prazo" style="background: none; background-color: transparent;">Prazo</span>
            </div>
            <span class="brand-separator">|</span>
            <span class="brand-subtitle">Calculadora de Prazos</span>
        </div>
    </div>
    <div class="header">
        <h1>Resultado do Cálculo de Prazo</h1>
        ${descricaoHTML}
        <div class="info"><strong>Data de Início:</strong> ${dataInicioFormatada}</div>
        <div class="info"><strong>Dias ${tipoDias} Contados:</strong> ${diasUteis} dias</div>
        <div class="info"><strong>Data Final do Prazo:</strong> <span class="destaque">${dataFinalFormatada}</span></div>
    </div>
    <div class="secao">
        <h3>Detalhamento</h3>
        ${listaHTML}
    </div>
</div>`;

            // Criar elemento temporário invisível
            const container = document.createElement('div');
            container.style.position = 'absolute';
            container.style.left = '-9999px';
            container.style.top = '0';
            container.style.width = '900px';
            container.innerHTML = htmlContent;
            document.body.appendChild(container);

            // Usar html2canvas para renderizar
            html2canvas(container, {
                backgroundColor: '#ffffff',
                scale: 2, // Melhor qualidade
                logging: false,
                width: 900
            }).then(canvas => {
                // Remover elemento temporário
                document.body.removeChild(container);

                // Fazer download da imagem
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    const prefixo = sanitizarNomeArquivo(descricaoPrazo);
                    link.download = prefixo ? `${prefixo}contaprazo-completo.png` : `contaprazo-completo-${Date.now()}.png`;
                    link.click();
                    URL.revokeObjectURL(url);
                });
            }).catch(error => {
                document.body.removeChild(container);
                console.error('Erro ao gerar imagem:', error);
                mostrarNotificacao('Erro ao gerar imagem. Por favor, tente novamente.', 'erro');
            });
        }

        function baixarCalculadora() {
            const htmlCompleto = document.documentElement.outerHTML;
            const blob = new Blob([htmlCompleto], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'contaprazo-calculadora.html';
            link.click();
            URL.revokeObjectURL(url);

            mostrarNotificacao('Calculadora baixada com sucesso! Agora você pode compartilhar este arquivo HTML com outras pessoas. Basta abrir o arquivo em qualquer navegador para usar a calculadora offline.', 'sucesso');
        }

        // Polyfill para roundRect (compatibilidade com navegadores antigos)
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.beginPath();
                this.moveTo(x + r, y);
                this.arcTo(x + w, y, x + w, y + h, r);
                this.arcTo(x + w, y + h, x, y + h, r);
                this.arcTo(x, y + h, x, y, r);
                this.arcTo(x, y, x + w, y, r);
                this.closePath();
                return this;
            };
        }

        // Função para trocar de página
        function trocarPagina(pagina) {
            // Inicializa cache se necessário
            if (!cacheDom) inicializarCacheDom();

            // Esconder todas as páginas
            cacheDom.paginas.calculo.classList.remove('active');
            cacheDom.paginas.gerenciamento.classList.remove('active');
            cacheDom.paginas.agenda.classList.remove('active');
            cacheDom.paginas.ajuda.classList.remove('active');

            // Remover active de todas as tabs
            Object.values(cacheDom.navTabs).forEach(tab => tab.classList.remove('active'));

            // Mostrar página selecionada e ativar tab
            if (pagina === 'calculo') {
                cacheDom.paginas.calculo.classList.add('active');
                cacheDom.navTabs.calculo.classList.add('active');
            } else if (pagina === 'gerenciamento') {
                cacheDom.paginas.gerenciamento.classList.add('active');
                cacheDom.navTabs.gerenciamento.classList.add('active');
                carregarEditoresFeriados();
            } else if (pagina === 'agenda') {
                cacheDom.paginas.agenda.classList.add('active');
                cacheDom.navTabs.agenda.classList.add('active');
                carregarAgenda();
            } else if (pagina === 'ajuda') {
                cacheDom.paginas.ajuda.classList.add('active');
                cacheDom.navTabs.ajuda.classList.add('active');
            }
        }

        // ========================================
        // FUNÇÕES DA AGENDA DE PRAZOS
        // ========================================

        // Carregar prazos do localStorage
        function carregarPrazosStorage() {
            const prazosStorage = localStorage.getItem('agendaPrazos');
            if (prazosStorage) {
                try {
                    prazos = JSON.parse(prazosStorage);
                    // Converter strings de data de volta para objetos Date
                    prazos = prazos.map(prazo => ({
                        ...prazo,
                        dataInicio: new Date(prazo.dataInicio),
                        dataFinal: new Date(prazo.dataFinal),
                        dataCriacao: new Date(prazo.dataCriacao),
                        dataConclusao: prazo.dataConclusao ? new Date(prazo.dataConclusao) : null,
                        detalhamentoDias: prazo.detalhamentoDias.map(dia => ({
                            ...dia,
                            data: new Date(dia.data)
                        }))
                    }));
                } catch (error) {
                    console.error('Erro ao carregar prazos:', error);
                    prazos = [];
                }
            }
        }

        // Salvar prazos no localStorage
        function salvarPrazosStorage() {
            try {
                localStorage.setItem('agendaPrazos', JSON.stringify(prazos));
            } catch (error) {
                console.error('Erro ao salvar prazos:', error);
                mostrarNotificacao('Erro ao salvar prazos. Verifique o espaço disponível.', 'erro');
            }
        }

        // Carregar prazos arquivados do localStorage
        function carregarArquivadosStorage() {
            const arquivadosStorage = localStorage.getItem('agendaPrazosArquivados');
            if (arquivadosStorage) {
                try {
                    prazosArquivados = JSON.parse(arquivadosStorage);
                    // Converter strings de data de volta para objetos Date
                    prazosArquivados = prazosArquivados.map(prazo => ({
                        ...prazo,
                        dataInicio: new Date(prazo.dataInicio),
                        dataFinal: new Date(prazo.dataFinal),
                        dataCriacao: new Date(prazo.dataCriacao),
                        dataConclusao: prazo.dataConclusao ? new Date(prazo.dataConclusao) : null,
                        dataArquivamento: prazo.dataArquivamento ? new Date(prazo.dataArquivamento) : null,
                        detalhamentoDias: prazo.detalhamentoDias.map(dia => ({
                            ...dia,
                            data: new Date(dia.data)
                        }))
                    }));
                } catch (error) {
                    console.error('Erro ao carregar arquivados:', error);
                    prazosArquivados = [];
                }
            }
        }

        // Salvar prazos arquivados no localStorage
        function salvarArquivadosStorage() {
            try {
                localStorage.setItem('agendaPrazosArquivados', JSON.stringify(prazosArquivados));
            } catch (error) {
                console.error('Erro ao salvar arquivados:', error);
                mostrarNotificacao('Erro ao salvar arquivados. Verifique o espaço disponível.', 'erro');
            }
        }

        // Gerar ID único
        function gerarId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Calcular status do prazo
        function calcularStatus(prazo) {
            if (prazo.status === 'concluido') return 'concluido';

            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const dataFinal = new Date(prazo.dataFinal);
            dataFinal.setHours(0, 0, 0, 0);

            if (dataFinal < hoje) {
                return 'atrasado';
            } else if (dataFinal.getTime() === hoje.getTime()) {
                return 'vencendo';
            } else {
                // Vencendo em até 3 dias
                const diffTime = dataFinal - hoje;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays <= 3) {
                    return 'vencendo';
                }
                return 'pendente';
            }
        }

        // Calcular dias restantes (respeitando o tipo original)
        function calcularDiasRestantes(prazo) {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            const dataFinal = new Date(prazo.dataFinal);
            dataFinal.setHours(0, 0, 0, 0);

            const diffTime = dataFinal - hoje;
            const diffDias = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

            // Se já passou ou é hoje
            if (diffDias < 0) {
                const diasAtrasados = Math.abs(diffDias);
                if (prazo.tipoDias === 'uteis') {
                    // Contar dias úteis atrasados
                    let diasUteisAtrasados = 0;
                    let dataAtual = new Date(dataFinal);
                    dataAtual.setDate(dataAtual.getDate() + 1);

                    while (dataAtual <= hoje) {
                        if (!ehFimDeSemana(dataAtual) && !ehFeriado(dataAtual)) {
                            diasUteisAtrasados++;
                        }
                        dataAtual.setDate(dataAtual.getDate() + 1);
                    }

                    return { numero: diasUteisAtrasados, tipo: 'uteis', atrasado: true };
                } else {
                    return { numero: diasAtrasados, tipo: 'corridos', atrasado: true };
                }
            } else if (diffDias === 0) {
                return { numero: 0, tipo: prazo.tipoDias, hoje: true };
            }

            // Calcular dias restantes
            if (prazo.tipoDias === 'uteis') {
                let diasUteis = 0;
                let dataAtual = new Date(hoje);
                dataAtual.setDate(dataAtual.getDate() + 1);

                while (dataAtual <= dataFinal) {
                    if (!ehFimDeSemana(dataAtual) && !ehFeriado(dataAtual)) {
                        diasUteis++;
                    }
                    dataAtual.setDate(dataAtual.getDate() + 1);
                }

                return { numero: diasUteis, tipo: 'uteis', atrasado: false };
            } else {
                return { numero: diffDias, tipo: 'corridos', atrasado: false };
            }
        }

        // Salvar prazo na agenda
        function salvarNaAgenda() {
            if (!calculoRealizado || !dataFinal) {
                mostrarNotificacao('Realize um cálculo primeiro antes de salvar na agenda.', 'aviso');
                return;
            }

            // Preencher modal - só título com descrição, campo descrição vazio
            document.getElementById('inputTituloPrazo').value = descricaoPrazo || '';
            document.getElementById('inputDescricaoPrazo').value = ''; // Deixar vazio para usuário preencher

            // Abrir modal
            document.getElementById('modalInputTitulo').classList.add('active');

            // Focar no campo de título
            setTimeout(() => {
                document.getElementById('inputTituloPrazo').focus();
            }, 100);
        }

        // Fechar modal de input
        function fecharModalInputTitulo() {
            document.getElementById('modalInputTitulo').classList.remove('active');
            document.getElementById('inputTituloPrazo').value = '';
            document.getElementById('inputDescricaoPrazo').value = '';
        }

        // Confirmar e salvar prazo
        function confirmarSalvarPrazo() {
            const titulo = document.getElementById('inputTituloPrazo').value.trim();
            const descricao = document.getElementById('inputDescricaoPrazo').value.trim();

            if (!titulo) {
                mostrarNotificacao('Por favor, digite um título para o prazo.', 'aviso');
                document.getElementById('inputTituloPrazo').focus();
                return;
            }

            const novoPrazo = {
                id: gerarId(),
                titulo: titulo,
                descricao: descricao,
                dataInicio: new Date(dataInicio + 'T00:00:00'),
                dataFinal: new Date(dataFinal),
                diasSolicitados: parseInt(diasUteis),
                tipoDias: usarDiasUteis ? 'uteis' : 'corridos',
                status: 'pendente',
                dataCriacao: new Date(),
                dataConclusao: null,
                detalhamentoDias: todosOsDias.map(dia => ({
                    data: new Date(dia.data),
                    contado: dia.contado,
                    motivo: dia.motivo,
                    numero: dia.numero
                })),
                feriadosUsados: {
                    fixos: {...feriadosFixos},
                    moveis: {...feriadosMoveis},
                    personalizados: Array.from(feriadosPersonalizados.entries())
                }
            };

            prazos.push(novoPrazo);
            salvarPrazosStorage();

            // Fechar modal
            fecharModalInputTitulo();

            // Mostrar banner de sucesso (sem redirecionar automaticamente)
            mostrarBannerPrazoSalvo();
        }

        // Mostrar banner de prazo salvo
        let bannerPrazoSalvoTimeout;
        function mostrarBannerPrazoSalvo() {
            const banner = document.getElementById('bannerPrazoSalvo');
            banner.classList.add('active');

            // Limpar timeout anterior se existir
            if (bannerPrazoSalvoTimeout) {
                clearTimeout(bannerPrazoSalvoTimeout);
            }

            // Auto-fechar após 5 segundos (com pausa no hover)
            bannerPrazoSalvoTimeout = setTimeout(() => {
                fecharBannerPrazoSalvo();
            }, 5000);

            // Pausar countdown no hover
            banner.addEventListener('mouseenter', pausarBannerPrazoSalvo);
            banner.addEventListener('mouseleave', retomarBannerPrazoSalvo);
        }

        // Pausar auto-fechamento do banner
        function pausarBannerPrazoSalvo() {
            if (bannerPrazoSalvoTimeout) {
                clearTimeout(bannerPrazoSalvoTimeout);
            }
        }

        // Retomar auto-fechamento do banner
        function retomarBannerPrazoSalvo() {
            bannerPrazoSalvoTimeout = setTimeout(() => {
                fecharBannerPrazoSalvo();
            }, 5000);
        }

        // Fechar banner de prazo salvo
        function fecharBannerPrazoSalvo() {
            const banner = document.getElementById('bannerPrazoSalvo');
            banner.classList.add('hiding');

            setTimeout(() => {
                banner.classList.remove('active', 'hiding');
            }, 400);

            // Remover event listeners
            banner.removeEventListener('mouseenter', pausarBannerPrazoSalvo);
            banner.removeEventListener('mouseleave', retomarBannerPrazoSalvo);
        }

        // Ir para a agenda (ao clicar no botão "Ver Agenda")
        function irParaAgenda() {
            fecharBannerPrazoSalvo();
            trocarPagina('agenda');
            // Scroll para o topo da página
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Sistema de notificações genérico
        let notificacaoTimeout;
        function mostrarNotificacao(mensagem, tipo = 'sucesso', botaoTexto = null, botaoCallback = null) {
            const banner = document.getElementById('bannerNotificacao');
            const titulo = document.getElementById('notificacaoTitulo');
            const descricao = document.getElementById('notificacaoDescricao');
            const icone = document.getElementById('notificacaoIcone');
            const btnPrimario = document.getElementById('notificacaoBtnPrimario');
            const btnSecundario = document.getElementById('notificacaoBtnSecundario');

            // Configurar conteúdo
            if (tipo === 'sucesso') {
                titulo.textContent = 'Sucesso!';
                icone.textContent = '✅';
            } else if (tipo === 'erro') {
                titulo.textContent = 'Erro';
                icone.textContent = '❌';
            } else if (tipo === 'aviso') {
                titulo.textContent = 'Atenção';
                icone.textContent = '⚠️';
            } else if (tipo === 'info') {
                titulo.textContent = 'Informação';
                icone.textContent = 'ℹ️';
            }

            descricao.textContent = mensagem;

            // Configurar botões
            if (botaoTexto && botaoCallback) {
                btnPrimario.textContent = botaoTexto;
                btnPrimario.style.display = 'inline-flex';
                btnPrimario.onclick = () => {
                    botaoCallback();
                    fecharNotificacao();
                };
            } else {
                btnPrimario.style.display = 'none';
            }

            // Mostrar banner
            banner.classList.add('active');

            // Limpar timeout anterior
            if (notificacaoTimeout) {
                clearTimeout(notificacaoTimeout);
            }

            // Auto-fechar após 5 segundos (com pausa no hover)
            notificacaoTimeout = setTimeout(() => {
                fecharNotificacao();
            }, 5000);

            // Pausar countdown no hover
            banner.addEventListener('mouseenter', pausarNotificacao);
            banner.addEventListener('mouseleave', retomarNotificacao);
        }

        function pausarNotificacao() {
            if (notificacaoTimeout) {
                clearTimeout(notificacaoTimeout);
            }
        }

        function retomarNotificacao() {
            notificacaoTimeout = setTimeout(() => {
                fecharNotificacao();
            }, 5000);
        }

        function fecharNotificacao() {
            const banner = document.getElementById('bannerNotificacao');
            banner.classList.add('hiding');

            setTimeout(() => {
                banner.classList.remove('active', 'hiding');
            }, 400);

            // Remover event listeners
            banner.removeEventListener('mouseenter', pausarNotificacao);
            banner.removeEventListener('mouseleave', retomarNotificacao);
        }

        // Carregar e renderizar agenda
        function carregarAgenda() {
            carregarPrazosStorage();
            carregarArquivadosStorage();
            renderizarPrazos();
            verificarPrazosVencendo();
        }

        // Renderizar lista de prazos
        function renderizarPrazos() {
            const container = document.getElementById('agendaLista');
            const vazio = document.getElementById('agendaVazia');
            const paginacao = document.getElementById('agendaPaginacao');

            // Selecionar fonte de dados baseado no modo de visualização
            const fonteDados = modoVisualizacao === 'arquivados' ? prazosArquivados : prazos;

            // Filtrar prazos
            let prazosFiltrados = fonteDados.filter(prazo => {
                const status = calcularStatus(prazo);
                prazo.statusCalculado = status; // Armazenar status calculado

                if (filtroAtual === 'todos') return true;
                return status === filtroAtual || (filtroAtual === 'concluidos' && prazo.status === 'concluido');
            });

            // Ordenar: atrasados primeiro, depois vencendo, depois pendentes, concluídos por último
            const ordemStatus = { atrasado: 1, vencendo: 2, pendente: 3, concluido: 4 };
            prazosFiltrados.sort((a, b) => {
                const statusA = a.status === 'concluido' ? 'concluido' : a.statusCalculado;
                const statusB = b.status === 'concluido' ? 'concluido' : b.statusCalculado;
                const ordemA = ordemStatus[statusA] || 5;
                const ordemB = ordemStatus[statusB] || 5;
                if (ordemA !== ordemB) return ordemA - ordemB;
                return b.dataFinal - a.dataFinal; // Mais próximo primeiro
            });

            // Atualizar badges de contadores
            atualizarBadgesFiltros();

            // Calcular paginação
            const totalItens = prazosFiltrados.length;
            const totalPaginas = Math.ceil(totalItens / ITENS_POR_PAGINA);

            // Ajustar página atual se estiver fora do limite
            if (paginaAtual > totalPaginas && totalPaginas > 0) {
                paginaAtual = totalPaginas;
            }
            if (paginaAtual < 1) {
                paginaAtual = 1;
            }

            // Renderizar
            if (totalItens === 0) {
                container.innerHTML = '';
                vazio.style.display = 'block';
                paginacao.style.display = 'none';
            } else {
                vazio.style.display = 'none';

                // Mostrar paginação apenas se houver mais de ITENS_POR_PAGINA itens
                if (totalItens > ITENS_POR_PAGINA) {
                    paginacao.style.display = 'flex';

                    // Calcular início e fim da página atual
                    const inicio = (paginaAtual - 1) * ITENS_POR_PAGINA;
                    const fim = inicio + ITENS_POR_PAGINA;
                    const prazosNaPagina = prazosFiltrados.slice(inicio, fim);

                    // Atualizar informações da paginação
                    document.getElementById('paginacaoMostrando').textContent =
                        `${inicio + 1}-${Math.min(fim, totalItens)}`;
                    document.getElementById('paginacaoTotal').textContent = totalItens;
                    document.getElementById('paginacaoNumero').textContent = paginaAtual;
                    document.getElementById('paginacaoPaginas').textContent = totalPaginas;

                    // Habilitar/desabilitar botões de navegação
                    const btnAnterior = document.getElementById('btnPaginaAnterior');
                    const btnProxima = document.getElementById('btnProximaPagina');

                    if (paginaAtual <= 1) {
                        btnAnterior.disabled = true;
                        btnAnterior.style.opacity = '0.5';
                        btnAnterior.style.cursor = 'not-allowed';
                    } else {
                        btnAnterior.disabled = false;
                        btnAnterior.style.opacity = '1';
                        btnAnterior.style.cursor = 'pointer';
                    }

                    if (paginaAtual >= totalPaginas) {
                        btnProxima.disabled = true;
                        btnProxima.style.opacity = '0.5';
                        btnProxima.style.cursor = 'not-allowed';
                    } else {
                        btnProxima.disabled = false;
                        btnProxima.style.opacity = '1';
                        btnProxima.style.cursor = 'pointer';
                    }

                    // Renderizar apenas os itens da página atual
                    container.innerHTML = prazosNaPagina.map(prazo => renderizarItemPrazo(prazo)).join('');
                } else {
                    // Menos de ITENS_POR_PAGINA itens - ocultar paginação
                    paginacao.style.display = 'none';
                    container.innerHTML = prazosFiltrados.map(prazo => renderizarItemPrazo(prazo)).join('');
                }
            }
        }

        // Renderizar item individual
        function renderizarItemPrazo(prazo) {
            const status = prazo.status === 'concluido' ? 'concluido' : prazo.statusCalculado;
            const diasRestantes = calcularDiasRestantes(prazo);
            const checked = prazo.status === 'concluido' ? 'checked' : '';
            const isArquivado = modoVisualizacao === 'arquivados';

            // Classe de coloração de fundo conforme status
            let classeFundo = '';
            if (status === 'atrasado') {
                classeFundo = 'prazo-item-atrasado';
            } else if (status === 'vencendo') {
                // Diferenciar "vence hoje" de "vence em 3 dias"
                if (diasRestantes.hoje) {
                    classeFundo = 'prazo-item-vence-hoje';
                } else {
                    classeFundo = 'prazo-item-vencendo';
                }
            } else if (status === 'concluido') {
                classeFundo = 'prazo-item-concluido';
            }

            // Badge de status - discreto
            let badgeHTML = '';
            if (status === 'atrasado') {
                badgeHTML = '<span class="prazo-badge badge-atrasado">Atrasado</span>';
            } else if (status === 'vencendo') {
                badgeHTML = '<span class="prazo-badge badge-vencendo">Vencendo</span>';
            } else if (status === 'pendente') {
                badgeHTML = '<span class="prazo-badge badge-pendente">Pendente</span>';
            } else if (status === 'concluido') {
                badgeHTML = '<span class="prazo-badge badge-concluido">Concluído</span>';
            }

            // Contador inline (Opção A) - sem caixa, apenas texto destacado
            let contadorInline = '';
            if (prazo.status === 'concluido') {
                const dataConc = prazo.dataConclusao ? new Date(prazo.dataConclusao).toLocaleDateString('pt-BR') : '';
                contadorInline = `<span class="prazo-contador-inline concluido">Concluído em ${dataConc}</span>`;
            } else {
                if (diasRestantes.atrasado) {
                    // Atrasado: mostrar negativo em vermelho (com concordância)
                    const textoTipo = diasRestantes.tipo === 'uteis'
                        ? (diasRestantes.numero === 1 ? 'dia útil' : 'dias úteis')
                        : (diasRestantes.numero === 1 ? 'dia' : 'dias');
                    contadorInline = `<span class="prazo-contador-inline atrasado">Atrasado há <strong>${diasRestantes.numero}</strong> ${textoTipo}</span>`;
                } else if (diasRestantes.hoje) {
                    // Vence hoje: texto chamativo
                    contadorInline = `<span class="prazo-contador-inline vence-hoje"><strong>VENCE HOJE</strong></span>`;
                } else {
                    // Pendente ou vencendo: mostrar positivo (com concordância)
                    const classe = status === 'vencendo' ? 'vencendo' : 'pendente';
                    const textoTipo = diasRestantes.tipo === 'uteis'
                        ? (diasRestantes.numero === 1 ? 'dia útil' : 'dias úteis')
                        : (diasRestantes.numero === 1 ? 'dia' : 'dias');
                    const verbo = diasRestantes.numero === 1 ? 'Falta' : 'Faltam';
                    contadorInline = `<span class="prazo-contador-inline ${classe}">${verbo} <strong>${diasRestantes.numero}</strong> ${textoTipo}</span>`;
                }
            }

            // Formatações
            const dataInicioFormatada = new Date(prazo.dataInicio).toLocaleDateString('pt-BR');
            const dataFinalFormatada = new Date(prazo.dataFinal).toLocaleDateString('pt-BR');

            // Descrição (opcional)
            const descricaoHTML = prazo.descricao ?
                `<p class="prazo-descricao">${prazo.descricao}</p>` : '';

            const isSelecionado = prazosSelecionados.has(prazo.id);
            const checkboxSelecaoHTML = modoSelecao ? `
                <div class="checkbox-selecao ${isSelecionado ? 'selecionado' : ''}" onclick="toggleSelecaoPrazo('${prazo.id}')"></div>
            ` : '';

            return `
                <div class="prazo-item ${classeFundo} ${modoSelecao ? 'modo-selecao' : ''}" data-id="${prazo.id}">
                    ${checkboxSelecaoHTML}
                    <div class="prazo-checkbox-wrapper">
                        <div class="prazo-checkbox ${checked} ${isArquivado || modoSelecao ? 'disabled' : ''}" ${isArquivado || modoSelecao ? '' : `onclick="toggleConcluido('${prazo.id}')"`} style="${isArquivado || modoSelecao ? 'cursor: not-allowed; opacity: 0.5;' : ''}">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                    </div>
                    <div class="prazo-conteudo">
                        <div class="prazo-header">
                            <h3 class="prazo-titulo">${prazo.titulo}</h3>
                            ${badgeHTML}
                        </div>
                        ${descricaoHTML}
                        <div class="prazo-data-final-destaque">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            <div class="prazo-data-final-texto">
                                Prazo final: <strong>${dataFinalFormatada}</strong>
                            </div>
                        </div>
                        <div class="prazo-info-secundaria">
                            <span class="prazo-info-secundaria-item">
                                ${prazo.diasSolicitados} ${prazo.tipoDias === 'uteis'
                                    ? (prazo.diasSolicitados === 1 ? 'dia útil' : 'dias úteis')
                                    : (prazo.diasSolicitados === 1 ? 'dia corrido' : 'dias corridos')}
                            </span>
                            <span class="prazo-info-secundaria-separador">•</span>
                            <span class="prazo-info-secundaria-item">
                                Início: ${dataInicioFormatada}
                            </span>
                            ${contadorInline ? `<span class="prazo-info-secundaria-separador">•</span>${contadorInline}` : ''}
                        </div>
                    </div>
                    <div class="prazo-acoes">
                        <button class="prazo-menu-btn" onclick="toggleMenuPrazo(event, '${prazo.id}')" title="Ações">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>
                        <div class="prazo-menu-dropdown" id="menu-${prazo.id}">
                            ${isArquivado ? `
                                <button class="prazo-menu-item menu-ver" onclick="abrirDetalhes('${prazo.id}'); fecharMenusPrazo();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Ver Detalhes
                                </button>
                                <button class="prazo-menu-item menu-desarquivar" onclick="abrirModalDesarquivar('${prazo.id}'); fecharMenusPrazo();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <polyline points="21 8 21 21 3 21 3 8"></polyline>
                                        <rect x="1" y="3" width="22" height="5"></rect>
                                        <line x1="10" y1="12" x2="14" y2="12"></line>
                                    </svg>
                                    Desarquivar
                                </button>
                                <button class="prazo-menu-item menu-excluir" onclick="excluirArquivadoPermanentemente('${prazo.id}'); fecharMenusPrazo();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Excluir Permanentemente
                                </button>
                            ` : `
                                <button class="prazo-menu-item menu-ver" onclick="abrirDetalhes('${prazo.id}'); fecharMenusPrazo();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                                        <circle cx="12" cy="12" r="3"></circle>
                                    </svg>
                                    Ver Detalhes
                                </button>
                                <button class="prazo-menu-item menu-editar" onclick="abrirEdicao('${prazo.id}'); fecharMenusPrazo();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                                    </svg>
                                    Editar
                                </button>
                                <button class="prazo-menu-item menu-arquivar" onclick="arquivarPrazoIndividual('${prazo.id}'); fecharMenusPrazo();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <polyline points="21 8 21 21 3 21 3 8"></polyline>
                                        <rect x="1" y="3" width="22" height="5"></rect>
                                        <line x1="10" y1="12" x2="14" y2="12"></line>
                                    </svg>
                                    Arquivar
                                </button>
                                <button class="prazo-menu-item menu-excluir" onclick="excluirPrazo('${prazo.id}'); fecharMenusPrazo();">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Excluir
                                </button>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        // Toggle menu de ações do prazo
        function toggleMenuPrazo(event, id) {
            event.stopPropagation();
            const menu = document.getElementById(`menu-${id}`);
            const button = event.currentTarget;
            const todosMenus = document.querySelectorAll('.prazo-menu-dropdown');

            // Fechar outros menus
            todosMenus.forEach(m => {
                if (m !== menu) {
                    m.classList.remove('active');
                }
            });

            // Toggle menu atual
            const wasActive = menu.classList.contains('active');

            if (wasActive) {
                menu.classList.remove('active');
                return;
            }

            // Abrir menu e posicionar
            menu.classList.add('active');

            // Aguardar renderização para calcular posição exata
            setTimeout(() => {
                const buttonRect = button.getBoundingClientRect();
                const menuRect = menu.getBoundingClientRect();
                const viewportHeight = window.innerHeight;
                const viewportWidth = window.innerWidth;

                // Posição horizontal: alinhar à direita do botão
                let left = buttonRect.right - menuRect.width;

                // Se sair da tela pela esquerda, alinhar à esquerda do botão
                if (left < 10) {
                    left = buttonRect.left;
                }

                // Se ainda sair pela direita, ajustar
                if (left + menuRect.width > viewportWidth - 10) {
                    left = viewportWidth - menuRect.width - 10;
                }

                // Posição vertical: inicialmente abaixo do botão
                let top = buttonRect.bottom + 5;

                // Se sair da tela por baixo, mostrar acima do botão
                if (top + menuRect.height > viewportHeight - 10) {
                    top = buttonRect.top - menuRect.height - 5;
                }

                // Se ainda sair por cima, forçar dentro da viewport
                if (top < 10) {
                    top = 10;
                }

                menu.style.left = `${left}px`;
                menu.style.top = `${top}px`;
            }, 0);
        }

        // Fechar todos os menus de prazo
        function fecharMenusPrazo() {
            document.querySelectorAll('.prazo-menu-dropdown').forEach(menu => {
                menu.classList.remove('active');
            });
        }

        // Fechar menus ao clicar fora
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.prazo-acoes')) {
                fecharMenusPrazo();
            }
        });

        // Atualizar badges dos filtros
        function atualizarBadgesFiltros() {
            const contadores = {
                todos: prazos.length,
                atrasados: 0,
                vencendo: 0,
                pendentes: 0,
                concluidos: 0,
                arquivados: prazosArquivados.length
            };

            prazos.forEach(prazo => {
                const status = calcularStatus(prazo);
                if (status === 'atrasado') contadores.atrasados++;
                else if (status === 'vencendo') contadores.vencendo++;
                else if (status === 'pendente') contadores.pendentes++;
                else if (status === 'concluido') contadores.concluidos++;
            });

            document.getElementById('badge-todos').textContent = contadores.todos;
            document.getElementById('badge-atrasados').textContent = contadores.atrasados;
            document.getElementById('badge-vencendo').textContent = contadores.vencendo;
            document.getElementById('badge-pendentes').textContent = contadores.pendentes;
            document.getElementById('badge-concluidos').textContent = contadores.concluidos;
            document.getElementById('badge-arquivados').textContent = contadores.arquivados;
        }

        // Filtrar prazos
        function filtrarPrazos(filtro) {
            // Se estiver vendo arquivados, voltar para ativos automaticamente
            if (modoVisualizacao === 'arquivados') {
                modoVisualizacao = 'ativos';
                const btnVerArquivados = document.getElementById('btnVerArquivados');
                const textoBtn = document.getElementById('textoVerArquivados');
                btnVerArquivados.classList.remove('active');
                textoBtn.textContent = 'Ver Arquivados';

                // Mostrar os filtros de status novamente
                document.querySelectorAll('.filtro-btn:not(#btnVerArquivados)').forEach(btn => {
                    btn.style.display = 'inline-flex';
                });
            }

            filtroAtual = filtro;

            // Atualizar botões de filtro
            document.querySelectorAll('.filtro-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.filtro === filtro) {
                    btn.classList.add('active');
                }
            });

            // Resetar para primeira página ao mudar filtro
            paginaAtual = 1;
            renderizarPrazos();
        }

        // Mudar página da lista
        function mudarPagina(novaPagina) {
            paginaAtual = novaPagina;
            renderizarPrazos();
            // Scroll suave para o topo da lista
            document.getElementById('agendaLista').scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Toggle concluído
        function toggleConcluido(id) {
            const prazo = prazos.find(p => p.id === id);
            if (!prazo) return;

            // Salvar estado anterior para undo
            undoState = {
                action: 'toggleConcluido',
                prazoId: id,
                estadoAnterior: prazo.status,
                dataConclusaoAnterior: prazo.dataConclusao
            };

            // Toggle status
            if (prazo.status === 'concluido') {
                prazo.status = 'pendente';
                prazo.dataConclusao = null;
            } else {
                prazo.status = 'concluido';
                prazo.dataConclusao = new Date();
            }

            salvarPrazosStorage();
            renderizarPrazos();

            // Mostrar toast de undo
            mostrarToastUndo(prazo.status === 'concluido' ? 'Prazo marcado como concluído' : 'Prazo desmarcado');
        }

        // Mostrar toast de undo
        function mostrarToastUndo(mensagem) {
            const toast = document.getElementById('toastUndo');
            const texto = document.getElementById('toastUndoTexto');

            texto.textContent = mensagem;
            toast.classList.add('active');

            // Limpar timeout anterior
            if (undoTimeout) clearTimeout(undoTimeout);

            // Auto-esconder após 5 segundos
            undoTimeout = setTimeout(() => {
                esconderToastUndo();
            }, 5000);
        }

        // Esconder toast de undo
        function esconderToastUndo() {
            const toast = document.getElementById('toastUndo');
            toast.classList.remove('active');
            undoState = null;
        }

        // Desfazer ação
        function desfazerAcao() {
            if (!undoState) return;

            if (undoState.action === 'toggleConcluido') {
                const prazo = prazos.find(p => p.id === undoState.prazoId);
                if (prazo) {
                    prazo.status = undoState.estadoAnterior;
                    prazo.dataConclusao = undoState.dataConclusaoAnterior;
                    salvarPrazosStorage();
                    renderizarPrazos();
                }
            }

            esconderToastUndo();
        }

        // Abrir detalhes do prazo
        function abrirDetalhes(id) {
            // Buscar em prazos ativos ou arquivados
            let prazo = prazos.find(p => p.id === id);
            let isArquivado = false;

            if (!prazo) {
                prazo = prazosArquivados.find(p => p.id === id);
                isArquivado = true;
            }
            if (!prazo) return;

            prazoEmEdicao = id; // Guardar ID para ações no modal

            // Preencher título
            document.getElementById('modalDetalhesTitulo').textContent = prazo.titulo;

            // Construir corpo com os mesmos dados do resultado original
            const dataInicioFormatada = prazo.dataInicio.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = prazo.dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = prazo.tipoDias === 'uteis' ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (prazo.descricao) {
                descricaoHTML = `
                    <div class="resultado-descricao">
                        <strong>Descrição:</strong> ${prazo.descricao}
                    </div>
                `;
            }

            // Status e contador
            const status = calcularStatus(prazo);
            const diasRestantes = calcularDiasRestantes(prazo);
            let statusHTML = '';

            if (prazo.status === 'concluido') {
                const dataConcFormatada = prazo.dataConclusao ? prazo.dataConclusao.toLocaleDateString('pt-BR') : '';
                statusHTML = `
                    <div class="resultado-info" style="background: #d1fae5; padding: 10px; border-radius: 8px; border-left: 4px solid #059669;">
                        <strong>Status:</strong> <span style="color: #065f46; font-weight: 700;">✓ Concluído em ${dataConcFormatada}</span>
                    </div>
                `;
            } else {
                let labelContador = '';
                let corBarra = '';

                if (diasRestantes.atrasado) {
                    labelContador = `${diasRestantes.numero} ${diasRestantes.tipo === 'uteis' ? 'dias úteis' : 'dias'} atrasado${diasRestantes.numero > 1 ? 's' : ''}`;
                    corBarra = '#dc2626';
                } else if (diasRestantes.hoje) {
                    labelContador = 'Vence hoje!';
                    corBarra = '#ea580c';
                } else {
                    labelContador = `Faltam ${diasRestantes.numero} ${diasRestantes.tipo === 'uteis' ? 'dias úteis' : 'dias'}`;
                    corBarra = '#3b82f6';
                }

                statusHTML = `
                    <div class="resultado-info" style="background: ${corBarra}15; padding: 10px; border-radius: 8px; border-left: 4px solid ${corBarra};">
                        <strong>Status:</strong> <span style="color: ${corBarra}; font-weight: 700;">${labelContador}</span>
                    </div>
                `;
            }

            const html = `
                <div class="resultado" style="box-shadow: none; border: none; margin: 0;">
                    ${descricaoHTML}
                    <div class="resultado-info">
                        <strong>Data de Início:</strong> ${dataInicioFormatada}
                    </div>
                    <div class="resultado-info">
                        <strong>Dias ${tipoDias} Contados:</strong> ${prazo.diasSolicitados}
                    </div>
                    <div class="resultado-info">
                        <strong>Data Final do Prazo:</strong> <span class="data-final">${dataFinalFormatada}</span>
                    </div>
                    ${statusHTML}

                    <div class="detalhamento" style="margin-top: 12px;">
                        <h3>
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            Detalhamento (Auditoria)
                        </h3>
                        ${prazo.detalhamentoDias.map(dia => {
                            const dataFormatada = dia.data.toLocaleDateString('pt-BR', {
                                weekday: 'short',
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric'
                            });

                            if (dia.contado) {
                                return `<div class="dia-item dia-contado">
                                    <span class="dia-numero">${dia.numero}</span>
                                    <span>${dataFormatada}</span>
                                </div>`;
                            } else {
                                return `<div class="dia-item dia-nao-contado">
                                    <span class="dia-numero">X</span>
                                    <span>${dataFormatada} - ${dia.motivo}</span>
                                </div>`;
                            }
                        }).join('')}
                    </div>
                </div>
            `;

            document.getElementById('modalDetalhesBody').innerHTML = html;

            // Renderizar botões de ação baseado se é arquivado ou não
            const acoesContainer = document.querySelector('.modal-detalhes-acoes');
            if (isArquivado) {
                // Versão limitada para arquivados
                acoesContainer.innerHTML = `
                    <button class="btn btn-primary" onclick="desarquivarPrazoModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3h18v5H3zM3 8h18v13H3z"></path>
                            <line x1="12" y1="11" x2="12" y2="17"></line>
                            <polyline points="9 14 12 17 15 14"></polyline>
                        </svg>
                        Desarquivar
                    </button>
                    <button class="btn btn-red" onclick="excluirPrazoArquivadoModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Excluir
                    </button>
                `;
            } else {
                // Versão completa para ativos
                acoesContainer.innerHTML = `
                    <button class="btn btn-success" onclick="marcarConcluidoModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Marcar Concluído
                    </button>
                    <button class="btn btn-primary" onclick="editarPrazoModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                        </svg>
                        Editar
                    </button>
                    <button class="btn btn-red" onclick="excluirPrazoModal()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Excluir
                    </button>
                `;
            }

            document.getElementById('modalDetalhesPrazo').classList.add('active');

            // Resetar scroll ao abrir modal (após adicionar classe 'active')
            // Usar setTimeout para garantir que o modal já está visível
            setTimeout(() => {
                document.getElementById('modalDetalhesBody').scrollTop = 0;
            }, 0);
        }

        // Fechar modal de detalhes
        function fecharModalDetalhes() {
            document.getElementById('modalDetalhesPrazo').classList.remove('active');
            prazoEmEdicao = null;
        }

        // Marcar concluído do modal
        function marcarConcluidoModal() {
            if (prazoEmEdicao) {
                toggleConcluido(prazoEmEdicao);
                fecharModalDetalhes();
            }
        }

        // Abrir modal de edição
        function abrirEdicao(id) {
            const prazo = prazos.find(p => p.id === id);
            if (!prazo) return;

            prazoEmEdicao = id;

            document.getElementById('editTitulo').value = prazo.titulo;
            document.getElementById('editDescricao').value = prazo.descricao || '';
            document.getElementById('modalEditarPrazo').classList.add('active');
        }

        // Editar prazo do modal de detalhes
        function editarPrazoModal() {
            if (prazoEmEdicao) {
                const id = prazoEmEdicao; // Salvar ID antes de fechar
                fecharModalDetalhes();
                abrirEdicao(id); // Usar ID salvo
            }
        }

        // Fechar modal de edição
        function fecharModalEditar() {
            document.getElementById('modalEditarPrazo').classList.remove('active');
            prazoEmEdicao = null;
        }

        // Salvar edição
        function salvarEdicao() {
            if (!prazoEmEdicao) return;

            const prazo = prazos.find(p => p.id === prazoEmEdicao);
            if (!prazo) return;

            const novoTitulo = document.getElementById('editTitulo').value.trim();
            const novaDescricao = document.getElementById('editDescricao').value.trim();

            if (!novoTitulo) {
                mostrarNotificacao('O título não pode estar vazio.', 'aviso');
                return;
            }

            prazo.titulo = novoTitulo;
            prazo.descricao = novaDescricao;

            salvarPrazosStorage();
            renderizarPrazos();
            fecharModalEditar();

            mostrarNotificacao('Prazo atualizado com sucesso!', 'sucesso');
        }

        // Excluir prazo
        function excluirPrazo(id) {
            if (!confirm('Tem certeza que deseja excluir este prazo? Esta ação não pode ser desfeita.')) {
                return;
            }

            prazos = prazos.filter(p => p.id !== id);
            salvarPrazosStorage();
            renderizarPrazos();
        }

        // Excluir prazo do modal
        function excluirPrazoModal() {
            if (prazoEmEdicao) {
                const id = prazoEmEdicao; // Salvar ID antes de fechar
                fecharModalDetalhes();
                excluirPrazo(id); // Usar ID salvo
            }
        }

        // Desarquivar prazo do modal
        function desarquivarPrazoModal() {
            if (!prazoEmEdicao) return;

            const prazo = prazosArquivados.find(p => p.id === prazoEmEdicao);
            if (!prazo) {
                mostrarNotificacao('Prazo não encontrado.', 'erro');
                fecharModalDetalhes();
                return;
            }

            // Manter o status atual (concluído ou pendente)
            // mas remover dos arquivados

            // Remover dos arquivados
            prazosArquivados = prazosArquivados.filter(p => p.id !== prazoEmEdicao);

            // Adicionar de volta aos ativos
            prazos.push(prazo);

            // Salvar
            salvarPrazosStorage();
            salvarArquivadosStorage();

            // Fechar modal e atualizar UI
            fecharModalDetalhes();
            renderizarPrazos();

            mostrarNotificacao('Prazo desarquivado com sucesso!', 'sucesso');
        }

        // Excluir prazo arquivado do modal
        function excluirPrazoArquivadoModal() {
            if (!prazoEmEdicao) return;

            if (!confirm('Tem certeza que deseja excluir este prazo permanentemente? Esta ação não pode ser desfeita.')) {
                return;
            }

            const prazo = prazosArquivados.find(p => p.id === prazoEmEdicao);
            if (!prazo) {
                mostrarNotificacao('Prazo não encontrado.', 'erro');
                fecharModalDetalhes();
                return;
            }

            // Remover dos arquivados
            prazosArquivados = prazosArquivados.filter(p => p.id !== prazoEmEdicao);

            // Salvar
            salvarArquivadosStorage();

            // Fechar modal e atualizar UI
            fecharModalDetalhes();
            renderizarPrazos();

            mostrarNotificacao('Prazo excluído permanentemente.', 'sucesso');
        }

        // Exportar agenda para JSON
        function exportarAgendaJSON() {
            if (prazos.length === 0) {
                mostrarNotificacao('Não há prazos para exportar.', 'info');
                return;
            }

            const dataExport = {
                versao: '1.0',
                dataExportacao: new Date().toISOString(),
                totalPrazos: prazos.length,
                prazos: prazos
            };

            const json = JSON.stringify(dataExport, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `contaprazo-agenda-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            mostrarNotificacao('Agenda exportada com sucesso!', 'sucesso');
        }

        // Importar agenda
        function importarAgendaJSON() {
            document.getElementById('inputImportAgenda').click();
        }

        // Processar importação
        function processarImportAgenda(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);

                    if (!data.prazos || !Array.isArray(data.prazos)) {
                        throw new Error('Formato de arquivo inválido');
                    }

                    const confirmacao = confirm(
                        `Deseja importar ${data.prazos.length} prazo(s)?\n\n` +
                        `Escolha:\n` +
                        `OK = Substituir agenda atual\n` +
                        `Cancelar = Mesclar com agenda atual`
                    );

                    if (confirmacao) {
                        // Substituir
                        prazos = data.prazos.map(prazo => ({
                            ...prazo,
                            dataInicio: new Date(prazo.dataInicio),
                            dataFinal: new Date(prazo.dataFinal),
                            dataCriacao: new Date(prazo.dataCriacao),
                            dataConclusao: prazo.dataConclusao ? new Date(prazo.dataConclusao) : null,
                            detalhamentoDias: prazo.detalhamentoDias.map(dia => ({
                                ...dia,
                                data: new Date(dia.data)
                            }))
                        }));
                    } else {
                        // Mesclar
                        const novosprazos = data.prazos.map(prazo => ({
                            ...prazo,
                            id: gerarId(), // Novo ID para evitar conflitos
                            dataInicio: new Date(prazo.dataInicio),
                            dataFinal: new Date(prazo.dataFinal),
                            dataCriacao: new Date(prazo.dataCriacao),
                            dataConclusao: prazo.dataConclusao ? new Date(prazo.dataConclusao) : null,
                            detalhamentoDias: prazo.detalhamentoDias.map(dia => ({
                                ...dia,
                                data: new Date(dia.data)
                            }))
                        }));
                        prazos.push(...novosprazos);
                    }

                    salvarPrazosStorage();
                    renderizarPrazos();
                    mostrarNotificacao('Agenda importada com sucesso!', 'sucesso');

                } catch (error) {
                    mostrarNotificacao('Erro ao importar agenda: ' + error.message, 'erro');
                }
            };

            reader.readAsText(file);
            // Limpar input para permitir importar o mesmo arquivo novamente
            event.target.value = '';
        }

        // Arquivar concluídos
        // Abrir modal de arquivamento
        function arquivarConcluidos() {
            const concluidos = prazos.filter(p => p.status === 'concluido');

            if (concluidos.length === 0) {
                mostrarNotificacao('Não há prazos concluídos para arquivar.', 'info');
                return;
            }

            document.getElementById('modalArquivamento').classList.add('active');
        }

        function fecharModalArquivamento() {
            document.getElementById('modalArquivamento').classList.remove('active');
        }

        // Arquivar prazos antigos (>90 dias)
        function arquivarAntigos() {
            const dataLimite = new Date();
            dataLimite.setDate(dataLimite.getDate() - DIAS_PARA_ARQUIVAR);

            const concluidosAntigos = prazos.filter(p => {
                if (p.status !== 'concluido') return false;
                const dataConclusao = p.dataConclusao ? new Date(p.dataConclusao) : new Date(p.dataFinal);
                return dataConclusao < dataLimite;
            });

            if (concluidosAntigos.length === 0) {
                mostrarNotificacao(`Não há prazos concluídos há mais de ${DIAS_PARA_ARQUIVAR} dias.`, 'info');
                fecharModalArquivamento();
                return;
            }

            // Adicionar data de arquivamento e mover para arquivados
            concluidosAntigos.forEach(prazo => {
                prazo.dataArquivamento = new Date();
            });

            prazosArquivados.push(...concluidosAntigos);

            // Remover da lista de ativos
            const idsRemover = new Set(concluidosAntigos.map(p => p.id));
            prazos = prazos.filter(p => !idsRemover.has(p.id));

            salvarPrazosStorage();
            salvarArquivadosStorage();
            renderizarPrazos();

            fecharModalArquivamento();
            mostrarNotificacao(`${concluidosAntigos.length} prazo(s) arquivado(s) com sucesso!`, 'sucesso');
        }

        // Arquivar todos os concluídos
        function arquivarTodos() {
            const concluidos = prazos.filter(p => p.status === 'concluido');

            if (concluidos.length === 0) {
                mostrarNotificacao('Não há prazos concluídos para arquivar.', 'info');
                fecharModalArquivamento();
                return;
            }

            // Adicionar data de arquivamento e mover para arquivados
            concluidos.forEach(prazo => {
                prazo.dataArquivamento = new Date();
            });

            prazosArquivados.push(...concluidos);

            // Remover da lista de ativos
            prazos = prazos.filter(p => p.status !== 'concluido');

            salvarPrazosStorage();
            salvarArquivadosStorage();
            renderizarPrazos();

            fecharModalArquivamento();
            mostrarNotificacao(`${concluidos.length} prazo(s) arquivado(s) com sucesso!`, 'sucesso');
        }

        // Excluir definitivamente todos os concluídos
        function excluirTodosConcluidos() {
            const concluidos = prazos.filter(p => p.status === 'concluido');

            if (concluidos.length === 0) {
                mostrarNotificacao('Não há prazos concluídos para excluir.', 'info');
                fecharModalArquivamento();
                return;
            }

            // Remover da lista de ativos
            prazos = prazos.filter(p => p.status !== 'concluido');

            salvarPrazosStorage();
            renderizarPrazos();

            fecharModalArquivamento();
            mostrarNotificacao(`${concluidos.length} prazo(s) excluído(s) definitivamente.`, 'sucesso');
        }

        // Funções para gerenciar arquivados individualmente
        let prazoParaDesarquivar = null;

        function abrirModalDesarquivar(id) {
            prazoParaDesarquivar = id;
            document.getElementById('modalDesarquivar').classList.add('active');
        }

        function fecharModalDesarquivar() {
            prazoParaDesarquivar = null;
            document.getElementById('modalDesarquivar').classList.remove('active');
        }

        function confirmarDesarquivar(novoStatus) {
            if (!prazoParaDesarquivar) return;

            // Encontrar o prazo nos arquivados
            const prazo = prazosArquivados.find(p => p.id === prazoParaDesarquivar);
            if (!prazo) {
                mostrarNotificacao('Prazo não encontrado.', 'erro');
                fecharModalDesarquivar();
                return;
            }

            // Atualizar status conforme escolha do usuário
            prazo.status = novoStatus;
            if (novoStatus === 'pendente') {
                prazo.dataConclusao = null;
            }

            // Remover dos arquivados
            prazosArquivados = prazosArquivados.filter(p => p.id !== prazoParaDesarquivar);

            // Adicionar de volta aos ativos
            prazos.push(prazo);

            // Salvar
            salvarPrazosStorage();
            salvarArquivadosStorage();

            // Atualizar UI
            renderizarPrazos();
            fecharModalDesarquivar();

            const statusTexto = novoStatus === 'pendente' ? 'pendente' : 'concluído';
            mostrarNotificacao(`Prazo desarquivado com sucesso como ${statusTexto}!`, 'sucesso');
        }

        function excluirArquivadoPermanentemente(id) {
            // Encontrar o prazo nos arquivados
            const prazo = prazosArquivados.find(p => p.id === id);
            if (!prazo) {
                mostrarNotificacao('Prazo não encontrado.', 'erro');
                return;
            }

            // Remover dos arquivados
            prazosArquivados = prazosArquivados.filter(p => p.id !== id);

            // Salvar
            salvarArquivadosStorage();

            // Atualizar UI
            renderizarPrazos();

            mostrarNotificacao('Prazo excluído permanentemente.', 'sucesso');
        }

        // Arquivar prazo individual (sem precisar marcar como concluído)
        function arquivarPrazoIndividual(id) {
            const prazo = prazos.find(p => p.id === id);
            if (!prazo) {
                mostrarNotificacao('Prazo não encontrado.', 'erro');
                return;
            }

            // Adicionar data de arquivamento
            prazo.dataArquivamento = new Date();

            // Mover para arquivados
            prazosArquivados.push(prazo);

            // Remover da lista de ativos
            prazos = prazos.filter(p => p.id !== id);

            // Salvar
            salvarPrazosStorage();
            salvarArquivadosStorage();

            // Atualizar UI
            renderizarPrazos();

            mostrarNotificacao('Prazo arquivado com sucesso!', 'sucesso');
        }

        // ========================================
        // SISTEMA DE SELEÇÃO MÚLTIPLA
        // ========================================

        function entrarModoSelecao() {
            modoSelecao = true;
            prazosSelecionados.clear();

            // Ocultar botões de filtro e arquivados
            document.getElementById('btnSelecionar').style.display = 'none';
            document.getElementById('btnVerArquivados').style.display = 'none';
            document.querySelectorAll('.filtro-btn[data-filtro]').forEach(btn => {
                btn.style.display = 'none';
            });

            // Mostrar barra de seleção
            document.getElementById('barraSelecao').style.display = 'flex';

            // Renderizar menu de ações baseado no modo de visualização
            renderizarMenuAcoesSelecao();

            // Re-renderizar lista para mostrar checkboxes
            renderizarPrazos();
        }

        function renderizarMenuAcoesSelecao() {
            const menuAcoes = document.getElementById('menuAcoesSelecao');

            if (modoVisualizacao === 'arquivados') {
                // Menu para prazos arquivados
                menuAcoes.innerHTML = `
                    <button onclick="desarquivarSelecionados()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M3 3h18v5H3zM3 8h18v13H3z"></path>
                            <line x1="12" y1="11" x2="12" y2="17"></line>
                            <polyline points="9 14 12 17 15 14"></polyline>
                        </svg>
                        Desarquivar Selecionados
                    </button>
                    <button onclick="excluirSelecionados()" style="color: #dc2626;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Excluir Selecionados
                    </button>
                `;
            } else {
                // Menu para prazos ativos
                menuAcoes.innerHTML = `
                    <button onclick="marcarSelecionadosConcluidos()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        Marcar como Concluídos
                    </button>
                    <button onclick="arquivarSelecionados()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="21 8 21 21 3 21 3 8"></polyline>
                            <rect x="1" y="3" width="22" height="5"></rect>
                            <line x1="10" y1="12" x2="14" y2="12"></line>
                        </svg>
                        Arquivar Selecionados
                    </button>
                    <button onclick="excluirSelecionados()" style="color: #dc2626;">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        Excluir Selecionados
                    </button>
                `;
            }
        }

        function sairModoSelecao() {
            modoSelecao = false;
            prazosSelecionados.clear();

            // Mostrar botões de filtro e arquivados novamente
            document.getElementById('btnSelecionar').style.display = 'inline-flex';
            document.getElementById('btnVerArquivados').style.display = 'inline-flex';

            // Restaurar visibilidade dos botões de filtro baseado no modo de visualização
            if (modoVisualizacao === 'arquivados') {
                // Se estamos vendo arquivados, ocultar filtros de status
                document.querySelectorAll('.filtro-btn[data-filtro]').forEach(btn => {
                    btn.style.display = 'none';
                });
            } else {
                // Se estamos vendo ativos, mostrar todos os filtros
                document.querySelectorAll('.filtro-btn[data-filtro]').forEach(btn => {
                    btn.style.display = 'inline-flex';
                });
            }

            // Ocultar barra de seleção
            document.getElementById('barraSelecao').style.display = 'none';

            // Fechar menu de ações se estiver aberto
            document.getElementById('menuAcoesSelecao').style.display = 'none';

            // Re-renderizar lista sem checkboxes
            renderizarPrazos();
        }

        function toggleSelecaoPrazo(id) {
            if (prazosSelecionados.has(id)) {
                prazosSelecionados.delete(id);
            } else {
                prazosSelecionados.add(id);
            }

            // Atualizar contador
            document.getElementById('contadorSelecionados').textContent = prazosSelecionados.size;

            // Re-renderizar para atualizar checkboxes
            renderizarPrazos();
        }

        function selecionarTodos() {
            // Selecionar todos os prazos visíveis na página atual
            const fonteDados = modoVisualizacao === 'arquivados' ? prazosArquivados : prazos;

            // Filtrar conforme filtro atual
            const prazosFiltrados = fonteDados.filter(prazo => {
                const status = calcularStatus(prazo);
                if (filtroAtual === 'todos') return true;
                return status === filtroAtual || (filtroAtual === 'concluidos' && prazo.status === 'concluido');
            });

            prazosFiltrados.forEach(prazo => {
                prazosSelecionados.add(prazo.id);
            });

            // Atualizar contador
            document.getElementById('contadorSelecionados').textContent = prazosSelecionados.size;

            // Re-renderizar
            renderizarPrazos();
        }

        function selecionarNenhum() {
            prazosSelecionados.clear();

            // Atualizar contador
            document.getElementById('contadorSelecionados').textContent = 0;

            // Re-renderizar
            renderizarPrazos();
        }

        function toggleMenuAcoesSelecao() {
            const menu = document.getElementById('menuAcoesSelecao');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }

        function marcarSelecionadosConcluidos() {
            if (prazosSelecionados.size === 0) {
                mostrarNotificacao('Nenhum prazo selecionado.', 'aviso');
                return;
            }

            const fonteDados = modoVisualizacao === 'arquivados' ? prazosArquivados : prazos;

            prazosSelecionados.forEach(id => {
                const prazo = fonteDados.find(p => p.id === id);
                if (prazo && prazo.status !== 'concluido') {
                    prazo.status = 'concluido';
                    prazo.dataConclusao = new Date();
                }
            });

            // Salvar
            if (modoVisualizacao === 'arquivados') {
                salvarArquivadosStorage();
            } else {
                salvarPrazosStorage();
            }

            // Fechar menu e sair do modo
            document.getElementById('menuAcoesSelecao').style.display = 'none';
            sairModoSelecao();

            mostrarNotificacao(`${prazosSelecionados.size} prazo(s) marcado(s) como concluído(s)!`, 'sucesso');
        }

        function arquivarSelecionados() {
            if (prazosSelecionados.size === 0) {
                mostrarNotificacao('Nenhum prazo selecionado.', 'aviso');
                return;
            }

            if (modoVisualizacao === 'arquivados') {
                mostrarNotificacao('Você já está vendo prazos arquivados.', 'info');
                return;
            }

            const prazosParaArquivar = [];

            prazosSelecionados.forEach(id => {
                const prazo = prazos.find(p => p.id === id);
                if (prazo) {
                    prazo.dataArquivamento = new Date();
                    prazosParaArquivar.push(prazo);
                }
            });

            // Mover para arquivados
            prazosArquivados.push(...prazosParaArquivar);

            // Remover dos ativos
            prazos = prazos.filter(p => !prazosSelecionados.has(p.id));

            // Salvar
            salvarPrazosStorage();
            salvarArquivadosStorage();

            // Fechar menu e sair do modo
            document.getElementById('menuAcoesSelecao').style.display = 'none';
            sairModoSelecao();

            mostrarNotificacao(`${prazosParaArquivar.length} prazo(s) arquivado(s)!`, 'sucesso');
        }

        function desarquivarSelecionados() {
            if (prazosSelecionados.size === 0) {
                mostrarNotificacao('Nenhum prazo selecionado.', 'aviso');
                return;
            }

            if (modoVisualizacao !== 'arquivados') {
                mostrarNotificacao('Você não está vendo prazos arquivados.', 'info');
                return;
            }

            const prazosParaDesarquivar = [];

            prazosSelecionados.forEach(id => {
                const prazo = prazosArquivados.find(p => p.id === id);
                if (prazo) {
                    prazosParaDesarquivar.push(prazo);
                }
            });

            // Mover para ativos
            prazos.push(...prazosParaDesarquivar);

            // Remover dos arquivados
            prazosArquivados = prazosArquivados.filter(p => !prazosSelecionados.has(p.id));

            // Salvar
            salvarPrazosStorage();
            salvarArquivadosStorage();

            // Fechar menu e sair do modo
            document.getElementById('menuAcoesSelecao').style.display = 'none';
            sairModoSelecao();

            mostrarNotificacao(`${prazosParaDesarquivar.length} prazo(s) desarquivado(s)!`, 'sucesso');
        }

        function excluirSelecionados() {
            if (prazosSelecionados.size === 0) {
                mostrarNotificacao('Nenhum prazo selecionado.', 'aviso');
                return;
            }

            const fonteDados = modoVisualizacao === 'arquivados' ? prazosArquivados : prazos;
            const quantidade = prazosSelecionados.size;

            if (modoVisualizacao === 'arquivados') {
                // Excluir dos arquivados
                prazosArquivados = prazosArquivados.filter(p => !prazosSelecionados.has(p.id));
                salvarArquivadosStorage();
            } else {
                // Excluir dos ativos
                prazos = prazos.filter(p => !prazosSelecionados.has(p.id));
                salvarPrazosStorage();
            }

            // Fechar menu e sair do modo
            document.getElementById('menuAcoesSelecao').style.display = 'none';
            sairModoSelecao();

            mostrarNotificacao(`${quantidade} prazo(s) excluído(s)!`, 'sucesso');
        }

        // Fechar menu de ações ao clicar fora
        document.addEventListener('click', function(event) {
            const menu = document.getElementById('menuAcoesSelecao');
            const btnAcoes = event.target.closest('.btn-selecao-acoes');

            if (menu && !btnAcoes && !event.target.closest('.menu-acoes-selecao')) {
                menu.style.display = 'none';
            }
        });

        // Toggle visualização entre prazos ativos e arquivados
        function toggleVisualizacaoArquivados() {
            const btn = document.getElementById('btnVerArquivados');
            const textoBtn = document.getElementById('textoVerArquivados');
            const filtrosStatus = document.querySelectorAll('.filtro-btn:not(#btnVerArquivados)');

            if (modoVisualizacao === 'ativos') {
                // Mudar para arquivados
                modoVisualizacao = 'arquivados';
                textoBtn.textContent = 'Ver Ativos';
                btn.classList.add('active');
                filtroAtual = 'todos'; // Resetar filtro ao mudar visualização

                // Ocultar outros filtros
                filtrosStatus.forEach(btn => {
                    btn.classList.remove('active');
                    btn.style.display = 'none';
                });
            } else {
                // Mudar para ativos
                modoVisualizacao = 'ativos';
                textoBtn.textContent = 'Ver Arquivados';
                btn.classList.remove('active');

                // Mostrar outros filtros novamente
                filtrosStatus.forEach(btn => {
                    btn.style.display = 'inline-flex';
                });
                document.querySelector('.filtro-btn[data-filtro="todos"]').classList.add('active');
            }

            // Resetar para primeira página e renderizar
            paginaAtual = 1;
            renderizarPrazos();
        }

        // Verificar prazos vencendo (ao carregar página)
        function verificarPrazosVencendo() {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);

            let atrasados = 0;
            let vencendoHoje = 0;
            let vencendoProximos3Dias = 0;

            prazos.forEach(prazo => {
                if (prazo.status === 'concluido') return;

                const dataFinal = new Date(prazo.dataFinal);
                dataFinal.setHours(0, 0, 0, 0);

                if (dataFinal < hoje) {
                    atrasados++;
                } else if (dataFinal.getTime() === hoje.getTime()) {
                    vencendoHoje++;
                } else {
                    const diffDays = Math.ceil((dataFinal - hoje) / (1000 * 60 * 60 * 24));
                    if (diffDays <= 3) {
                        vencendoProximos3Dias++;
                    }
                }
            });

            // Mostrar banner se houver prazos vencendo ou atrasados
            if (atrasados > 0 || vencendoHoje > 0) {
                let mensagem = '';
                if (atrasados > 0 && vencendoHoje > 0) {
                    mensagem = `Você tem ${atrasados} prazo(s) atrasado(s) e ${vencendoHoje} vencendo hoje!`;
                } else if (atrasados > 0) {
                    mensagem = `Você tem ${atrasados} prazo(s) atrasado(s)!`;
                } else {
                    mensagem = `Você tem ${vencendoHoje} prazo(s) vencendo hoje!`;
                }

                mostrarBannerPrazos(mensagem, 'urgente');
            } else if (vencendoProximos3Dias > 0) {
                mostrarBannerPrazos(`Você tem ${vencendoProximos3Dias} prazo(s) vencendo nos próximos 3 dias.`, 'aviso');
            }
        }

        // Mostrar banner de prazos
        function mostrarBannerPrazos(mensagem, tipo) {
            const banner = document.getElementById('updateBanner');
            const title = document.getElementById('updateBannerTitle');
            const description = document.getElementById('updateBannerDescription');

            if (tipo === 'urgente') {
                title.textContent = '⚠️ Atenção: Prazos Urgentes!';
            } else {
                title.textContent = '📅 Prazos Próximos';
            }

            description.textContent = mensagem;

            // Modificar botão para ir à agenda
            const btnAtualizar = banner.querySelector('.update-banner-btn-primary');
            btnAtualizar.textContent = 'Ver Agenda';
            btnAtualizar.onclick = function() {
                trocarPagina('agenda');
                fecharBannerAtualizacao();
            };

            banner.classList.add('active');
        }

        // Carregar editores de feriados
        function carregarEditoresFeriados() {
            // Carregar feriados fixos no formato brasileiro DD-MM
            let textoFixos = '';
            for (let [data, nome] of Object.entries(feriadosFixos)) {
                textoFixos += `${converterMesDiaParaBrasileiro(data)} ${nome}\n`;
            }
            document.getElementById('editorFeriadosFixos').value = textoFixos.trim();

            // Carregar feriados móveis no formato brasileiro DD-MM-YYYY
            let textoMoveis = '';
            for (let [ano, feriados] of Object.entries(feriadosMoveis)) {
                for (let [data, nome] of Object.entries(feriados)) {
                    textoMoveis += `${converterMesDiaParaBrasileiro(data)}-${ano} ${nome}\n`;
                }
            }
            document.getElementById('editorFeriadosMoveis').value = textoMoveis.trim();

            // Carregar feriados personalizados no formato brasileiro DD-MM-YYYY Nome
            let textoPersonalizados = '';
            const feriadosArray = Array.from(feriadosPersonalizados.entries()).sort((a, b) => a[0].localeCompare(b[0]));
            for (let [data, nome] of feriadosArray) {
                const dataBR = converterParaFormatoBrasileiro(data);
                textoPersonalizados += nome ? `${dataBR} ${nome}\n` : `${dataBR}\n`;
            }
            document.getElementById('editorFeriadosPersonalizados').value = textoPersonalizados.trim();

            // Atualizar visualizações
            atualizarVisualizacaoFeriados();
        }

        // Atualizar visualização de feriados
        function atualizarVisualizacaoFeriados() {
            // Feriados fixos - exibir no formato brasileiro DD-MM
            let htmlFixos = '';
            for (let [data, nome] of Object.entries(feriadosFixos)) {
                const dataBR = converterMesDiaParaBrasileiro(data);
                htmlFixos += `
                    <div class="feriado-item fixo">
                        <span><strong>${dataBR}</strong> - ${nome}</span>
                    </div>
                `;
            }
            document.getElementById('listaFeriadosFixos').innerHTML = htmlFixos || '<p style="color: #6b7280; text-align: center; padding: 20px;">Nenhum feriado fixo configurado</p>';

            // Feriados móveis - exibir no formato brasileiro DD-MM-YYYY
            let htmlMoveis = '';
            for (let [ano, feriados] of Object.entries(feriadosMoveis)) {
                for (let [data, nome] of Object.entries(feriados)) {
                    const dataBR = `${converterMesDiaParaBrasileiro(data)}-${ano}`;
                    htmlMoveis += `
                        <div class="feriado-item movel">
                            <span><strong>${dataBR}</strong> - ${nome}</span>
                        </div>
                    `;
                }
            }
            document.getElementById('listaFeriadosMoveis').innerHTML = htmlMoveis || '<p style="color: #6b7280; text-align: center; padding: 20px;">Nenhum feriado móvel configurado</p>';

            // Feriados personalizados - exibir no formato brasileiro DD-MM-YYYY Nome
            let htmlPersonalizados = '';
            const feriadosArray = Array.from(feriadosPersonalizados.entries()).sort((a, b) => a[0].localeCompare(b[0]));
            for (let [data, nome] of feriadosArray) {
                const dataBR = converterParaFormatoBrasileiro(data);
                const conteudo = nome ? `<strong>${dataBR}</strong> - ${nome}` : `<strong>${dataBR}</strong>`;
                htmlPersonalizados += `
                    <div class="feriado-item personalizado">
                        <span>${conteudo}</span>
                    </div>
                `;
            }
            document.getElementById('listaFeriadosPersonalizados').innerHTML = htmlPersonalizados || '<p style="color: #6b7280; text-align: center; padding: 20px;">Nenhum feriado personalizado configurado</p>';
        }

        // Salvar feriados personalizados do editor
        function salvarFeriadosPersonalizadosEditor() {
            try {
                const texto = document.getElementById('editorFeriadosPersonalizados').value;
                const novosFeriados = new Map();

                if (texto.trim()) {
                    const linhas = texto.split('\n');
                    for (let linha of linhas) {
                        linha = linha.trim();
                        if (!linha) continue;

                        // Aceita formato DD-MM-YYYY Nome ou DD-MM-YYYY
                        const matchComNome = linha.match(/^(\d{2})-(\d{2})-(\d{4})\s+(.+)$/);
                        const matchSemNome = linha.match(/^(\d{2})-(\d{2})-(\d{4})$/);

                        if (matchComNome) {
                            const [, dia, mes, ano, nome] = matchComNome;
                            // Converte para formato interno YYYY-MM-DD
                            novosFeriados.set(`${ano}-${mes}-${dia}`, nome.trim());
                        } else if (matchSemNome) {
                            const [, dia, mes, ano] = matchSemNome;
                            // Converte para formato interno YYYY-MM-DD
                            novosFeriados.set(`${ano}-${mes}-${dia}`, '');
                        } else {
                            throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM-YYYY Nome (nome é opcional)`);
                        }
                    }
                }

                if (confirm(`Deseja salvar ${novosFeriados.size} feriado(s) personalizado(s)?\n\nIsso substituirá todos os feriados personalizados atuais.`)) {
                    feriadosPersonalizados = novosFeriados;

                    // Salva no formato novo: array de objetos {data, nome}
                    const dadosParaSalvar = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                        data,
                        nome: nome || ''
                    }));
                    localStorage.setItem('feriadosPersonalizados', JSON.stringify(dadosParaSalvar));

                    atualizarVisualizacaoFeriados();
                    renderizarCalendario();
                    notificarAlteracaoFeriados();
                    mostrarNotificacao('Feriados personalizados salvos com sucesso!', 'sucesso');
                    mostrarAvisoRecalculo();
                }
            } catch (error) {
                mostrarNotificacao('Erro ao processar os feriados: ' + error.message, 'erro');
            }
        }

        // Salvar feriados em batch
        function salvarFeriadosBatch() {
            try {
                // Processar feriados fixos
                const textoFixos = document.getElementById('editorFeriadosFixos').value;
                const novosFeriadosFixos = {};

                if (textoFixos.trim()) {
                    const linhasFixos = textoFixos.split('\n');
                    for (let linha of linhasFixos) {
                        linha = linha.trim();
                        if (!linha) continue;

                        // Tenta formato brasileiro DD-MM (preferencial)
                        let match = linha.match(/^(\d{2})-(\d{2})\s+(.+)$/);
                        if (match) {
                            const dia = match[1];
                            const mes = match[2];
                            const nome = match[3];

                            // Valida se é formato brasileiro (dia válido 01-31)
                            const diaNum = parseInt(dia);
                            const mesNum = parseInt(mes);

                            if (diaNum >= 1 && diaNum <= 31 && mesNum >= 1 && mesNum <= 12) {
                                // Formato brasileiro DD-MM - converte para formato interno MM-DD
                                novosFeriadosFixos[`${mes}-${dia}`] = nome;
                            } else if (mesNum >= 1 && mesNum <= 31 && diaNum >= 1 && diaNum <= 12) {
                                // Formato americano MM-DD (retrocompatibilidade)
                                novosFeriadosFixos[`${dia}-${mes}`] = nome;
                            } else {
                                throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM Nome do Feriado`);
                            }
                        } else {
                            throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM Nome do Feriado`);
                        }
                    }
                }

                // Processar feriados móveis
                const textoMoveis = document.getElementById('editorFeriadosMoveis').value;
                const novosFeriadosMoveis = {};

                if (textoMoveis.trim()) {
                    const linhasMoveis = textoMoveis.split('\n');
                    for (let linha of linhasMoveis) {
                        linha = linha.trim();
                        if (!linha) continue;

                        // Tenta formato brasileiro DD-MM-YYYY
                        let matchBR = linha.match(/^(\d{2})-(\d{2})-(\d{4})\s+(.+)$/);
                        if (matchBR) {
                            const dia = matchBR[1];
                            const mes = matchBR[2];
                            const ano = matchBR[3];
                            const nome = matchBR[4];

                            // Converte para formato interno YYYY-MM-DD (mas armazena como MM-DD no objeto)
                            if (!novosFeriadosMoveis[ano]) {
                                novosFeriadosMoveis[ano] = {};
                            }
                            novosFeriadosMoveis[ano][`${mes}-${dia}`] = nome;
                        } else {
                            // Tenta formato americano YYYY-MM-DD (retrocompatibilidade)
                            let matchUS = linha.match(/^(\d{4})-(\d{2})-(\d{2})\s+(.+)$/);
                            if (matchUS) {
                                const ano = matchUS[1];
                                const mes = matchUS[2];
                                const dia = matchUS[3];
                                const nome = matchUS[4];

                                if (!novosFeriadosMoveis[ano]) {
                                    novosFeriadosMoveis[ano] = {};
                                }
                                novosFeriadosMoveis[ano][`${mes}-${dia}`] = nome;
                            } else {
                                throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM-YYYY Nome do Feriado`);
                            }
                        }
                    }
                }

                // Confirmar antes de salvar
                const totalFixos = Object.keys(novosFeriadosFixos).length;
                const totalMoveis = Object.values(novosFeriadosMoveis).reduce((acc, f) => acc + Object.keys(f).length, 0);

                if (confirm(`Deseja salvar as configurações?\n\n✓ ${totalFixos} feriado(s) fixo(s)\n✓ ${totalMoveis} feriado(s) móvel(is)\n\nIsso substituirá as configurações atuais.`)) {
                    // Atualizar variáveis globais
                    Object.keys(feriadosFixos).forEach(key => delete feriadosFixos[key]);
                    Object.assign(feriadosFixos, novosFeriadosFixos);

                    Object.keys(feriadosMoveis).forEach(key => delete feriadosMoveis[key]);
                    Object.assign(feriadosMoveis, novosFeriadosMoveis);

                    // Salvar no localStorage
                    localStorage.setItem('feriadosFixos', JSON.stringify(feriadosFixos));
                    localStorage.setItem('feriadosMoveis', JSON.stringify(feriadosMoveis));

                    atualizarVisualizacaoFeriados();
                    renderizarCalendario();

                    // Marca flags para o reload
                    sessionStorage.setItem('reloadToTop', 'true');
                    sessionStorage.setItem('contaprazo_notificacao_pendente', JSON.stringify({ mensagem: 'Configurações salvas com sucesso!', tipo: 'sucesso' }));

                    // Recarrega a página para aplicar as configurações
                    location.reload();
                }
            } catch (error) {
                mostrarNotificacao('Erro ao processar os feriados: ' + error.message, 'erro');
            }
        }

        // Resetar feriados para padrão
        function resetarFeriadosPadrao() {
            if (!confirm('🔄 Deseja restaurar os feriados padrão?\n\nIsso irá substituir todas as configurações atuais de feriados fixos e móveis pelos valores padrão do Brasil.\n\nA página será recarregada para aplicar as mudanças.')) {
                return;
            }

            // Feriados fixos padrão do Brasil
            const feriadosFixosPadrao = {
                '01-01': 'Ano Novo',
                '04-21': 'Tiradentes',
                '05-01': 'Dia do Trabalho',
                '09-07': 'Independência',
                '10-12': 'Nossa Senhora Aparecida',
                '11-02': 'Finados',
                '11-15': 'Proclamação da República',
                '11-20': 'Consciência Negra',
                '12-25': 'Natal'
            };

            // Feriados móveis padrão
            const feriadosMoveisPadrao = {
                2025: {
                    '03-03': 'Carnaval (seg)',
                    '03-04': 'Carnaval (ter)',
                    '04-18': 'Sexta-feira Santa',
                    '06-19': 'Corpus Christi'
                },
                2026: {
                    '02-16': 'Carnaval (seg)',
                    '02-17': 'Carnaval (ter)',
                    '04-03': 'Sexta-feira Santa',
                    '06-04': 'Corpus Christi'
                }
            };

            // Atualizar variáveis globais
            Object.keys(feriadosFixos).forEach(key => delete feriadosFixos[key]);
            Object.assign(feriadosFixos, feriadosFixosPadrao);

            Object.keys(feriadosMoveis).forEach(key => delete feriadosMoveis[key]);
            Object.assign(feriadosMoveis, feriadosMoveisPadrao);

            // Salvar no localStorage
            localStorage.setItem('feriadosFixos', JSON.stringify(feriadosFixos));
            localStorage.setItem('feriadosMoveis', JSON.stringify(feriadosMoveis));

            // Marca flags para o reload
            sessionStorage.setItem('reloadToTop', 'true');
            sessionStorage.setItem('contaprazo_notificacao_pendente', JSON.stringify({ mensagem: 'Feriados padrão restaurados com sucesso!', tipo: 'sucesso' }));

            // Recarrega a página para aplicar as configurações
            location.reload();
        }

        // Inicializar
        // Carregar feriados do localStorage se existirem
        // Importante: limpar defaults antes de carregar, para que remoções feitas no editor persistam
        const feriadosFixosSalvos = localStorage.getItem('feriadosFixos');
        if (feriadosFixosSalvos) {
            Object.keys(feriadosFixos).forEach(key => delete feriadosFixos[key]);
            Object.assign(feriadosFixos, JSON.parse(feriadosFixosSalvos));
        }

        const feriadosMoveisSalvos = localStorage.getItem('feriadosMoveis');
        if (feriadosMoveisSalvos) {
            Object.keys(feriadosMoveis).forEach(key => delete feriadosMoveis[key]);
            Object.assign(feriadosMoveis, JSON.parse(feriadosMoveisSalvos));
        }

        // Adiciona listeners para mostrar aviso quando modificar parâmetros do cálculo
        document.getElementById('dataInicio').addEventListener('change', function() {
            mostrarAvisoRecalculo();
        });

        document.getElementById('diasUteis').addEventListener('input', function() {
            mostrarAvisoRecalculo();
        });

        inicializarPerfis();
        renderizarCalendario();
        atualizarTextoBotaoVisualizacao();

        // Função para scroll suave ao topo
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Controlar visibilidade do botão scroll to top
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        });

        // Desabilitar restauração automática de scroll do navegador
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }

        // Event listener para executar após load completo da página
        window.addEventListener('load', function() {
            // Verifica se deve voltar ao topo após reload
            if (sessionStorage.getItem('reloadToTop') === 'true') {
                sessionStorage.removeItem('reloadToTop');
                // Força scroll ao topo e primeira aba
                setTimeout(() => {
                    window.scrollTo(0, 0);
                    trocarPagina('calculo');
                }, 0);
            }

            // Carregar prazos da agenda e verificar vencimentos
            carregarPrazosStorage();
            verificarPrazosVencendo();

            // Inicia verificação periódica de atualizações de feriados
            iniciarVerificacaoPeriodica();
        });

        // Event listener para redimensionamento da janela
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                // Re-renderizar calendário apenas se estiver em visualização mensal
                if (visualizacaoCalendario === 'mensal') {
                    renderizarCalendario();
                    atualizarTextoBotaoVisualizacao();
                }
            }, 250); // Debounce de 250ms
        });
    </script>

    <!-- Modal de Aviso de Recálculo -->
    <div id="modalAvisoRecalculo" class="modal-aviso">
        <div class="modal-aviso-content">
            <div class="modal-aviso-icon">ℹ️</div>
            <h3>Recálculo Necessário</h3>
            <p>Você modificou os parâmetros do cálculo. Recalcule para ver o resultado atualizado.</p>
            <div class="modal-aviso-checkbox">
                <label>
                    <input type="checkbox" id="naoMostrarAvisoNovamente">
                    Não mostrar este aviso novamente
                </label>
            </div>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-secondary" onclick="fecharAvisoRecalculo()">Fechar</button>
                <button class="btn btn-primary" onclick="fecharAvisoRecalculo(); calcularPrazo();">Recalcular Agora</button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirmação de Reset -->
    <div id="modalResetCompleto" class="modal-aviso">
        <div class="modal-aviso-content" style="max-width: 500px;">
            <div class="modal-aviso-icon">⚠️</div>
            <h3>Restaurar Configurações Padrão</h3>
            <p style="text-align: left; margin-bottom: 20px;">
                Esta ação irá <strong>restaurar todas as configurações</strong> para os valores originais:
            </p>
            <ul style="text-align: left; margin: 0 0 20px 20px; color: #374151; line-height: 1.8;">
                <li>Todos os <strong>feriados personalizados</strong> serão removidos</li>
                <li>Feriados <strong>fixos e móveis</strong> voltarão ao padrão</li>
                <li>Preferência de <strong>avisos</strong> será resetada</li>
            </ul>
            <p style="text-align: left; color: #991b1b; font-weight: 600; margin-bottom: 20px;">
                ⚠️ Esta ação não pode ser desfeita!
            </p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-secondary" onclick="fecharModalReset()">Cancelar</button>
                <button class="btn" onclick="executarResetCompleto()" style="background: #dc2626; color: white;">
                    Confirmar Reset
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Prazo -->
    <div id="modalDetalhesPrazo" class="modal-detalhes">
        <div class="modal-detalhes-content">
            <div class="modal-detalhes-header">
                <h2 class="modal-detalhes-titulo" id="modalDetalhesTitulo">Detalhes do Prazo</h2>
                <button class="modal-detalhes-fechar" onclick="fecharModalDetalhes()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-detalhes-body" id="modalDetalhesBody">
                <!-- Conteúdo será preenchido dinamicamente -->
            </div>
            <div class="modal-detalhes-acoes">
                <button class="btn btn-success" onclick="marcarConcluidoModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    Marcar Concluído
                </button>
                <button class="btn btn-primary" onclick="editarPrazoModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Editar
                </button>
                <button class="btn btn-red" onclick="excluirPrazoModal()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                    Excluir
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Edição -->
    <div id="modalEditarPrazo" class="modal-aviso">
        <div class="modal-aviso-content" style="max-width: 500px;">
            <div class="modal-aviso-icon">✏️</div>
            <h3>Editar Prazo</h3>
            <p style="margin-bottom: 15px; color: #6b7280; font-size: 0.9rem;">
                Edite o título e a descrição do prazo. As datas e cálculos são mantidos para auditoria.
            </p>
            <div style="margin: 20px 0;">
                <label for="editTitulo" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Título:</label>
                <input type="text" id="editTitulo" placeholder="Ex: Recurso Processo 12345"
                    style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1rem;">
            </div>
            <div style="margin: 20px 0;">
                <label for="editDescricao" style="display: block; margin-bottom: 8px; font-weight: 600; color: #374151;">Descrição (opcional):</label>
                <textarea id="editDescricao" placeholder="Detalhes adicionais..." rows="3"
                    style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 1rem; resize: vertical;"></textarea>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="fecharModalEditar()">Cancelar</button>
                <button class="btn btn-primary" onclick="salvarEdicao()">Salvar Alterações</button>
            </div>
        </div>
    </div>

    <!-- Toast de Undo -->
    <div id="toastUndo" class="toast-undo">
        <span class="toast-undo-texto" id="toastUndoTexto">Prazo marcado como concluído</span>
        <button class="toast-undo-btn" onclick="desfazerAcao()">Desfazer</button>
    </div>

    <!-- Modal de Input de Título -->
    <div id="modalInputTitulo" class="modal-input-titulo">
        <div class="modal-input-content">
            <div class="modal-input-header">
                <h3>💾 Salvar Prazo na Agenda</h3>
            </div>
            <div class="modal-input-body">
                <div class="modal-input-group">
                    <label for="inputTituloPrazo">Título do Prazo *</label>
                    <input type="text" id="inputTituloPrazo" placeholder="Ex: Recurso Processo 12345" autocomplete="off" required>
                </div>
                <div class="modal-input-group">
                    <label for="inputDescricaoPrazo">Descrição (opcional)</label>
                    <textarea id="inputDescricaoPrazo" placeholder="Detalhes adicionais sobre o prazo..." rows="3"></textarea>
                </div>
            </div>
            <div class="modal-input-footer">
                <button class="btn btn-secondary" onclick="fecharModalInputTitulo()">Cancelar</button>
                <button class="btn btn-success" onclick="confirmarSalvarPrazo()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"/>
                        <polyline points="17 21 17 13 7 13 7 21"/>
                        <polyline points="7 3 7 8 15 8"/>
                    </svg>
                    Salvar na Agenda
                </button>
            </div>
        </div>
    </div>

    <!-- Input invisível para importação de arquivo -->
    <input type="file" id="inputImportAgenda" accept=".json" style="display: none;" onchange="processarImportAgenda(event)">

    <!-- Banner de Notificação de Prazo Salvo -->
    <div id="bannerPrazoSalvo" class="update-banner">
        <div class="update-banner-content">
            <div class="update-banner-icon">✅</div>
            <div class="update-banner-text">
                <div class="update-banner-title">Prazo salvo com sucesso!</div>
                <div class="update-banner-description">O prazo foi adicionado à sua agenda.</div>
            </div>
            <div class="update-banner-actions">
                <button class="update-banner-btn update-banner-btn-primary" onclick="irParaAgenda()">
                    Ver Agenda
                </button>
                <button class="update-banner-btn update-banner-btn-secondary" onclick="fecharBannerPrazoSalvo()">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Banner de Notificação Genérico -->
    <div id="bannerNotificacao" class="update-banner">
        <div class="update-banner-content">
            <div class="update-banner-icon" id="notificacaoIcone">✅</div>
            <div class="update-banner-text">
                <div class="update-banner-title" id="notificacaoTitulo">Sucesso!</div>
                <div class="update-banner-description" id="notificacaoDescricao">Operação realizada com sucesso.</div>
            </div>
            <div class="update-banner-actions">
                <button class="update-banner-btn update-banner-btn-primary" id="notificacaoBtnPrimario" style="display:none;">
                    Ação
                </button>
                <button class="update-banner-btn update-banner-btn-secondary" id="notificacaoBtnSecundario" onclick="fecharNotificacao()">
                    OK
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Arquivamento -->
    <div id="modalArquivamento" class="modal-detalhes">
        <div class="modal-detalhes-content" style="max-width: 600px;">
            <div class="modal-detalhes-header">
                <h2>Arquivar Prazos Concluídos</h2>
                <button class="modal-fechar" onclick="fecharModalArquivamento()">×</button>
            </div>
            <div class="modal-detalhes-body">
                <p style="margin-bottom: 20px; color: #6b7280;">
                    Escolha como deseja gerenciar os prazos concluídos:
                </p>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="opcao-arquivamento" onclick="arquivarAntigos()">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 1.5rem;">📦</div>
                            <div>
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                    Arquivar antigos (>90 dias)
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280;">
                                    Move prazos concluídos há mais de 90 dias para o arquivo
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="opcao-arquivamento" onclick="arquivarTodos()">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 1.5rem;">📁</div>
                            <div>
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                    Arquivar todos os concluídos
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280;">
                                    Move TODOS os prazos concluídos para o arquivo
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="opcao-arquivamento opcao-perigo" onclick="excluirTodosConcluidos()">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 1.5rem;">🗑️</div>
                            <div>
                                <div style="font-weight: 600; color: #dc2626; margin-bottom: 4px;">
                                    Excluir definitivamente
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280;">
                                    Remove permanentemente todos os prazos concluídos
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Desarquivar -->
    <div id="modalDesarquivar" class="modal-detalhes">
        <div class="modal-detalhes-content" style="max-width: 500px;">
            <div class="modal-detalhes-header">
                <h2>Desarquivar Prazo</h2>
                <button class="modal-fechar" onclick="fecharModalDesarquivar()">×</button>
            </div>
            <div class="modal-detalhes-body">
                <p style="margin-bottom: 20px; color: #6b7280;">
                    Escolha o status que o prazo terá ao voltar para a lista de ativos:
                </p>
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="opcao-arquivamento" onclick="confirmarDesarquivar('pendente')">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 1.5rem;">📋</div>
                            <div>
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                    Voltar como Pendente
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280;">
                                    O prazo será reaberto e ficará com status pendente
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="opcao-arquivamento" onclick="confirmarDesarquivar('concluido')">
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div style="font-size: 1.5rem;">✅</div>
                            <div>
                                <div style="font-weight: 600; color: #1f2937; margin-bottom: 4px;">
                                    Manter como Concluído
                                </div>
                                <div style="font-size: 0.875rem; color: #6b7280;">
                                    O prazo permanecerá marcado como concluído
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
