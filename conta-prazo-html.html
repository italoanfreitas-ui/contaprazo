<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ContaPrazo Calculadora</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='grad' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%233b82f6;stop-opacity:1' /%3E%3Cstop offset='100%25' style='stop-color:%2316a34a;stop-opacity:1' /%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' rx='15' fill='url(%23grad)'/%3E%3Ctext x='50' y='70' font-family='system-ui, sans-serif' font-size='50' font-weight='800' fill='white' text-anchor='middle'%3ECP%3C/text%3E%3C/svg%3E">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Gradientes principais */
            --gradient-primary: linear-gradient(135deg, #3b82f6, #16a34a);
            --gradient-blue: linear-gradient(135deg, #3b82f6, #2563eb);
            --gradient-green: linear-gradient(135deg, #16a34a, #15803d);
            --gradient-header: linear-gradient(135deg, #f0f9ff 0%, #ecfdf5 100%);
            --gradient-border: linear-gradient(90deg, #3b82f6, #16a34a);

            /* Cores principais */
            --color-blue-500: #3b82f6;
            --color-blue-600: #2563eb;
            --color-green-600: #16a34a;
            --color-green-700: #15803d;

            /* Shadows */
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 6px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 10px 25px rgba(0, 0, 0, 0.3);

            /* Border radius */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;

            /* Transitions */
            --transition-fast: all 0.2s;
            --transition-normal: all 0.3s;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background: #f9fafb;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .page-header {
            background: var(--gradient-header);
            border-bottom: 3px solid;
            border-image: var(--gradient-border) 1;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-md);
        }

        .page-header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-header .brand-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
            font-weight: 500;
            margin-left: 0;
        }

        .brand-separator {
            color: #d1d5db;
            margin: 0 12px;
            font-weight: 300;
        }

        .nav-tabs {
            max-width: 1200px;
            margin: 0 auto 30px;
            display: flex;
            gap: 8px;
            background: #f9fafb;
            padding: 6px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .nav-tab {
            flex: 1;
            padding: 12px 20px;
            border: none;
            background: transparent;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            color: #6b7280;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .nav-tab:hover {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .nav-tab.active {
            background: white;
            color: #1f2937;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .page-content {
            display: none;
        }

        .page-content.active {
            display: block;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 30px;
        }

        .section-title {
            color: #1f2937;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title svg {
            color: #3b82f6;
        }

        .section-divider {
            height: 2px;
            background: linear-gradient(to right, #3b82f6, transparent);
            margin-bottom: 20px;
        }

        .logo-cp {
            width: 56px;
            height: 56px;
            background: var(--gradient-primary);
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 24px;
            color: white;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .brand-title {
            font-size: 2.25rem;
            color: #1f2937;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .brand-conta {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .brand-prazo {
            background: linear-gradient(135deg, #16a34a, #15803d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }


        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        /* Reduzir minmax do form-grid em telas pequenas */
        @media (max-width: 640px) {
            .form-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group-with-toggle {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .dias-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .dias-input-container {
            flex: 1;
        }

        .data-input-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .data-input-wrapper input[type="date"] {
            flex: 1;
        }

        .btn-data-hoje {
            padding: 12px 16px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(59, 130, 246, 0.2);
            transition: all 0.2s;
            white-space: nowrap;
            cursor: pointer;
            flex-shrink: 0;
        }

        .btn-data-hoje:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
        }

        .btn-data-hoje:active {
            transform: translateY(0);
        }

        label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        input[type="date"],
        input[type="number"],
        textarea {
            padding: 12px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
            font-family: inherit;
        }

        input:focus,
        textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Toggle Switch Moderno */
        .toggle-container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding-top: 8px;
        }

        .toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch {
            position: relative;
            width: 56px;
            height: 28px;
            background: #d1d5db;
            border-radius: 14px;
            cursor: pointer;
            transition: background 0.3s;
            flex-shrink: 0;
        }

        .toggle-switch.active {
            background: #16a34a;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 12px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(28px);
        }

        .toggle-label {
            font-size: 0.875rem;
            color: #374151;
            font-weight: 500;
        }

        .quick-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            flex: 1 1 auto;
            min-width: fit-content;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(107, 114, 128, 0.3);
        }

        .btn-success {
            background: #16a34a;
            color: white;
        }

        .btn-success:hover {
            background: #15803d;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(22, 163, 74, 0.3);
        }

        .btn-purple {
            background: #9333ea;
            color: white;
        }

        .btn-purple:hover {
            background: #7e22ce;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(147, 51, 234, 0.3);
        }

        .btn-red {
            background: #dc2626;
            color: white;
        }

        .btn-red:hover {
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(220, 38, 38, 0.3);
        }

        .btn-indigo {
            background: #6366f1;
            color: white;
        }

        .btn-indigo:hover {
            background: #4f46e5;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(99, 102, 241, 0.3);
        }

        .btn-quick {
            flex: 1;
            background: #f3f4f6;
            color: #374151;
            padding: 8px 12px;
        }

        .btn-quick:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn-group .btn {
            flex: 1 1 calc(33.333% - 10px);
            min-width: 200px;
            white-space: normal;
            text-align: center;
            line-height: 1.3;
        }

        .btn svg {
            flex-shrink: 0;
            min-width: 18px;
            min-height: 18px;
        }

        /* Breakpoint inteligente: quando o espaço ficar apertado */
        @media (max-width: 900px) {
            .btn-group .btn {
                font-size: 0.85rem;
                min-width: 180px;
                padding: 10px 16px;
            }
        }

        @media (max-width: 768px) {
            .btn-group .btn {
                flex: 1 1 calc(50% - 10px);
                min-width: 160px;
            }
        }

        @media (max-width: 640px) {
            .btn-group .btn {
                flex: 1 1 100%;
                font-size: 0.95rem;
                white-space: nowrap;
            }
        }

        .resultado {
            background: linear-gradient(to right, #f0fdf4, #dbeafe);
            border: 2px solid #86efac;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .resultado h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .resultado-info {
            margin: 15px 0;
            font-size: 1.125rem;
        }

        .resultado-info strong {
            color: #374151;
        }

        .resultado-descricao {
            background: white;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin: 20px 0;
            border-radius: 6px;
            font-style: italic;
            color: #1f2937;
        }

        .resultado-descricao strong {
            font-style: normal;
            color: #3b82f6;
        }

        .data-final {
            color: #15803d;
            font-size: 1.5rem;
            font-weight: bold;
        }

        .detalhamento {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .detalhamento h3 {
            color: #1f2937;
            margin-bottom: 15px;
        }

        .dia-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin: 5px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .dia-contado {
            background: #dcfce7;
            border-color: #22c55e;
        }

        .dia-nao-contado {
            background: #fef2f2;
            border-color: #ef4444;
        }

        .dia-numero {
            font-weight: bold;
            min-width: 30px;
        }

        .dia-contado .dia-numero {
            color: #166534;
        }

        .dia-nao-contado .dia-numero {
            color: #991b1b;
        }

        /* Removido margin-top para alinhar com o formulário no layout de duas colunas */
        @media (max-width: 1024px) {
            .calendario {
                margin-top: 0;
            }
        }

        .calendario-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid;
            border-image: linear-gradient(90deg, #e5e7eb, #d1d5db, #e5e7eb) 1;
        }

        .calendario-nav-row {
            display: grid;
            grid-template-columns: 32px 1fr 32px;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .calendario-actions-row {
            display: flex;
            gap: 10px;
            align-items: center;
            justify-content: center;
        }

        .calendario-header h2 {
            font-size: 1.5rem;
            color: #1f2937;
            margin: 0;
            text-align: center;
        }

        .btn-nav {
            width: 32px !important;
            height: 32px !important;
            min-width: 32px !important;
            padding: 0 !important;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            border-radius: 6px !important;
            background: #f3f4f6 !important;
            border: 1px solid #d1d5db !important;
            color: #374151 !important;
            transition: all 0.2s;
        }

        .btn-nav:hover {
            border-color: #3b82f6 !important;
            background: #dbeafe !important;
            color: #1e40af !important;
            transform: translateY(-1px);
        }

        .btn-nav svg {
            stroke: currentColor;
        }

        .btn-hoje {
            padding: 8px 14px;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            box-shadow: 0 1px 3px rgba(59, 130, 246, 0.2);
            transition: all 0.2s;
            flex: 0 0 auto;
            white-space: nowrap;
            cursor: pointer;
        }

        .btn-hoje:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(59, 130, 246, 0.3);
        }

        .visualizacao-toggle {
            display: flex;
            gap: 5px;
            background: #f3f4f6;
            padding: 4px;
            border-radius: 8px;
        }

        .visualizacao-toggle button {
            padding: 8px 16px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            color: #6b7280;
        }

        .visualizacao-toggle button.active {
            background: white;
            color: #1f2937;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        .calendario-anual {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        @media (max-width: 900px) {
            .calendario-anual {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 600px) {
            .calendario-anual {
                grid-template-columns: 1fr;
            }
        }

        .mes-mini {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
        }

        .mes-mini h4 {
            text-align: center;
            color: #1f2937;
            margin-bottom: 10px;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .calendario-mini-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }

        .calendario-mini-dia-semana {
            text-align: center;
            font-size: 0.7rem;
            font-weight: 600;
            color: #6b7280;
            padding: 4px 2px;
        }

        .calendario-mini-dia {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendario-mini-dia:hover:not(.fim-semana) {
            background: #f3f4f6;
        }

        .config-feriados {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0;
            margin-top: 20px;
            overflow: hidden;
        }

        .config-feriados-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            cursor: pointer;
            user-select: none;
            background: #f9fafb;
            transition: background 0.2s;
        }

        .config-feriados-header:hover {
            background: #f3f4f6;
        }

        .config-feriados-header h3 {
            margin: 0;
            color: #1f2937;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-feriados-toggle {
            font-size: 1.2rem;
            color: #6b7280;
            transition: transform 0.3s;
        }

        .config-feriados-toggle.aberto {
            transform: rotate(180deg);
        }

        .config-feriados-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }

        .config-feriados-content.aberto {
            max-height: 1000px;
        }

        .config-feriados-body {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .config-secao {
            margin-bottom: 20px;
        }

        .config-secao h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .config-divisor {
            height: 1px;
            background: #e5e7eb;
            margin: 20px 0;
        }

        .toggle-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-ativo {
            background: #16a34a;
            color: white;
        }

        .toggle-inativo {
            background: #d1d5db;
            color: #4b5563;
        }

        .calendario-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .calendario-dia-semana {
            text-align: center;
            font-weight: bold;
            color: #4b5563;
            padding: 10px;
        }

        .calendario-dia {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            min-height: 40px;
        }

        .calendario-dia:hover:not(.fim-semana) {
            background: #f3f4f6;
            transform: scale(1.05);
        }

        .fim-semana {
            background: #e5e7eb;
            color: #6b7280;
            cursor: default;
        }

        .feriado {
            background: #fecaca;
            color: #991b1b;
            font-weight: 600;
        }

        .feriado-personalizado {
            background: #e9d5ff;
            color: #6b21a8;
            font-weight: 600;
        }

        .feriado-em-fds {
            /* Mantém o fundo cinza do fim-semana, mas texto vermelho negrito como feriado */
            color: #991b1b !important;
            font-weight: 700 !important;
        }

        .dia-inicio {
            background: #3b82f6;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 0 2px #2563eb;
        }

        .dia-final {
            background: #16a34a;
            color: white;
            font-weight: bold;
            box-shadow: 0 0 0 2px #15803d;
        }

        .dia-percorrido {
            background: #fef3c7;
        }

        .legenda {
            background: #f9fafb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .legenda h3 {
            margin-bottom: 15px;
            color: #1f2937;
        }

        .legenda-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .legenda-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.875rem;
        }

        .legenda-cor {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: 1px solid #d1d5db;
        }

        .rodape {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e5e7eb;
        }

        .rodape a {
            color: #6b7280;
            text-decoration: underline;
            font-size: 0.875rem;
        }

        .rodape a:hover {
            color: #374151;
        }

        /* Modal para importar feriados */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 20px;
        }

        .modal-body {
            margin-bottom: 20px;
            color: #374151;
            line-height: 1.6;
        }

        .modal-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin: 20px 0;
        }

        .modal-option {
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .modal-option:hover {
            border-color: #3b82f6;
            background: #f0f9ff;
        }

        .modal-option-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 5px;
        }

        .modal-option-desc {
            font-size: 0.875rem;
            color: #6b7280;
        }

        /* Estilos para itens do dropdown de conjuntos pré-definidos */
        .item-predefinido {
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 12px;
            background: white;
        }

        .item-predefinido:hover {
            border-color: var(--primary-color);
            background: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .item-predefinido-nome {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 6px;
            font-size: 0.95rem;
        }

        .item-predefinido-desc {
            font-size: 0.875rem;
            color: #6b7280;
            margin-bottom: 6px;
            line-height: 1.4;
        }

        .item-predefinido-data {
            font-size: 0.8rem;
            color: #9ca3af;
            font-style: italic;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        /* Modal de Aviso de Recálculo */
        .modal-aviso {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-aviso.active {
            display: flex;
            animation: fadeIn 0.2s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-aviso-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 450px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            text-align: center;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-aviso-icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        .modal-aviso-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 15px;
        }

        .modal-aviso-content p {
            color: #374151;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        .modal-aviso-checkbox {
            margin: 20px 0;
            text-align: left;
        }

        .modal-aviso-checkbox label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #4b5563;
            cursor: pointer;
        }

        .modal-aviso-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* Página de Ajuda */
        .help-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .help-section h3 {
            color: #1f2937;
            font-size: 1.25rem;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-section p {
            color: #4b5563;
            line-height: 1.8;
            margin-bottom: 12px;
        }

        .help-section ul {
            margin-left: 20px;
            color: #4b5563;
            line-height: 1.8;
        }

        .help-section li {
            margin-bottom: 8px;
        }

        .help-section code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 0.9em;
            color: #3b82f6;
        }

        /* Gerenciamento Avançado */
        .batch-editor {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .batch-editor h3 {
            color: #1f2937;
            font-size: 1.25rem;
            margin-bottom: 15px;
        }

        .batch-editor textarea {
            width: 100%;
            min-height: 300px;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            resize: vertical;
        }

        .batch-editor textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .info-box {
            background: #fef2f2;
            border-left: 4px solid #dc2626;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .info-box p {
            margin: 0;
            color: #991b1b;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .warning-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }

        .warning-box p {
            margin: 0;
            color: #92400e;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .feriados-list {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .feriado-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }

        .feriado-item.fixo,
        .feriado-item.movel {
            border-left-color: #fecaca;
        }

        .feriado-item.personalizado {
            border-left-color: #e9d5ff;
        }

        /* Botão scroll to top */
        .scroll-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .scroll-to-top:hover {
            background: rgba(37, 99, 235, 1);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .scroll-to-top.visible {
            display: flex;
        }

        .scroll-to-top svg {
            width: 20px;
            height: 20px;
        }

        /* Responsividade mobile - densidade aumentada para evitar scroll horizontal */
        @media (max-width: 640px) {
            body {
                padding: 8px;
            }

            .container {
                max-width: 100%;
            }

            .page-header {
                padding: 12px;
                margin-bottom: 12px;
            }

            .page-header-content {
                gap: 8px;
            }

            .logo-cp {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }

            .nav-tabs {
                gap: 3px;
                padding: 3px;
                margin-bottom: 12px;
            }

            .nav-tab {
                padding: 8px 10px;
                font-size: 0.8rem;
                gap: 5px;
            }

            /* Proteger ícones SVG do menu de encolher demais */
            .nav-tab svg {
                flex-shrink: 0;
                min-width: 16px;
                min-height: 16px;
            }

            /* Reduzir fonte do cabeçalho para evitar quebra */
            .brand-title {
                font-size: 1.4rem;
            }

            .page-header .brand-subtitle {
                font-size: 0.7rem;
            }

            .card {
                padding: 15px;
                margin-bottom: 15px;
                border-radius: 10px;
            }

            .resultado {
                padding: 15px;
                margin-bottom: 15px;
            }

            .resultado h2 {
                font-size: 1.15rem;
            }

            .resultado-info {
                font-size: 0.95rem;
            }

            .detalhamento h3 {
                font-size: 1rem;
            }

            .dia-item {
                padding: 8px;
                font-size: 0.85rem;
            }

            .calendario-header {
                margin-bottom: 12px;
                padding-bottom: 12px;
            }

            .calendario-header h2 {
                font-size: 1.15rem;
                min-width: 140px;
            }

            .calendario-actions-row {
                gap: 5px;
            }

            .btn-hoje {
                padding: 5px 8px;
                font-size: 0.75rem;
            }

            .visualizacao-toggle button {
                padding: 5px 10px;
                font-size: 0.8rem;
            }

            /* Aplicar zoom out no calendário para evitar scroll horizontal */
            .calendario {
                transform: scale(0.95);
                transform-origin: top center;
                margin-bottom: 10px;
            }

            .calendario-grid {
                gap: 3px;
            }

            .calendario-dia {
                min-height: 35px;
                font-size: 0.8rem;
            }

            .calendario-dia-semana {
                padding: 6px;
                font-size: 0.7rem;
            }

            /* Reduzir espaçamento da legenda */
            .legenda {
                padding: 12px;
                margin-top: 12px;
            }

            .legenda h3 {
                font-size: 0.95rem;
                margin-bottom: 10px;
            }

            .legenda-grid {
                gap: 8px;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .legenda-item {
                font-size: 0.75rem;
            }

            /* Ajustar densidade nas abas de Feriados e Ajuda também */
            .info-box {
                padding: 12px;
                font-size: 0.85rem;
            }

            .feriado-item {
                padding: 10px;
                font-size: 0.85rem;
            }

            /* Ajustar inputs e labels */
            label {
                font-size: 0.85rem;
                margin-bottom: 6px;
            }

            input, select, textarea {
                font-size: 0.9rem;
                padding: 10px;
            }

            .btn-data-hoje {
                padding: 10px 12px;
                font-size: 0.8rem;
            }

            /* Reduzir tamanho dos parágrafos nas abas de editor e ajuda */
            .batch-editor p,
            .help-section p {
                font-size: 0.85rem;
            }

            .batch-editor h5 {
                font-size: 0.95rem;
            }

            .help-section h3 {
                font-size: 1.1rem;
            }

            .help-section h4 {
                font-size: 1rem;
            }
        }

        /* Telas muito pequenas - ajustes adicionais com zoom out mais agressivo */
        @media (max-width: 480px) {
            body {
                padding: 6px;
            }

            .page-header {
                padding: 10px;
            }

            .logo-cp {
                width: 38px;
                height: 38px;
                font-size: 16px;
            }

            /* Cabeçalho ainda menor para telas muito pequenas */
            .brand-title {
                font-size: 1.2rem;
            }

            .page-header .brand-subtitle {
                font-size: 0.65rem;
            }

            .brand-separator {
                font-size: 0.9rem;
            }

            .card {
                padding: 12px;
            }

            .resultado {
                padding: 12px;
            }

            .btn-group {
                gap: 6px;
            }

            .form-group {
                margin-bottom: 12px;
            }

            label {
                font-size: 0.8rem;
            }

            input, select, textarea {
                font-size: 0.85rem;
                padding: 8px;
            }

            .calendario-nav-row {
                gap: 8px;
            }

            .calendario-header h2 {
                font-size: 1rem;
            }

            .legenda-item {
                font-size: 0.7rem;
            }

            /* Zoom out ainda mais agressivo no calendário */
            .calendario {
                transform: scale(0.88);
            }

            .calendario-grid {
                gap: 2px;
            }

            .calendario-dia {
                min-height: 32px;
                font-size: 0.75rem;
            }

            /* Proteger ícones SVG em todos os botões */
            .btn svg, .nav-tab svg {
                flex-shrink: 0;
                min-width: 14px;
                min-height: 14px;
            }

            /* Ajustar botões para não quebrarem */
            .btn {
                font-size: 0.85rem;
                padding: 10px 14px;
            }

            .nav-tab {
                font-size: 0.75rem;
            }
        }

        @media print {
            body {
                padding: 0;
            }
            .card {
                box-shadow: none;
            }
            .btn, .calendario, .legenda, .rodape, .nav-tabs, .page-header {
                display: none !important;
            }
        }
    </style>
    <!-- Biblioteca html2canvas para exportação de PNG -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- Cabeçalho Global -->
    <div class="page-header">
        <div class="page-header-content">
            <div class="logo-cp">CP</div>
            <div>
                <h1 class="brand-title">
                    <span class="brand-conta">Conta</span><span class="brand-prazo">Prazo</span>
                    <span class="brand-separator">|</span>
                    <span class="brand-subtitle">Calculadora de Prazos</span>
                </h1>
            </div>
        </div>
    </div>

    <!-- Menu de Navegação -->
    <div class="nav-tabs">
        <button class="nav-tab active" onclick="trocarPagina('calculo')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
            Cálculo
        </button>
        <button class="nav-tab" onclick="trocarPagina('gerenciamento')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="3"></circle>
                <path d="
            M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06
            a2 2 0 1 1-2.83 2.83l-.06-.06
            a1.65 1.65 0 0 0-1.82-.33
            1.65 1.65 0 0 0-1 1.51V21
            a2 2 0 1 1-4 0v-.09
            a1.65 1.65 0 0 0-1-1.51
            1.65 1.65 0 0 0-1.82.33l-.06.06
            a2 2 0 1 1-2.83-2.83l.06-.06
            a1.65 1.65 0 0 0 .33-1.82
            1.65 1.65 0 0 0-1.51-1H3
            a2 2 0 1 1 0-4h.09
            a1.65 1.65 0 0 0 1.51-1
            1.65 1.65 0 0 0-.33-1.82l-.06-.06
            a2 2 0 1 1 2.83-2.83l.06.06
            a1.65 1.65 0 0 0 1.82.33H9
            a1.65 1.65 0 0 0 1-1.51V3
            a2 2 0 1 1 4 0v.09
            a1.65 1.65 0 0 0 1 1.51
            1.65 1.65 0 0 0 1.82-.33l.06-.06
            a2 2 0 1 1 2.83 2.83l-.06.06
            a1.65 1.65 0 0 0-.33 1.82V9
            a1.65 1.65 0 0 0 1.51 1H21
            a2 2 0 1 1 0 4h-.09
            a1.65 1.65 0 0 0-1.51 1z
    "></path>
            </svg>
            Editor de Feriados
        </button>
        <button class="nav-tab" onclick="trocarPagina('ajuda')">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                <line x1="12" y1="17" x2="12.01" y2="17"></line>
            </svg>
            Ajuda
        </button>
    </div>

    <div class="container">
        <!-- Página de Cálculo -->
        <div id="paginaCalculo" class="page-content active">
        <div class="main-layout">
            <!-- Coluna esquerda: Formulário e Resultado -->
            <div>
                <div class="card">
                    <h3 class="section-title">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Formulário de Cálculo
                    </h3>
                    <div class="section-divider"></div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="dataInicio">Data de Início do Prazo</label>
                    <div class="data-input-wrapper">
                        <input type="date" id="dataInicio">
                        <button class="btn-data-hoje" onclick="setDataHoje()" title="Definir data de hoje">Hoje</button>
                    </div>
                </div>
                <div class="form-group-with-toggle">
                    <label for="diasUteis">Quantidade de Dias</label>
                    <div class="dias-input-wrapper">
                        <div class="dias-input-container">
                            <input type="number" id="diasUteis" min="1" placeholder="Ex: 15">
                        </div>
                        <div class="toggle-container">
                            <div class="toggle-wrapper">
                                <div class="toggle-switch active" id="toggleTipoDias" onclick="toggleTipoDias()">
                                    <div class="toggle-slider"></div>
                                </div>
                                <span class="toggle-label" id="labelTipoDias">Dias Úteis</span>
                            </div>
                        </div>
                    </div>
                    <div class="quick-buttons">
                        <button class="btn btn-quick" onclick="setDias(5)">5 dias</button>
                        <button class="btn btn-quick" onclick="setDias(10)">10 dias</button>
                        <button class="btn btn-quick" onclick="setDias(15)">15 dias</button>
                        <button class="btn btn-quick" onclick="setDias(30)">30 dias</button>
                    </div>
                </div>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="descricaoPrazo">Descrição (Opcional)</label>
                <textarea id="descricaoPrazo" placeholder="Ex: Prazo para recurso administrativo, contestação, etc."></textarea>
            </div>

            <div class="btn-group">
                <button class="btn btn-primary" onclick="calcularPrazo()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Calcular Prazo
                </button>
                <button class="btn btn-secondary" onclick="limparResultado()" id="btnLimpar" style="display:none">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                    Limpar
                </button>
            </div>
            <input type="file" id="importarFeriados" accept=".json" style="display:none" onchange="importarFeriados(event)">

            <div id="resultado" style="display:none"></div>
                </div>
            </div>

            <!-- Coluna direita: Calendário -->
            <div>
                <div class="card calendario">
                    <h3 class="section-title">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Calendário Interativo
                    </h3>
                    <div class="section-divider"></div>

            <div class="calendario-header">
                <div class="calendario-nav-row">
                    <button class="btn-nav" onclick="mudarMes(-1)" id="btnNavAnterior">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <h2 id="mesAtual"></h2>
                    <button class="btn-nav" onclick="mudarMes(1)" id="btnNavProximo">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                    </button>
                </div>
                <div class="calendario-actions-row">
                    <div class="visualizacao-toggle">
                        <button onclick="alternarVisualizacao('mensal')" id="btnMensal" class="active">Mensal</button>
                        <button onclick="alternarVisualizacao('anual')" id="btnAnual">Anual</button>
                    </div>
                    <button class="btn-hoje" onclick="irParaHoje()">
                        📅 Hoje
                    </button>
                </div>
            </div>

            <div class="calendario-grid" id="calendarioGrid"></div>

            <div class="config-feriados">
                <div class="config-feriados-header" onclick="toggleConfigFeriados()">
                    <h3>⚙️ Configurar Feriados</h3>
                    <span class="config-feriados-toggle" id="configToggleIcon">▼</span>
                </div>
                <div class="config-feriados-content" id="configFeriadosContent">
                    <div class="config-feriados-body">
                        <div class="config-secao">
                            <h4>Visualização</h4>
                            <div class="btn-group">
                                <button class="toggle-btn toggle-ativo" id="toggleFixos" onclick="toggleFeriados('fixos')">
                                    ✓ Feriados Nacionais
                                </button>
                                <button class="toggle-btn toggle-ativo" id="toggleMoveis" onclick="toggleFeriados('moveis')">
                                    ✓ Feriados Móveis
                                </button>
                                <button class="toggle-btn toggle-ativo" id="togglePersonalizados" onclick="toggleFeriados('personalizados')">
                                    ✓ Feriados Personalizados
                                </button>
                            </div>
                        </div>

                        <div class="config-divisor"></div>

                        <div class="config-secao">
                            <h4>Gerenciar Feriados Personalizados</h4>
                            <div class="btn-group">
                                <button class="btn btn-success" onclick="exportarFeriados()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="17 8 12 3 7 8"></polyline>
                                        <line x1="12" y1="3" x2="12" y2="15"></line>
                                    </svg>
                                    Exportar
                                </button>
                                <button class="btn btn-purple" onclick="abrirModalSelecionarFonte()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                        <polyline points="7 10 12 15 17 10"></polyline>
                                        <line x1="12" y1="15" x2="12" y2="3"></line>
                                    </svg>
                                    Importar Feriados
                                </button>
                                <button class="btn btn-red" onclick="limparFeriadosPersonalizados()">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"></polyline>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                    </svg>
                                    Limpar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="legenda">
                <h3>Legenda:</h3>
                <div class="legenda-grid">
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #e5e7eb"></div>
                        <span>Fim de semana</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #fecaca"></div>
                        <span>Feriados Fixos/Móveis</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #e9d5ff"></div>
                        <span>Feriados Personalizados</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #3b82f6"></div>
                        <span>Data de início</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #16a34a"></div>
                        <span>Data final</span>
                    </div>
                    <div class="legenda-item">
                        <div class="legenda-cor" style="background: #fef3c7"></div>
                        <span>Dias contados</span>
                    </div>
                </div>
                <p style="margin-top: 15px; font-size: 0.875rem; color: #6b7280;">
                    <strong>Dica:</strong> Clique em qualquer dia útil para marcá-lo como feriado personalizado.
                </p>
            </div>
                </div>
            </div>
        </div>

        </div>
        <!-- Fim Página de Cálculo -->

        <!-- Página de Gerenciamento de Feriados -->
        <div id="paginaGerenciamento" class="page-content">
            <div class="batch-editor">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Gerenciamento Avançado de Feriados
                </h3>
                <p style="color: #6b7280; margin-bottom: 20px;">
                    Configure os feriados fixos e móveis da calculadora. Estas configurações são diferentes dos feriados personalizados que você adiciona clicando no calendário.
                </p>

                <!-- Seção 1: Feriados Fixos e Móveis -->
                <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px; margin-bottom: 30px;">
                    <h4 style="color: #dc2626; margin-bottom: 15px; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        Feriados Fixos e Móveis
                    </h4>

                    <div class="info-box">
                        <p><strong>ℹ️ Formatos aceitos:</strong></p>
                        <ul style="margin-top: 8px; margin-left: 20px; line-height: 1.8;">
                            <li><strong>Feriados Fixos:</strong> <code>DD-MM Nome</code> (sem ano) - Ex: <code>25-12 Natal</code></li>
                            <li><strong>Feriados Móveis:</strong> <code>DD-MM-YYYY Nome</code> (com ano) - Ex: <code>04-03-2025 Carnaval</code></li>
                        </ul>
                    </div>

                    <h5 style="color: #1f2937; margin-top: 20px; margin-bottom: 10px; font-size: 1rem;">Feriados Fixos</h5>
                    <p style="color: #6b7280; font-size: 0.85rem; margin-bottom: 10px;">Feriados que ocorrem na mesma data todos os anos. <strong>Formato: DD-MM Nome</strong> (sem especificar o ano):</p>
                    <textarea id="editorFeriadosFixos" placeholder="01-01 Ano Novo&#10;25-12 Natal"></textarea>

                    <h5 style="color: #1f2937; margin-top: 20px; margin-bottom: 10px; font-size: 1rem;">Feriados Móveis</h5>
                    <p style="color: #6b7280; font-size: 0.85rem; margin-bottom: 10px;">Feriados que variam de data a cada ano. <strong>Formato: DD-MM-YYYY Nome</strong> (com o ano completo):</p>
                    <textarea id="editorFeriadosMoveis" placeholder="04-03-2025 Carnaval&#10;18-04-2025 Sexta-feira Santa"></textarea>

                    <div class="warning-box" style="margin-top: 15px;">
                        <p><strong>⚠️ Atenção:</strong> Ao salvar, as configurações atuais de fixos/móveis serão substituídas pelas novas. Esta ação não afeta os feriados personalizados.</p>
                    </div>

                    <div class="btn-group" style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="salvarFeriadosBatch()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Salvar Fixos e Móveis
                        </button>
                        <button class="btn btn-secondary" onclick="resetarFeriadosPadrao()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"></polyline>
                                <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
                            </svg>
                            Resetar Fixos/Móveis
                        </button>
                    </div>
                </div>

                <!-- Divisor visual -->
                <div style="border-top: 3px solid #d1d5db; margin: 30px 0;"></div>

                <!-- Seção 2: Feriados Personalizados -->
                <div style="background: #f9fafb; border: 2px solid #e5e7eb; border-radius: 12px; padding: 20px;">
                    <h4 style="color: #9333ea; margin-bottom: 15px; font-size: 1.1rem; display: flex; align-items: center; gap: 8px;">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Feriados Personalizados
                    </h4>

                    <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 15px;">
                        Gerencie feriados específicos adicionados por você (via calendário ou importação JSON). <strong>Formato: DD-MM-YYYY Nome</strong> (nome opcional)
                    </p>

                    <textarea id="editorFeriadosPersonalizados" placeholder="25-12-2025 Natal&#10;01-01-2026 Ano Novo&#10;15-06-2026"></textarea>

                    <div class="btn-group" style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="salvarFeriadosPersonalizadosEditor()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                            Salvar Personalizados
                        </button>
                        <button class="btn btn-red" onclick="limparFeriadosPersonalizados()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                            Limpar Personalizados
                        </button>
                    </div>

                    <div class="btn-group" style="margin-top: 10px;">
                        <button class="btn btn-purple" onclick="abrirModalSelecionarFonte()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="7 10 12 15 17 10"></polyline>
                                <line x1="12" y1="15" x2="12" y2="3"></line>
                            </svg>
                            Importar Feriados
                        </button>
                        <button class="btn btn-secondary" onclick="exportarFeriados()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            Exportar JSON
                        </button>
                    </div>
                </div>
            </div>

            <div class="batch-editor">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                    Visualização de Feriados Configurados
                </h3>

                <h4 style="color: #dc2626; margin-top: 20px; margin-bottom: 10px;">Feriados Fixos Ativos</h4>
                <div id="listaFeriadosFixos" class="feriados-list"></div>

                <h4 style="color: #dc2626; margin-top: 20px; margin-bottom: 10px;">Feriados Móveis Ativos</h4>
                <div id="listaFeriadosMoveis" class="feriados-list"></div>

                <h4 style="color: #9333ea; margin-top: 20px; margin-bottom: 10px;">Feriados Personalizados Ativos</h4>
                <div id="listaFeriadosPersonalizados" class="feriados-list"></div>
            </div>
        </div>
        <!-- Fim Página de Gerenciamento -->

        <!-- Página de Ajuda -->
        <div id="paginaAjuda" class="page-content">
            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <!-- brilho principal -->
    <path d="M12 3l1.5 3.5L17 8l-3.5 1.5L12 13l-1.5-3.5L7 8l3.5-1.5L12 3z" />

    <!-- brilhos secundários -->
    <path d="M5 14l1 2 2 1-2 1-1 2-1-2-2-1 2-1 1-2z" />
    <path d="M17 14l.8 1.6 1.6.8-1.6.8-.8 1.6-.8-1.6-1.6-.8 1.6-.8.8-1.6z" />
                    </svg>
                    Bem-vindo ao ContaPrazo
                </h3>
                <p>
                    O <strong>ContaPrazo</strong> é uma calculadora de prazos que auxilia no cálculo de datas finais, considerando prazos em dias úteis ou corridos, bem como feriados nacionais, móveis e personalizados.
                </p>
				<p>
				A ferramenta nasceu da experiência cotidiana com a gestão de múltiplos prazos, em contextos nos quais diferentes regras de contagem convivem e exigem atenção constante. A necessidade de organizar datas, evitar inconsistências e tornar os fluxos mais previsíveis motivou o desenvolvimento de uma solução simples, capaz de centralizar a contagem de prazos e apoiar a administração de compromissos que dependem de precisão e confiabilidade.
				</p>

				<p>
				Espero que seja útil!
				</p>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Como Usar a Calculadora
                </h3>
                <ul>
                    <li><strong>Data de Início:</strong> Selecione a data inicial do prazo.</li>
                    <li><strong>Quantidade de Dias:</strong> Informe quantos dias você deseja contar. Use os botões rápidos (5, 10, 15, 30 dias) para agilizar.</li>
                    <li><strong>Tipo de Dias:</strong> Use o botão de alternância para escolher entre <strong>Dias Úteis</strong> (exclui fins de semana e feriados) ou <strong>Dias Corridos</strong> (conta todos os dias).</li>
                    <li><strong>Descrição:</strong> Adicione uma descrição opcional para identificar o cálculo (ex: "Prazo para recurso administrativo").</li>
                    <li><strong>Calcular:</strong> Clique no botão "Calcular Prazo" para ver o resultado.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                    </svg>
                    Entendendo os Resultados
                </h3>
                <ul>
                    <li><strong>Data de Início:</strong> A data inicial informada, exibida por extenso.</li>
                    <li><strong>Dias Contados:</strong> Quantidade de dias úteis ou corridos que foram contados.</li>
                    <li><strong>Data Final do Prazo:</strong> A data final calculada, destacada em verde.</li>
                    <li><strong>Detalhamento:</strong> Lista completa de todos os dias percorridos, mostrando quais foram contados (em verde) e quais foram pulados (em vermelho) com o motivo.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                        <circle cx="8.5" cy="8.5" r="1.5"></circle>
                        <polyline points="21 15 16 10 5 21"></polyline>
                    </svg>
                    Exportando Resultados
                </h3>
                <p>Você pode exportar os resultados em diferentes formatos:</p>
                <ul>
                    <li><strong>Exportar PDF:</strong> Gera um documento HTML que pode ser impresso ou salvo como PDF (use Ctrl+P ou Cmd+P). Você pode escolher entre a versão resumida (com visualização gráfica dos dias) ou completa (com detalhamento dia a dia).</li>
                    <li><strong>Exportar PNG:</strong> Salva uma imagem do cálculo. Você pode escolher entre a versão resumida (com visualização gráfica dos dias) ou completa (com detalhamento dia a dia).</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                    Usando o Calendário
                </h3>
                <ul>
                    <li><strong>Visualização:</strong> Alterne entre visualização <strong>Mensal</strong> e <strong>Anual</strong> usando os botões correspondentes.</li>
                    <li><strong>Navegação:</strong> Use as setas para navegar entre meses ou anos. O botão <strong>"Hoje"</strong> retorna para o mês/ano atual.</li>
                    <li><strong>Feriados Personalizados:</strong> Clique em qualquer dia útil no calendário para marcá-lo ou desmarcá-lo como feriado personalizado. Você pode adicionar nomes descritivos aos feriados na aba "Editor de Feriados".</li>
                    <li><strong>Legenda:</strong> Consulte a legenda abaixo do calendário para entender as cores de cada tipo de dia.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06
            a2 2 0 1 1-2.83 2.83l-.06-.06
            a1.65 1.65 0 0 0-1.82-.33
            1.65 1.65 0 0 0-1 1.51V21
            a2 2 0 1 1-4 0v-.09
            a1.65 1.65 0 0 0-1-1.51
            1.65 1.65 0 0 0-1.82.33l-.06.06
            a2 2 0 1 1-2.83-2.83l.06-.06
            a1.65 1.65 0 0 0 .33-1.82
            1.65 1.65 0 0 0-1.51-1H3
            a2 2 0 1 1 0-4h.09
            a1.65 1.65 0 0 0 1.51-1
            1.65 1.65 0 0 0-.33-1.82l-.06-.06
            a2 2 0 1 1 2.83-2.83l.06.06
            a1.65 1.65 0 0 0 1.82.33H9
            a1.65 1.65 0 0 0 1-1.51V3
            a2 2 0 1 1 4 0v.09
            a1.65 1.65 0 0 0 1 1.51
            1.65 1.65 0 0 0 1.82-.33l.06-.06
            a2 2 0 1 1 2.83 2.83l-.06.06
            a1.65 1.65 0 0 0-.33 1.82V9
            a1.65 1.65 0 0 0 1.51 1H21
            a2 2 0 1 1 0 4h-.09
            a1.65 1.65 0 0 0-1.51 1z
    "></path>
                    </svg>
                    Configurando Feriados
                </h3>
                <p>Existem três tipos de feriados na calculadora:</p>
                <ul>
                    <li><strong>Feriados Nacionais:</strong> Feriados fixos do Brasil (Ano Novo, Tiradentes, Natal, etc.). Podem ser ativados/desativados na seção "Configurar Feriados".</li>
                    <li><strong>Feriados Móveis:</strong> Feriados que mudam de data a cada ano (Carnaval, Páscoa, Corpus Christi). Também podem ser ativados/desativados.</li>
                    <li><strong>Feriados Personalizados:</strong> Datas específicas que você marca clicando no calendário (ex: feriados municipais, ponto facultativo local).</li>
                </ul>
                <h4 style="margin-top: 24px; font-size: 1rem; color: #1f2937; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Exportar/Importar Feriados Personalizados
                </h4>
                <p style="margin-top: 12px;">
                    Você pode salvar seus feriados personalizados em um arquivo JSON e compartilhá-lo com colegas, equipes ou setores que precisem das mesmas exceções de calendário. Isso é especialmente útil para:
                </p>
                <ul style="margin-top: 8px;">
                    <li>Equipes jurídicas que seguem o mesmo calendário forense</li>
                    <li>Departamentos que compartilham feriados municipais ou estaduais</li>
                    <li>Grupos de trabalho com pontos facultativos específicos</li>
                    <li>Backup e restauração de suas configurações personalizadas</li>
                </ul>
                <p style="margin-top: 12px; padding: 12px; background: #eff6ff; border-left: 4px solid #3b82f6; border-radius: 4px; font-size: 0.9rem;">
                    <strong>Como funciona:</strong> Exporte seus feriados clicando em "Exportar JSON" na aba de Feriados. Compartilhe o arquivo com outras pessoas (e-mail, chat, drive). Ao importar, escolha <strong>"Substituir"</strong> para sobrescrever os atuais ou <strong>"Mesclar"</strong> para adicionar aos existentes.
                </p>

                <h4 style="margin-top: 20px; font-size: 0.95rem; color: #4b5563; font-weight: 600;">
                    📋 Formato do arquivo exportado
                </h4>
                <p style="margin-top: 8px; font-size: 0.875rem;">
                    O arquivo JSON segue esta estrutura:
                </p>
                <pre style="background: #f3f4f6; padding: 15px; border-radius: 8px; border-left: 4px solid #3b82f6; overflow-x: auto; font-size: 0.875rem; line-height: 1.5; margin-top: 8px;"><code>{
  "feriadosPersonalizados": [
    "25-12-2025 Natal",
    "24-12-2025 Véspera de Natal",
    "01-01-2026 Ano Novo",
    "15-06-2026"
  ],
  "dataExportacao": "2025-12-16T12:35:09.540Z"
}</code></pre>
                <p style="margin-top: 8px; font-size: 0.875rem; color: #6b7280;">
                    <strong>Nota:</strong> As datas dos feriados personalizados devem estar no formato <code>DD-MM-YYYY Nome</code> (dia-mês-ano seguido do nome). O nome é opcional - se omitido, o feriado será exibido como "Feriado/Ponto Facultativo" no cálculo. O campo "dataExportacao" é gerado automaticamente.
                </p>

                <h4 style="margin-top: 24px; font-size: 1rem; color: #1f2937; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    ☁️ Conjuntos Pré-definidos Online (NOVO!)
                </h4>
                <p style="margin-top: 12px;">
                    Agora você pode importar conjuntos de feriados pré-configurados diretamente online, sem precisar baixar ou compartilhar arquivos! Ao clicar em <strong>"Importar Feriados"</strong>, escolha a opção <strong>"Conjuntos Pré-definidos Online"</strong> para acessar:
                </p>
                <ul style="margin-top: 8px;">
                    <li><strong>TJBA - Tribunal de Justiça da Bahia:</strong> Calendário forense oficial com feriados e pontos facultativos</li>
                    <li><strong>Prefeituras Municipais:</strong> Feriados municipais e pontos facultativos de cidades específicas</li>
                    <li><strong>Outros conjuntos:</strong> Calendários atualizados para diversos órgãos e jurisdições</li>
                </ul>
                <p style="margin-top: 12px; padding: 12px; background: #ecfdf5; border-left: 4px solid #10b981; border-radius: 4px; font-size: 0.9rem;">
                    <strong>💡 Vantagem:</strong> Os conjuntos online são atualizados automaticamente conforme novos decretos e portarias são publicados. Você sempre terá acesso à versão mais recente sem precisar baixar novos arquivos!
                </p>
                <p style="margin-top: 12px; font-size: 0.875rem;">
                    <strong>Como usar:</strong>
                </p>
                <ol style="margin-top: 8px; font-size: 0.875rem;">
                    <li>Clique em <strong>"Importar Feriados"</strong> (disponível na Aba 1 ou 2)</li>
                    <li>Escolha <strong>"☁️ Conjuntos Pré-definidos Online"</strong></li>
                    <li>Selecione o conjunto desejado da lista (ex: TJBA, PMVC, etc.)</li>
                    <li>Escolha se deseja <strong>Substituir</strong> (apagar atuais) ou <strong>Mesclar</strong> (adicionar aos existentes)</li>
                    <li>Pronto! Os feriados serão importados automaticamente</li>
                </ol>
                <p style="margin-top: 12px; padding: 12px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 4px; font-size: 0.875rem;">
                    <strong>⚠️ Observação:</strong> Se você também tiver feriados personalizados específicos (ex: aniversário do setor), recomendamos escolher <strong>"Mesclar"</strong> para manter seus feriados e adicionar os do conjunto online.
                </p>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"></path>
                        <line x1="4" y1="22" x2="4" y2="15"></line>
                    </svg>
                    Gerenciamento Avançado de Feriados
                </h3>
                <p>
                    Na aba <strong>"Editor de Feriados"</strong>, você pode editar feriados em modo batch (lote):
                </p>
                <ul>
                    <li><strong>Feriados Fixos:</strong> Edite os feriados que ocorrem na mesma data todos os anos (formato: <code>DD-MM Nome</code>).</li>
                    <li><strong>Feriados Móveis:</strong> Edite os feriados que mudam de ano para ano (formato: <code>DD-MM-YYYY Nome</code>).</li>
                    <li><strong>Feriados Personalizados:</strong> Gerencie os feriados adicionados clicando no calendário ou importados de JSON (formato: <code>DD-MM-YYYY Nome</code>, nome é opcional). Você pode adicionar, editar ou remover feriados específicos diretamente no editor de texto, incluindo nomes descritivos para melhor identificação.</li>
                </ul>
                <p style="margin-top: 12px;">
                    <strong>Ações disponíveis:</strong>
                </p>
                <ul>
                    <li><strong>Salvar:</strong> Substitui as configurações atuais pelas novas.</li>
                    <li><strong>Resetar:</strong> Restaura os feriados fixos/móveis padrão do Brasil.</li>
                    <li><strong>Importar/Exportar JSON:</strong> Permite importar ou exportar feriados personalizados em formato JSON.</li>
                    <li><strong>Limpar Todos:</strong> Remove todos os feriados personalizados.</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Compartilhando a Calculadora
                </h3>
                <p>
                    No rodapé da página de cálculo, você encontrará a opção <strong>"Baixar esta calculadora para compartilhar"</strong>. Isso permite que você:
                </p>
                <ul>
                    <li>Baixe o arquivo HTML completo da calculadora</li>
                    <li>Compartilhe com colegas, clientes ou qualquer pessoa</li>
                    <li>Use a calculadora offline, sem necessidade de internet</li>
                    <li>Mantenha uma cópia local para uso futuro</li>
                </ul>
            </div>

            <div class="help-section">
                <h3>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="8" x2="12" y2="8"></line>
                        <line x1="12" y1="12" x2="12" y2="16"></line>
                    </svg>
                    Dicas e Boas Práticas
                </h3>
                <ul>
                    <li>Sempre verifique se o tipo de dias (úteis ou corridos) está correto antes de calcular.</li>
                    <li>Use a descrição para documentar o motivo do cálculo - isso ajuda ao exportar ou revisar depois.</li>
                    <li>Confira a legenda do calendário para entender como cada dia está sendo categorizado.</li>
                    <li>Exporte seus feriados personalizados periodicamente para não perdê-los (são salvos localmente no navegador).</li>
                    <li>Use o detalhamento para conferir se algum dia foi contado ou não contado corretamente.</li>
                    <li>O botão "Limpar" remove o resultado atual e permite fazer um novo cálculo rapidamente.</li>
                </ul>

                <div style="margin-top: 40px; padding-top: 30px; border-top: 1px solid #e5e7eb; text-align: center;">
                    <p style="color: #6b7280; font-size: 0.875rem; margin-bottom: 15px;">
                        Precisa restaurar a calculadora para as configurações originais?
                    </p>
                    <button class="btn btn-secondary" onclick="confirmarResetCompleto()" style="font-size: 0.875rem; padding: 8px 16px;">
                        🔄 Restaurar Configurações Padrão
                    </button>
                </div>
            </div>
        </div>
        <!-- Fim Página de Ajuda -->

        <!-- Rodapé Persistente -->
        <div class="rodape">
            <p>
                <a href="#" onclick="baixarCalculadora(); return false;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle; margin-right: 5px;">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Baixar esta calculadora para compartilhar
                </a>
            </p>
            <p style="margin-top: 10px; color: #9ca3af; font-size: 0.75rem; font-style: italic;">
                ContaPrazo Calculadora v1.1 • 2025 • Um projeto de Italoan F. • <a href="mailto:prazocerto@outlook.com" style="color: #9ca3af; font-size: 0.75rem; font-style: italic; text-decoration: underline;">Entre em Contato</a>
            </p>
        </div>
    </div>

    <!-- Botão scroll to top -->
    <button class="scroll-to-top" id="scrollToTopBtn" onclick="scrollToTop()" aria-label="Voltar ao topo">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="18 15 12 9 6 15"></polyline>
        </svg>
    </button>

    <!-- Modal para selecionar fonte de importação -->
    <div class="modal" id="modalSelecionarFonte">
        <div class="modal-content">
            <div class="modal-header">Importar Feriados</div>
            <div class="modal-body">
                Escolha a origem dos feriados:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="abrirDropdownPredefinidos()">
                    <div class="modal-option-title">☁️ Conjuntos Pré-definidos Online</div>
                    <div class="modal-option-desc">Baixe automaticamente conjuntos de feriados mantidos e atualizados online.</div>
                </div>
                <div class="modal-option" onclick="escolherArquivoLocal()">
                    <div class="modal-option-title">📁 Arquivo Local</div>
                    <div class="modal-option-desc">Importe um arquivo JSON personalizado do seu computador.</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalSelecionarFonte()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para escolher conjunto pré-definido -->
    <div class="modal" id="modalPredefinidos">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">Conjuntos Pré-definidos Online</div>
            <div class="modal-body">
                <div id="listaPredefinidos" style="max-height: 400px; overflow-y: auto;">
                    <div style="text-align: center; padding: 20px; color: #6b7280;">
                        Carregando conjuntos disponíveis...
                    </div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalPredefinidos()">Voltar</button>
            </div>
        </div>
    </div>

    <!-- Modal para importar feriados -->
    <div class="modal" id="modalImportar">
        <div class="modal-content">
            <div class="modal-header">Importar Feriados</div>
            <div class="modal-body">
                Escolha como deseja importar os feriados:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="finalizarImportacao('substituir')">
                    <div class="modal-option-title">🔄 Substituir</div>
                    <div class="modal-option-desc">Remove todos os feriados personalizados atuais e substitui pelos do arquivo.</div>
                </div>
                <div class="modal-option" onclick="finalizarImportacao('mesclar')">
                    <div class="modal-option-title">➕ Mesclar</div>
                    <div class="modal-option-desc">Mantém os feriados atuais e adiciona os novos do arquivo (sem duplicatas).</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para escolher tipo de export PDF -->
    <div class="modal" id="modalExportPDF">
        <div class="modal-content">
            <div class="modal-header">Exportar PDF</div>
            <div class="modal-body">
                Escolha o tipo de export PDF:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="finalizarExportPDF('resumido')">
                    <div class="modal-option-title">📄 Resumido</div>
                    <div class="modal-option-desc">Export compacto com visualização gráfica dos dias considerados (similar ao PNG resumido).</div>
                </div>
                <div class="modal-option" onclick="finalizarExportPDF('completo')">
                    <div class="modal-option-title">📋 Completo</div>
                    <div class="modal-option-desc">Export detalhado com lista completa de todos os dias do período.</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalExportPDF()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Modal para escolher tipo de export PNG -->
    <div class="modal" id="modalExportPNG">
        <div class="modal-content">
            <div class="modal-header">Exportar PNG</div>
            <div class="modal-body">
                Escolha o tipo de export PNG:
            </div>
            <div class="modal-options">
                <div class="modal-option" onclick="finalizarExportPNG('resumido')">
                    <div class="modal-option-title">🖼️ Resumido</div>
                    <div class="modal-option-desc">Salva uma imagem com as informações principais e visualização gráfica dos dias considerados.</div>
                </div>
                <div class="modal-option" onclick="finalizarExportPNG('completo')">
                    <div class="modal-option-title">📸 Completo</div>
                    <div class="modal-option-desc">Salva uma imagem completa incluindo o detalhamento dia a dia do período.</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="fecharModalExportPNG()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // Estado da aplicação
        let mesAtual = new Date();

        // Carregar feriados personalizados do localStorage com retrocompatibilidade
        let feriadosPersonalizados = new Map();
        const feriadosPersonalizadosStorage = JSON.parse(localStorage.getItem('feriadosPersonalizados') || '[]');

        // Retrocompatibilidade: se for array de strings (formato antigo), converte para Map
        if (Array.isArray(feriadosPersonalizadosStorage)) {
            feriadosPersonalizadosStorage.forEach(item => {
                if (typeof item === 'string') {
                    // Formato antigo: apenas data
                    feriadosPersonalizados.set(item, '');
                } else if (item && typeof item === 'object') {
                    // Formato novo: objeto {data, nome}
                    feriadosPersonalizados.set(item.data, item.nome || '');
                }
            });
        }

        let feriadosFixosAtivos = true;
        let feriadosMoveisAtivos = true;
        let feriadosPersonalizadosAtivos = true;
        let dataInicio = null;
        let diasUteis = null;
        let todosOsDias = [];
        let dataFinal = null;
        let visualizacaoCalendario = 'mensal'; // 'mensal' ou 'anual'
        let usarDiasUteis = true; // true = dias úteis, false = dias corridos
        let descricaoPrazo = '';
        let configImportacaoPendente = null;
        let calculoRealizado = false; // Controla se já foi feito um cálculo

        // ========================================
        // CONSTANTES
        // ========================================
        const TEMPOS = {
            PRINT: 500,
            DEBOUNCE_AVISO: 300,
            SCROLL_SUAVE: 100
        };

        const DIMENSOES = {
            BTN_NAV: 32,
            LOGO: 56,
            LOGO_MOBILE: 44,
            LOGO_SMALL: 38,
            EXPORT_WIDTH: 900
        };

        const ESCALAS = {
            HTML2CANVAS: 2,
            CALENDARIO_MOBILE: 0.95,
            CALENDARIO_SMALL: 0.88
        };

        // ========================================
        // FUNÇÕES HELPER
        // ========================================

        // Conversão de formatos de data
        function converterParaFormatoBrasileiro(dataISO) {
            // YYYY-MM-DD → DD-MM-YYYY
            const [ano, mes, dia] = dataISO.split('-');
            return `${dia}-${mes}-${ano}`;
        }

        function converterParaFormatoISO(dataBR) {
            // DD-MM-YYYY → YYYY-MM-DD
            const [dia, mes, ano] = dataBR.split('-');
            return `${ano}-${mes}-${dia}`;
        }

        function converterParaFormatoMesDia(dataBR) {
            // DD-MM → MM-DD (para feriados fixos - formato interno)
            const [dia, mes] = dataBR.split('-');
            return `${mes}-${dia}`;
        }

        function converterMesDiaParaBrasileiro(mesdia) {
            // MM-DD → DD-MM (de formato interno para exibição)
            const [mes, dia] = mesdia.split('-');
            return `${dia}-${mes}`;
        }

        // Obtém nome de feriado de todas as fontes possíveis
        function obterNomeFeriado(data) {
            const dataStr = formatarData(data);
            const dataCompleta = formatarDataCompleta(data);
            const ano = data.getFullYear();

            return feriadosFixos[dataStr] ||
                (feriadosMoveis[ano] && feriadosMoveis[ano][dataStr]) ||
                (feriadosPersonalizados.has(dataCompleta) && feriadosPersonalizados.get(dataCompleta)) ||
                null;
        }

        // Cache de seletores DOM
        let cacheDom = null;
        function inicializarCacheDom() {
            const navTabElements = document.querySelectorAll('.nav-tab');
            cacheDom = {
                navTabs: {
                    calculo: navTabElements[0],
                    gerenciamento: navTabElements[1],
                    ajuda: navTabElements[2]
                },
                paginas: {
                    calculo: document.getElementById('paginaCalculo'),
                    gerenciamento: document.getElementById('paginaGerenciamento'),
                    ajuda: document.getElementById('paginaAjuda')
                }
            };
        }

        // Controle de avisos (com debounce)
        let avisoRecalculoTimeout = null;
        function mostrarAvisoRecalculo() {
            // Verifica se o usuário optou por não mostrar o aviso
            const naoMostrar = localStorage.getItem('naoMostrarAvisoRecalculo') === 'true';
            if (naoMostrar || !calculoRealizado) return;

            // Debounce: aguarda 300ms antes de mostrar para evitar múltiplos avisos
            clearTimeout(avisoRecalculoTimeout);
            avisoRecalculoTimeout = setTimeout(() => {
                const modal = document.getElementById('modalAvisoRecalculo');
                modal.classList.add('active');
            }, TEMPOS.DEBOUNCE_AVISO);
        }

        function fecharAvisoRecalculo() {
            const modal = document.getElementById('modalAvisoRecalculo');
            const checkbox = document.getElementById('naoMostrarAvisoNovamente');

            // Se o checkbox estiver marcado, salva a preferência
            if (checkbox.checked) {
                localStorage.setItem('naoMostrarAvisoRecalculo', 'true');
            }

            modal.classList.remove('active');
            // Desmarca o checkbox para a próxima vez
            checkbox.checked = false;
        }

        // Controle de reset completo
        function confirmarResetCompleto() {
            const modal = document.getElementById('modalResetCompleto');
            modal.classList.add('active');
        }

        function fecharModalReset() {
            const modal = document.getElementById('modalResetCompleto');
            modal.classList.remove('active');
        }

        function executarResetCompleto() {
            // Limpa feriados personalizados
            feriadosPersonalizados.clear();
            localStorage.removeItem('feriadosPersonalizados');

            // Remove feriados fixos e móveis customizados (volta ao padrão do código)
            localStorage.removeItem('feriadosFixos');
            localStorage.removeItem('feriadosMoveis');

            // Remove preferência de não mostrar aviso
            localStorage.removeItem('naoMostrarAvisoRecalculo');

            // Fecha o modal
            fecharModalReset();

            // Mostra mensagem de sucesso
            alert('✅ Configurações restauradas com sucesso!\n\nA página será recarregada para aplicar as mudanças.');

            // Marca flag para voltar à primeira aba após reload
            sessionStorage.setItem('reloadToTop', 'true');

            // Recarrega a página para aplicar as configurações padrão
            location.reload();
        }

        // Feriados fixos
        const feriadosFixos = {
            '01-01': 'Ano Novo',
            '04-21': 'Tiradentes',
            '05-01': 'Dia do Trabalho',
            '09-07': 'Independência',
            '10-12': 'Nossa Senhora Aparecida',
            '11-02': 'Finados',
            '11-15': 'Proclamação da República',
            '11-20': 'Consciência Negra',
            '12-25': 'Natal'
        };

        // Feriados móveis
        const feriadosMoveis = {
            2025: {
                '03-03': 'Carnaval (seg)',
                '03-04': 'Carnaval (ter)',
                '04-18': 'Sexta-feira Santa',
                '06-19': 'Corpus Christi'
            },
            2026: {
                '02-16': 'Carnaval (seg)',
                '02-17': 'Carnaval (ter)',
                '04-03': 'Sexta-feira Santa',
                '06-04': 'Corpus Christi'
            }
        };

        function toggleTipoDias() {
            usarDiasUteis = !usarDiasUteis;
            const toggle = document.getElementById('toggleTipoDias');
            const label = document.getElementById('labelTipoDias');

            if (usarDiasUteis) {
                toggle.classList.add('active');
                label.textContent = 'Dias Úteis';
            } else {
                toggle.classList.remove('active');
                label.textContent = 'Dias Corridos';
            }

            // Mostra aviso se já houver cálculo realizado
            mostrarAvisoRecalculo();
        }

        function formatarData(data) {
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const dia = String(data.getDate()).padStart(2, '0');
            return `${mes}-${dia}`;
        }

        function formatarDataCompleta(data) {
            const ano = data.getFullYear();
            const mes = String(data.getMonth() + 1).padStart(2, '0');
            const dia = String(data.getDate()).padStart(2, '0');
            return `${ano}-${mes}-${dia}`;
        }

        function ehFimDeSemana(data) {
            const dia = data.getDay();
            return dia === 0 || dia === 6;
        }

        function ehFeriado(data) {
            const dataStr = formatarData(data);
            const dataCompleta = formatarDataCompleta(data);
            const ano = data.getFullYear();

            if (feriadosFixosAtivos && feriadosFixos[dataStr]) return true;
            if (feriadosMoveisAtivos && feriadosMoveis[ano] && feriadosMoveis[ano][dataStr]) return true;
            if (feriadosPersonalizadosAtivos && feriadosPersonalizados.has(dataCompleta)) return true;

            return false;
        }

        function getTipoFeriado(data) {
            const dataStr = formatarData(data);
            const dataCompleta = formatarDataCompleta(data);
            const ano = data.getFullYear();

            if (feriadosFixosAtivos && feriadosFixos[dataStr]) return 'fixo';
            if (feriadosMoveisAtivos && feriadosMoveis[ano] && feriadosMoveis[ano][dataStr]) return 'movel';
            if (feriadosPersonalizadosAtivos && feriadosPersonalizados.has(dataCompleta)) return 'personalizado';

            return null;
        }

        function obterClassesDia(data, baseClass, diasPercorridos, primeiroDiaPercorrido, ultimoDiaPercorrido) {
            const dataStr = formatarDataCompleta(data);
            const ehFds = ehFimDeSemana(data);
            const tipoFeriado = getTipoFeriado(data);
            const ehInicio = dataInicio === dataStr;
            const ehFim = dataFinal && formatarDataCompleta(dataFinal) === dataStr;
            const ehPercorrido = todosOsDias.some(d => d.contado && formatarDataCompleta(d.data) === dataStr);

            let className = baseClass;

            // Adiciona classes de cor - permitindo combinação de fim de semana com feriado
            if (ehFds && tipoFeriado) {
                // Fim de semana + feriado: mantém fundo cinza, mas texto vermelho
                className += ' fim-semana feriado-em-fds';
            } else if (ehFds) {
                className += ' fim-semana';
            } else if (tipoFeriado === 'personalizado') {
                className += ' feriado-personalizado';
            } else if (tipoFeriado) {
                className += ' feriado';
            } else if (ehInicio) {
                className += ' dia-inicio';
            } else if (ehFim) {
                className += ' dia-final';
            } else if (ehPercorrido) {
                className += ' dia-percorrido';
            }

            return { className, ehFds };
        }

        function setDias(dias) {
            document.getElementById('diasUteis').value = dias;
            mostrarAvisoRecalculo();
        }

        function setDataHoje() {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const dia = String(hoje.getDate()).padStart(2, '0');
            document.getElementById('dataInicio').value = `${ano}-${mes}-${dia}`;
            mostrarAvisoRecalculo();
        }

        function calcularPrazo() {
            dataInicio = document.getElementById('dataInicio').value;
            diasUteis = document.getElementById('diasUteis').value;
            descricaoPrazo = document.getElementById('descricaoPrazo').value.trim();

            if (!dataInicio || !diasUteis) {
                alert('Por favor, preencha a data de início e a quantidade de dias.');
                return;
            }

            const inicio = new Date(dataInicio + 'T00:00:00');
            let diasContados = 0;
            let dataAtual = new Date(inicio);
            todosOsDias = [];
            let contador = 0;

            while (diasContados < parseInt(diasUteis)) {
                dataAtual.setDate(dataAtual.getDate() + 1);

                const ehFds = ehFimDeSemana(dataAtual);
                const ehFer = ehFeriado(dataAtual);

                let motivo = '';
                let contado = false;

                if (usarDiasUteis) {
                    // Modo dias úteis: só conta se não for fim de semana nem feriado
                    if (!ehFds && !ehFer) {
                        diasContados++;
                        contador++;
                        contado = true;
                        motivo = `Dia ${contador}`;
                    } else {
                        // Verifica ambas as condições independentemente
                        const nomeFeriado = obterNomeFeriado(dataAtual);

                        if (ehFds && ehFer) {
                            motivo = `Final de Semana e ${nomeFeriado || 'Feriado'}`;
                        } else if (ehFds) {
                            motivo = 'Final de Semana';
                        } else if (ehFer) {
                            motivo = nomeFeriado || 'Feriado/Ponto Facultativo';
                        }
                    }
                } else {
                    // Modo dias corridos: conta todos os dias
                    diasContados++;
                    contador++;
                    contado = true;

                    // Verifica ambas as condições independentemente
                    const nomeFeriado = obterNomeFeriado(dataAtual);

                    if (ehFds && ehFer) {
                        motivo = `Dia ${contador} - Final de Semana e ${nomeFeriado || 'Feriado'}`;
                    } else if (ehFds) {
                        motivo = `Dia ${contador} - Final de Semana`;
                    } else if (ehFer) {
                        motivo = `Dia ${contador} - ${nomeFeriado || 'Feriado'}`;
                    } else {
                        motivo = `Dia ${contador}`;
                    }
                }

                todosOsDias.push({
                    data: new Date(dataAtual),
                    contado: contado,
                    motivo: motivo,
                    numero: contado ? contador : null
                });
            }

            dataFinal = dataAtual;
            calculoRealizado = true; // Marca que o cálculo foi realizado
            mostrarResultado();
            renderizarCalendario();
            document.getElementById('btnLimpar').style.display = 'inline-flex';

            // Scroll suave até os resultados
            setTimeout(() => {
                const resultadoElement = document.getElementById('resultado');
                if (resultadoElement) {
                    resultadoElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }

        function mostrarResultado() {
            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div class="resultado-descricao">
                        <strong>Descrição:</strong> ${descricaoPrazo}
                    </div>
                `;
            }

            let html = `
                <div class="resultado">
                    <h2>
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                        Resultado do Cálculo
                    </h2>
                    ${descricaoHTML}
                    <div class="resultado-info">
                        <strong>Data de Início:</strong> ${dataInicioFormatada}
                    </div>
                    <div class="resultado-info">
                        <strong>Dias ${tipoDias} Contados:</strong> ${diasUteis}
                    </div>
                    <div class="resultado-info">
                        <strong>Data Final do Prazo:</strong> <span class="data-final">${dataFinalFormatada}</span>
                    </div>

                    <div class="btn-group" style="margin-top: 20px;">
                        <button class="btn btn-red" onclick="abrirModalExportPDF()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                <polyline points="14 2 14 8 20 8"></polyline>
                            </svg>
                            Exportar PDF
                        </button>
                        <button class="btn btn-indigo" onclick="abrirModalExportPNG()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                <circle cx="8.5" cy="8.5" r="1.5"></circle>
                                <polyline points="21 15 16 10 5 21"></polyline>
                            </svg>
                            Exportar PNG
                        </button>
                    </div>

                    <div class="detalhamento">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline; vertical-align: middle;">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                <line x1="16" y1="2" x2="16" y2="6"></line>
                                <line x1="8" y1="2" x2="8" y2="6"></line>
                                <line x1="3" y1="10" x2="21" y2="10"></line>
                            </svg>
                            Detalhamento
                        </h3>
                        ${todosOsDias.map(dia => {
                            const dataFormatada = dia.data.toLocaleDateString('pt-BR', {
                                weekday: 'short',
                                day: '2-digit',
                                month: '2-digit',
                                year: 'numeric'
                            });

                            if (dia.contado) {
                                return `<div class="dia-item dia-contado">
                                    <span class="dia-numero">${dia.numero}</span>
                                    <span>${dataFormatada}</span>
                                </div>`;
                            } else {
                                return `<div class="dia-item dia-nao-contado">
                                    <span class="dia-numero">X</span>
                                    <span>${dataFormatada} - ${dia.motivo}</span>
                                </div>`;
                            }
                        }).join('')}
                    </div>
                </div>
            `;

            document.getElementById('resultado').innerHTML = html;
            document.getElementById('resultado').style.display = 'block';
        }

        function limparResultado() {
            document.getElementById('resultado').style.display = 'none';
            document.getElementById('btnLimpar').style.display = 'none';
            document.getElementById('descricaoPrazo').value = '';
            dataInicio = null;
            dataFinal = null;
            todosOsDias = [];
            descricaoPrazo = '';
            renderizarCalendario();
        }

        function toggleFeriados(tipo) {
            const btn = document.getElementById('toggle' + tipo.charAt(0).toUpperCase() + tipo.slice(1));

            if (tipo === 'fixos') {
                feriadosFixosAtivos = !feriadosFixosAtivos;
                btn.className = feriadosFixosAtivos ? 'toggle-btn toggle-ativo' : 'toggle-btn toggle-inativo';
                btn.textContent = (feriadosFixosAtivos ? '✓' : '✗') + ' Feriados Nacionais';
            } else if (tipo === 'moveis') {
                feriadosMoveisAtivos = !feriadosMoveisAtivos;
                btn.className = feriadosMoveisAtivos ? 'toggle-btn toggle-ativo' : 'toggle-btn toggle-inativo';
                btn.textContent = (feriadosMoveisAtivos ? '✓' : '✗') + ' Feriados Móveis';
            } else if (tipo === 'personalizados') {
                feriadosPersonalizadosAtivos = !feriadosPersonalizadosAtivos;
                btn.className = feriadosPersonalizadosAtivos ? 'toggle-btn toggle-ativo' : 'toggle-btn toggle-inativo';
                btn.textContent = (feriadosPersonalizadosAtivos ? '✓' : '✗') + ' Feriados Personalizados';
            }

            renderizarCalendario();

            // Mostra aviso se já houver cálculo realizado
            mostrarAvisoRecalculo();
        }

        function alternarVisualizacao(tipo) {
            visualizacaoCalendario = tipo;

            document.getElementById('btnMensal').className = tipo === 'mensal' ? 'active' : '';
            document.getElementById('btnAnual').className = tipo === 'anual' ? 'active' : '';

            renderizarCalendario();
        }

        function mudarMes(direcao) {
            if (visualizacaoCalendario === 'mensal') {
                mesAtual = new Date(mesAtual.getFullYear(), mesAtual.getMonth() + direcao, 1);
            } else {
                mesAtual = new Date(mesAtual.getFullYear() + direcao, 0, 1);
            }
            renderizarCalendario();
        }

        function irParaHoje() {
            mesAtual = new Date();
            renderizarCalendario();
        }

        function toggleConfigFeriados() {
            const content = document.getElementById('configFeriadosContent');
            const icon = document.getElementById('configToggleIcon');

            content.classList.toggle('aberto');
            icon.classList.toggle('aberto');
        }

        function limparFeriadosPersonalizados() {
            if (feriadosPersonalizados.size === 0) {
                alert('⚠️ Não há feriados personalizados para limpar.');
                return;
            }

            const quantidade = feriadosPersonalizados.size;
            if (confirm(`🗑️ Deseja realmente limpar ${quantidade} feriado(s) personalizado(s)?\n\nEsta ação não pode ser desfeita.\n\nA página será recarregada para aplicar as mudanças.`)) {
                feriadosPersonalizados.clear();
                localStorage.setItem('feriadosPersonalizados', JSON.stringify([]));
                alert('✅ Feriados personalizados limpos com sucesso!\n\nA página será recarregada para aplicar as mudanças.');

                // Marca flag para voltar à primeira aba após reload
                sessionStorage.setItem('reloadToTop', 'true');

                // Recarrega a página para aplicar as configurações
                location.reload();
            }
        }

        function renderizarCalendario() {
            if (visualizacaoCalendario === 'mensal') {
                renderizarCalendarioMensal();
            } else {
                renderizarCalendarioAnual();
            }
        }

        function renderizarCalendarioMensal() {
            const ano = mesAtual.getFullYear();
            const mes = mesAtual.getMonth();
            const primeiroDia = new Date(ano, mes, 1);
            const ultimoDia = new Date(ano, mes + 1, 0);
            const diasNoMes = ultimoDia.getDate();
            const diaSemanaInicio = primeiroDia.getDay();

            // Identificar primeiro e último dia percorrido
            const diasPercorridos = todosOsDias.filter(d => d.contado).map(d => formatarDataCompleta(d.data));
            const primeiroDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[0] : null;
            const ultimoDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[diasPercorridos.length - 1] : null;

            document.getElementById('mesAtual').textContent =
                mesAtual.toLocaleDateString('pt-BR', { month: 'long', year: 'numeric' }).toUpperCase();

            let html = ['DOM', 'SEG', 'TER', 'QUA', 'QUI', 'SEX', 'SÁB'].map(dia =>
                `<div class="calendario-dia-semana">${dia}</div>`
            ).join('');

            for (let i = 0; i < diaSemanaInicio; i++) {
                html += '<div></div>';
            }

            for (let dia = 1; dia <= diasNoMes; dia++) {
                const data = new Date(ano, mes, dia);
                const dataStr = formatarDataCompleta(data);
                const { className, ehFds } = obterClassesDia(data, 'calendario-dia', diasPercorridos, primeiroDiaPercorrido, ultimoDiaPercorrido);
                const onclick = ehFds ? '' : `onclick="toggleDia('${dataStr}')"`;
                html += `<div class="${className}" ${onclick}>${dia}</div>`;
            }

            document.getElementById('calendarioGrid').innerHTML = html;
            document.getElementById('calendarioGrid').className = 'calendario-grid';
        }

        function renderizarCalendarioAnual() {
            const ano = mesAtual.getFullYear();

            // Identificar primeiro e último dia percorrido
            const diasPercorridos = todosOsDias.filter(d => d.contado).map(d => formatarDataCompleta(d.data));
            const primeiroDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[0] : null;
            const ultimoDiaPercorrido = diasPercorridos.length > 0 ? diasPercorridos[diasPercorridos.length - 1] : null;

            document.getElementById('mesAtual').textContent = ano.toString();

            let html = '';

            for (let mes = 0; mes < 12; mes++) {
                const primeiroDia = new Date(ano, mes, 1);
                const ultimoDia = new Date(ano, mes + 1, 0);
                const diasNoMes = ultimoDia.getDate();
                const diaSemanaInicio = primeiroDia.getDay();

                const nomeMes = new Date(ano, mes, 1).toLocaleDateString('pt-BR', { month: 'long' });

                html += `<div class="mes-mini">`;
                html += `<h4>${nomeMes.toUpperCase()}</h4>`;
                html += `<div class="calendario-mini-grid">`;

                // Dias da semana
                ['D', 'S', 'T', 'Q', 'Q', 'S', 'S'].forEach(dia => {
                    html += `<div class="calendario-mini-dia-semana">${dia}</div>`;
                });

                // Espaços vazios antes do primeiro dia
                for (let i = 0; i < diaSemanaInicio; i++) {
                    html += '<div></div>';
                }

                // Dias do mês
                for (let dia = 1; dia <= diasNoMes; dia++) {
                    const data = new Date(ano, mes, dia);
                    const dataStr = formatarDataCompleta(data);
                    const { className, ehFds } = obterClassesDia(data, 'calendario-mini-dia', diasPercorridos, primeiroDiaPercorrido, ultimoDiaPercorrido);
                    const onclick = ehFds ? '' : `onclick="toggleDia('${dataStr}')"`;
                    html += `<div class="${className}" ${onclick}>${dia}</div>`;
                }

                html += `</div></div>`;
            }

            document.getElementById('calendarioGrid').innerHTML = html;
            document.getElementById('calendarioGrid').className = 'calendario-anual';
        }

        function toggleDia(dataStr) {
            if (feriadosPersonalizados.has(dataStr)) {
                feriadosPersonalizados.delete(dataStr);
            } else {
                // Adiciona sem nome (usuário pode editar depois na aba 2)
                feriadosPersonalizados.set(dataStr, '');
            }

            // Salva no formato novo: array de objetos {data, nome}
            const dadosParaSalvar = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                data,
                nome: nome || ''
            }));
            localStorage.setItem('feriadosPersonalizados', JSON.stringify(dadosParaSalvar));
            renderizarCalendario();

            // Mostra aviso se já houver cálculo realizado
            mostrarAvisoRecalculo();
        }

        function exportarFeriados() {
            // Solicita nome personalizado para o arquivo
            const nomePersonalizado = prompt('Digite um nome para o arquivo (sem extensão):\n\nDeixe em branco para usar o nome padrão.', '');

            // Se usuário cancelar, interrompe a exportação
            if (nomePersonalizado === null) {
                return;
            }

            // Converte feriados personalizados para formato brasileiro DD-MM-YYYY Nome
            const feriadosBrasileiro = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => {
                const [ano, mes, dia] = data.split('-');
                const dataFormatada = `${dia}-${mes}-${ano}`;
                // Se tiver nome, inclui; senão, só a data
                return nome ? `${dataFormatada} ${nome}` : dataFormatada;
            });

            const config = {
                feriadosPersonalizados: feriadosBrasileiro,
                dataExportacao: new Date().toISOString()
            };

            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;

            // Usa nome personalizado ou padrão
            const nomeArquivo = nomePersonalizado.trim() ?
                `${nomePersonalizado.trim()}.json` :
                `feriados-${Date.now()}.json`;
            link.download = nomeArquivo;

            link.click();
            URL.revokeObjectURL(url);
        }

        function importarFeriados(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const config = JSON.parse(e.target.result);
                    configImportacaoPendente = config;
                    document.getElementById('modalImportar').classList.add('active');
                } catch (error) {
                    alert('❌ Erro ao importar configuração. Verifique o arquivo.');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function finalizarImportacao(tipo) {
            if (!configImportacaoPendente) return;

            // Converte datas do formato brasileiro DD-MM-YYYY Nome para formato interno {data: YYYY-MM-DD, nome: Nome}
            // Também aceita formatos antigos para retrocompatibilidade
            const converterParaInterno = (datas) => {
                return datas.map(item => {
                    // Se for string, pode ser "DD-MM-YYYY Nome" ou só "DD-MM-YYYY"
                    if (typeof item === 'string') {
                        // Tenta extrair data e nome usando regex
                        // Formato esperado: DD-MM-YYYY seguido opcionalmente por espaço e nome
                        const matchComNome = item.match(/^(\d{2})-(\d{2})-(\d{4})\s+(.+)$/);
                        const matchSemNome = item.match(/^(\d{2})-(\d{2})-(\d{4})$/);

                        if (matchComNome) {
                            // Formato: DD-MM-YYYY Nome
                            const [, dia, mes, ano, nome] = matchComNome;
                            return {
                                data: `${ano}-${mes}-${dia}`,
                                nome: nome.trim()
                            };
                        } else if (matchSemNome) {
                            // Formato: DD-MM-YYYY (sem nome)
                            const [, dia, mes, ano] = matchSemNome;
                            return {
                                data: `${ano}-${mes}-${dia}`,
                                nome: ''
                            };
                        } else {
                            // Tenta formato YYYY-MM-DD (retrocompatibilidade)
                            const matchYMD = item.match(/^(\d{4})-(\d{2})-(\d{2})$/);
                            if (matchYMD) {
                                return {
                                    data: item,
                                    nome: ''
                                };
                            }
                        }
                    }

                    // Formato já convertido: retorna como está
                    return item;
                });
            };

            const dadosConvertidos = converterParaInterno(configImportacaoPendente.feriadosPersonalizados);
            const quantidade = dadosConvertidos.length;

            if (tipo === 'substituir') {
                feriadosPersonalizados.clear();
                dadosConvertidos.forEach(item => {
                    if (item && item.data) {
                        feriadosPersonalizados.set(item.data, item.nome || '');
                    }
                });
                alert(`✅ Feriados substituídos com sucesso!\n\n${quantidade} data(s) importada(s).\n\nA página será recarregada para aplicar as mudanças.`);
            } else if (tipo === 'mesclar') {
                dadosConvertidos.forEach(item => {
                    if (item && item.data) {
                        feriadosPersonalizados.set(item.data, item.nome || '');
                    }
                });
                alert(`✅ Feriados mesclados com sucesso!\n\n${quantidade} data(s) importada(s).\n\nA página será recarregada para aplicar as mudanças.`);
            }

            // Salva no formato novo: array de objetos {data, nome}
            const dadosParaSalvar = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                data,
                nome: nome || ''
            }));
            localStorage.setItem('feriadosPersonalizados', JSON.stringify(dadosParaSalvar));
            fecharModal();

            // Marca flag para voltar à primeira aba após reload
            sessionStorage.setItem('reloadToTop', 'true');

            // Recarrega a página para aplicar as configurações
            location.reload();
        }

        function fecharModal() {
            document.getElementById('modalImportar').classList.remove('active');
            configImportacaoPendente = null;
        }

        // ==================== IMPORTAÇÃO DE CONJUNTOS PRÉ-DEFINIDOS ====================

        // Constantes
        const GITHUB_RAW_BASE_URL = 'https://raw.githubusercontent.com/italoanfreitas-ui/contaprazo/main/feriados-predefinidos';

        // Funções auxiliares
        function adicionarCacheBusting(url) {
            const timestamp = new Date().getTime();
            const separator = url.includes('?') ? '&' : '?';
            return `${url}${separator}t=${timestamp}`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function mostrarMensagemLoading(elemento, mensagem) {
            elemento.innerHTML = `<div style="text-align: center; padding: 20px; color: #6b7280;">${escapeHtml(mensagem)}</div>`;
        }

        function mostrarMensagemErro(elemento, mensagem) {
            elemento.innerHTML = `<div style="text-align: center; padding: 20px; color: #ef4444;">❌ ${escapeHtml(mensagem)}</div>`;
        }

        // Funções principais
        function abrirModalSelecionarFonte() {
            document.getElementById('modalSelecionarFonte').classList.add('active');
        }

        function fecharModalSelecionarFonte() {
            document.getElementById('modalSelecionarFonte').classList.remove('active');
        }

        function escolherArquivoLocal() {
            fecharModalSelecionarFonte();
            document.getElementById('importarFeriados').click();
        }

        async function abrirDropdownPredefinidos() {
            fecharModalSelecionarFonte();
            document.getElementById('modalPredefinidos').classList.add('active');

            const listaPredefinidos = document.getElementById('listaPredefinidos');
            mostrarMensagemLoading(listaPredefinidos, 'Carregando conjuntos disponíveis...');

            try {
                // Busca manifest.json com cache-busting
                const manifestUrl = adicionarCacheBusting(`${GITHUB_RAW_BASE_URL}/manifest.json`);
                const response = await fetch(manifestUrl);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const manifest = await response.json();

                if (!manifest.conjuntos || manifest.conjuntos.length === 0) {
                    mostrarMensagemLoading(listaPredefinidos, 'Nenhum conjunto disponível no momento.');
                    return;
                }

                // Renderiza os itens usando map().join() (mais eficiente que +=)
                const html = manifest.conjuntos.map(conjunto => {
                    const urlArquivo = `${GITHUB_RAW_BASE_URL}/${conjunto.arquivo}`;
                    return `
                        <div class="item-predefinido" data-url="${escapeHtml(urlArquivo)}" data-nome="${escapeHtml(conjunto.nome)}">
                            <div class="item-predefinido-nome">${escapeHtml(conjunto.nome)}</div>
                            <div class="item-predefinido-desc">${escapeHtml(conjunto.descricao)}</div>
                            <div class="item-predefinido-data">📅 Atualizado em: ${escapeHtml(conjunto.dataAtualizacao)}</div>
                        </div>
                    `;
                }).join('');

                listaPredefinidos.innerHTML = html;

                // Event delegation: adiciona listener único no container
                listaPredefinidos.querySelectorAll('.item-predefinido').forEach(item => {
                    item.addEventListener('click', function() {
                        importarFeriadoPredefinido(this.dataset.url, this.dataset.nome);
                    });
                });

            } catch (error) {
                console.error('Erro ao carregar conjuntos pré-definidos:', error);
                mostrarMensagemErro(listaPredefinidos, `Erro ao carregar conjuntos pré-definidos.\nVerifique sua conexão com a internet.`);
            }
        }

        function fecharModalPredefinidos() {
            document.getElementById('modalPredefinidos').classList.remove('active');
            abrirModalSelecionarFonte();
        }

        async function importarFeriadoPredefinido(url, nome) {
            const listaPredefinidos = document.getElementById('listaPredefinidos');
            mostrarMensagemLoading(listaPredefinidos, `⏳ Baixando ${nome}...`);

            try {
                // Busca o JSON com cache-busting
                const urlComCacheBusting = adicionarCacheBusting(url);
                const response = await fetch(urlComCacheBusting);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const config = await response.json();

                // Valida estrutura básica do JSON
                if (!config.feriadosPersonalizados || !Array.isArray(config.feriadosPersonalizados)) {
                    throw new Error('Formato de arquivo inválido');
                }

                // Fecha o modal de pré-definidos e abre o modal de importação
                document.getElementById('modalPredefinidos').classList.remove('active');

                // Define a configuração pendente e abre o modal de substituir/mesclar
                configImportacaoPendente = config;
                document.getElementById('modalImportar').classList.add('active');

            } catch (error) {
                console.error('Erro ao importar conjunto pré-definido:', error);
                mostrarMensagemErro(listaPredefinidos, `Erro ao baixar o conjunto.\nTente novamente mais tarde.`);

                // Volta para a lista após 2 segundos
                setTimeout(() => {
                    abrirDropdownPredefinidos();
                }, 2000);
            }
        }

        function abrirModalExportPDF() {
            if (!dataFinal) {
                alert('Calcule um prazo primeiro para exportar.');
                return;
            }
            document.getElementById('modalExportPDF').classList.add('active');
        }

        function fecharModalExportPDF() {
            document.getElementById('modalExportPDF').classList.remove('active');
        }

        function finalizarExportPDF(tipo) {
            fecharModalExportPDF();
            if (tipo === 'resumido') {
                exportarPDFResumido();
            } else {
                exportarPDFCompleto();
            }
        }

        function abrirModalExportPNG() {
            if (!dataFinal) {
                alert('Calcule um prazo primeiro para exportar.');
                return;
            }
            document.getElementById('modalExportPNG').classList.add('active');
        }

        function fecharModalExportPNG() {
            document.getElementById('modalExportPNG').classList.remove('active');
        }

        function finalizarExportPNG(tipo) {
            fecharModalExportPNG();
            if (tipo === 'resumido') {
                exportarImagemResumo();
            } else {
                exportarImagemCompleta();
            }
        }

        // ==================== FUNÇÕES AUXILIARES PARA EXPORTS ====================

        /**
         * Gera o cabeçalho HTML padronizado para exports PDF/PNG
         * @param {Object} params - Parâmetros do cabeçalho
         * @param {string} params.dataInicioFormatada - Data inicial formatada
         * @param {string} params.dataFinalFormatada - Data final formatada
         * @param {string} params.tipoDias - "Úteis" ou "Corridos"
         * @param {number} params.diasContados - Quantidade de dias contados
         * @param {string} params.descricaoHTML - HTML da descrição (opcional)
         * @param {string} params.conteudoEspecifico - HTML do conteúdo específico (visualização ou lista)
         * @param {string} params.estilosAdicionais - CSS adicional (opcional)
         * @returns {string} HTML completo do documento
         */
        function gerarCabecalhoExportHTML(params) {
            const {
                dataInicioFormatada,
                dataFinalFormatada,
                tipoDias,
                diasContados,
                descricaoHTML = '',
                conteudoEspecifico,
                estilosAdicionais = ''
            } = params;

            return `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cálculo de Prazo - ContaPrazo</title>
    <style>
        body { font-family: system-ui; padding: 30px; max-width: 900px; margin: 0 auto; }
        .brand-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .logo-cp { width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #16a34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 20px; color: white; }
        .brand-title { font-size: 1.8rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .brand-name { display: flex; }
        .brand-conta { color: #3b82f6; }
        .brand-prazo { color: #16a34a; }
        .brand-separator { color: #d1d5db; font-weight: 300; }
        .brand-subtitle { font-size: 0.875rem; color: #6b7280; }
        .header { background: linear-gradient(to right, #f0fdf4, #dbeafe); padding: 30px; border: 4px solid #86efac; border-radius: 12px; margin-bottom: 30px; }
        h1 { color: #1f2937; font-size: 28px; margin-bottom: 25px; border-bottom: 2px solid #d1d5db; padding-bottom: 15px; }
        .info { margin: 15px 0; font-size: 16px; }
        .destaque { color: #15803d; font-size: 20px; font-weight: bold; }
        @media print {
            body { padding: 15px; }
            .no-print { display: none; }
        }
        ${estilosAdicionais}
    </style>
</head>
<body>
    <div class="brand-header">
        <div class="logo-cp">CP</div>
        <div class="brand-title">
            <div class="brand-name">
                <span class="brand-conta">Conta</span><span class="brand-prazo">Prazo</span>
            </div>
            <span class="brand-separator">|</span>
            <span class="brand-subtitle">Calculadora de Prazos</span>
        </div>
    </div>
    <div class="header">
        <h1>Resultado do Cálculo de Prazo</h1>
        ${descricaoHTML}
        <div class="info"><strong>Data de Início:</strong> ${dataInicioFormatada}</div>
        <div class="info"><strong>Dias ${tipoDias} Contados:</strong> ${diasContados} dias</div>
        <div class="info"><strong>Data Final do Prazo:</strong> <span class="destaque">${dataFinalFormatada}</span></div>
    </div>
    ${conteudoEspecifico}
    <div class="no-print" style="text-align: center; margin-top: 30px; padding: 20px; background: #fef3c7; border-radius: 8px;">
        <p style="margin-bottom: 15px;"><strong>📌 Para salvar como PDF:</strong></p>
        <p>Use Ctrl+P (Windows/Linux) ou Cmd+P (Mac) e selecione "Salvar como PDF"</p>
        <button onclick="window.print()" style="margin-top: 15px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
            🖨️ Imprimir / Salvar como PDF
        </button>
    </div>
</body>
</html>`;
        }

        // ==================== FUNÇÕES DE EXPORTAÇÃO ====================

        function exportarPDFResumido() {
            if (!dataFinal) {
                alert('Calcule um prazo primeiro para exportar.');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            // Gerar visualização dos dias
            let diasVisuaisHTML = '';
            todosOsDias.forEach((dia, index) => {
                const diaNum = dia.data.getDate();
                const isInicio = index === 0;
                const isFinal = index === todosOsDias.length - 1;

                const ehFds = ehFimDeSemana(dia.data);
                const ehFer = ehFeriado(dia.data);
                const dataStr = `${dia.data.getFullYear()}-${String(dia.data.getMonth() + 1).padStart(2, '0')}-${String(dia.data.getDate()).padStart(2, '0')}`;
                const ehPersonalizado = feriadosPersonalizados.has(dataStr);

                let cor = '#fef3c7';
                let borda = '1px solid #fbbf24';
                let textoCor = '#92400e';

                if (isInicio) {
                    cor = '#3b82f6';
                    borda = '2px solid #2563eb';
                    textoCor = '#ffffff';
                } else if (isFinal) {
                    cor = '#16a34a';
                    borda = '2px solid #15803d';
                    textoCor = '#ffffff';
                } else if (usarDiasUteis) {
                    if (ehPersonalizado) {
                        cor = '#e9d5ff';
                        borda = '1px solid #c084fc';
                        textoCor = '#6b21a8';
                    } else if (ehFer) {
                        cor = '#fecaca';
                        borda = '1px solid #f87171';
                        textoCor = '#991b1b';
                    } else if (ehFds) {
                        cor = '#e5e7eb';
                        borda = '1px solid #d1d5db';
                        textoCor = '#6b7280';
                    }
                }

                let mesIndicador = '';
                if (index === 0 || dia.data.getMonth() !== todosOsDias[index - 1].data.getMonth()) {
                    const nomeMes = dia.data.toLocaleDateString('pt-BR', { month: 'short' });
                    mesIndicador = `<span style="font-size: 10px; color: #6b7280; font-weight: 600; margin-right: 5px; display: inline-block; text-transform: uppercase;">${nomeMes}</span>`;
                }

                diasVisuaisHTML += `${mesIndicador}<div style="display: inline-block; width: 28px; height: 28px; background: ${cor}; border: ${borda}; border-radius: 4px; text-align: center; line-height: 28px; font-size: 12px; font-weight: 600; color: ${textoCor}; margin: 2px;">${diaNum}</div>`;
            });

            // Conteúdo específico: visualização dos dias com legenda
            const conteudoEspecifico = `
                <div class="info" style="margin-top: 25px; border-top: 2px solid #e5e7eb; padding-top: 20px;">
                    <div style="margin-bottom: 12px;"><strong>Dias considerados:</strong></div>
                    <div style="line-height: 36px; text-align: left;">${diasVisuaisHTML}</div>
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; font-size: 13px; line-height: 24px;">
                        <span style="display: inline-block; width: 14px; height: 14px; background: #3b82f6; border: 1px solid #2563eb; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Início</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #16a34a; border: 1px solid #15803d; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Final</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Dias contados</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #e5e7eb; border: 1px solid #d1d5db; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">FDS</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #fecaca; border: 1px solid #f87171; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Feriado</span>
                        <span style="display: inline-block; width: 14px; height: 14px; background: #e9d5ff; border: 1px solid #c084fc; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span>Personalizado</span>
                    </div>
                </div>
            `;

            // Gerar HTML usando função helper
            const htmlContent = gerarCabecalhoExportHTML({
                dataInicioFormatada,
                dataFinalFormatada,
                tipoDias,
                diasContados: diasUteis,
                descricaoHTML,
                conteudoEspecifico
            });

            const popup = window.open('', '_blank', 'width=900,height=700');
            if (popup) {
                popup.document.write(htmlContent);
                popup.document.close();
                setTimeout(() => {
                    popup.print();
                }, 500);
            } else {
                alert('⚠️ Pop-up bloqueado.\n\nPor favor, permita pop-ups para este site.');
            }
        }

        function exportarPDFCompleto() {
            if (!dataFinal) {
                alert('Calcule um prazo primeiro para exportar.');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            let listaHTML = '';
            todosOsDias.forEach(dia => {
                const dataFormatada = dia.data.toLocaleDateString('pt-BR', {
                    weekday: 'short',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });

                if (dia.contado) {
                    listaHTML += `<div style="padding: 12px; background: #dcfce7; margin: 5px 0; border-left: 4px solid #22c55e; border-radius: 4px; display: flex;">
                        <span style="color: #166534; font-weight: bold; min-width: 40px;">${dia.numero}</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada}</span>
                    </div>`;
                } else {
                    listaHTML += `<div style="padding: 12px; background: #fef2f2; margin: 5px 0; border-left: 4px solid #ef4444; border-radius: 4px; display: flex;">
                        <span style="color: #991b1b; font-weight: bold; min-width: 40px;">X</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada} - ${dia.motivo}</span>
                    </div>`;
                }
            });

            const htmlContent = `<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cálculo de Prazo - ContaPrazo</title>
    <style>
        body { font-family: system-ui; padding: 30px; max-width: 900px; margin: 0 auto; }
        .brand-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
        .logo-cp { width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #16a34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 20px; color: white; }
        .brand-title { font-size: 1.8rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
        .brand-name { display: flex; }
        .brand-conta { color: #3b82f6; }
        .brand-prazo { color: #16a34a; }
        .brand-separator { color: #d1d5db; font-weight: 300; }
        .brand-subtitle { font-size: 0.875rem; color: #6b7280; }
        .header { background: linear-gradient(to right, #f0fdf4, #dbeafe); padding: 30px; border: 4px solid #86efac; border-radius: 12px; margin-bottom: 30px; }
        h1 { color: #1f2937; font-size: 28px; margin-bottom: 25px; border-bottom: 2px solid #d1d5db; padding-bottom: 15px; }
        .info { margin: 15px 0; font-size: 16px; }
        .destaque { color: #15803d; font-size: 20px; font-weight: bold; }
        .secao { margin: 30px 0; padding: 20px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; }
        h3 { color: #374151; font-size: 18px; margin-bottom: 15px; }
        @media print {
            body { padding: 15px; }
            .no-print { display: none; }
        }
    </style>
</head>
<body>
    <div class="brand-header">
        <div class="logo-cp">CP</div>
        <div class="brand-title">
            <div class="brand-name">
                <span class="brand-conta">Conta</span><span class="brand-prazo">Prazo</span>
            </div>
            <span class="brand-separator">|</span>
            <span class="brand-subtitle">Calculadora de Prazos</span>
        </div>
    </div>
    <div class="header">
        <h1>Resultado do Cálculo de Prazo</h1>
        ${descricaoHTML}
        <div class="info"><strong>Data de Início:</strong> ${dataInicioFormatada}</div>
        <div class="info"><strong>Dias ${tipoDias} Contados:</strong> ${diasUteis} dias</div>
        <div class="info"><strong>Data Final do Prazo:</strong> <span class="destaque">${dataFinalFormatada}</span></div>
    </div>
    <div class="secao">
        <h3>Detalhamento</h3>
        ${listaHTML}
    </div>
    <div class="no-print" style="text-align: center; margin-top: 30px; padding: 20px; background: #fef3c7; border-radius: 8px;">
        <p style="margin-bottom: 15px;"><strong>📌 Para salvar como PDF:</strong></p>
        <p>Use Ctrl+P (Windows/Linux) ou Cmd+P (Mac) e selecione "Salvar como PDF"</p>
        <button onclick="window.print()" style="margin-top: 15px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 600;">
            🖨️ Imprimir / Salvar como PDF
        </button>
    </div>
</body>
</html>`;

            const popup = window.open('', '_blank', 'width=900,height=700');
            if (popup) {
                popup.document.write(htmlContent);
                popup.document.close();
                // Auto-invocar impressão após carregar
                setTimeout(() => {
                    popup.print();
                }, 500);
            } else {
                alert('⚠️ Pop-up bloqueado.\n\nPor favor, permita pop-ups para este site ou use os botões de exportar imagem.');
            }
        }

		function sanitizarNomeArquivo(descricao) {
            if (!descricao || descricao.trim() === '') return '';

            // Normaliza e remove acentos/diacríticos
            let nome = descricao
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                // Remove caracteres inválidos em nomes de arquivo
                .replace(/[<>:"/\\|?*]/g, '')
                // Substitui espaços por hífens
                .replace(/\s+/g, '-')
                // Remove hífens duplicados
                .replace(/-+/g, '-')
                // Converte para minúsculas
                .toLowerCase()
                // Limita a 50 caracteres
                .substring(0, 50)
                // Remove hífens no início ou fim
                .replace(/^-|-$/g, '');

            return nome ? `${nome}-` : '';
        }

        function exportarImagemResumo() {
            if (!dataFinal) {
                alert('Calcule um prazo primeiro.');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            // Gerar visualização dos dias considerados
            let diasVisuaisHTML = '';
            todosOsDias.forEach((dia, index) => {
                const diaNum = dia.data.getDate();
                const mes = dia.data.getMonth() + 1;
                const isInicio = index === 0;
                const isFinal = index === todosOsDias.length - 1;

                // Verificar se é feriado, fim de semana ou personalizado usando as funções
                const ehFds = ehFimDeSemana(dia.data);
                const ehFer = ehFeriado(dia.data);
                const dataStr = `${dia.data.getFullYear()}-${String(dia.data.getMonth() + 1).padStart(2, '0')}-${String(dia.data.getDate()).padStart(2, '0')}`;
                const ehPersonalizado = feriadosPersonalizados.has(dataStr);

                let cor = '#fef3c7'; // Padrão: dia contado (amarelo claro)
                let borda = '1px solid #fbbf24';
                let textoCor = '#92400e';

                if (isInicio) {
                    cor = '#3b82f6';
                    borda = '2px solid #2563eb';
                    textoCor = '#ffffff';
                } else if (isFinal) {
                    cor = '#16a34a';
                    borda = '2px solid #15803d';
                    textoCor = '#ffffff';
                } else if (usarDiasUteis) {
                    // No modo dias úteis, diferenciar por tipo de dia
                    if (ehPersonalizado) {
                        cor = '#e9d5ff'; // Feriado personalizado (roxo)
                        borda = '1px solid #c084fc';
                        textoCor = '#6b21a8';
                    } else if (ehFer) {
                        cor = '#fecaca'; // Feriado fixo/móvel (vermelho)
                        borda = '1px solid #f87171';
                        textoCor = '#991b1b';
                    } else if (ehFds) {
                        cor = '#e5e7eb'; // Fim de semana (cinza)
                        borda = '1px solid #d1d5db';
                        textoCor = '#6b7280';
                    }
                }
                // No modo dias corridos, todos os dias contados (exceto início e final) ficam amarelos

                // Adicionar indicador de mudança de mês
                let mesIndicador = '';
                if (index === 0 || dia.data.getMonth() !== todosOsDias[index - 1].data.getMonth()) {
                    const nomeMes = dia.data.toLocaleDateString('pt-BR', { month: 'short' });
                    mesIndicador = `<span style="font-size: 10px; color: #6b7280; font-weight: 600; margin-right: 5px; display: inline-block; text-transform: uppercase;">${nomeMes}</span>`;
                }

                diasVisuaisHTML += `${mesIndicador}<div style="display: inline-block; width: 28px; height: 28px; background: ${cor}; border: ${borda}; border-radius: 4px; text-align: center; line-height: 28px; font-size: 12px; font-weight: 600; color: ${textoCor}; margin: 2px;">${diaNum}</div>`;
            });

            const htmlContent = `
<style>
    .export-wrapper { font-family: system-ui; padding: 30px; max-width: 900px; margin: 0 auto; background: white; }
    .export-wrapper .brand-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .export-wrapper .logo-cp { width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #16a34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 20px; color: white; }
    .export-wrapper .brand-title { font-size: 1.8rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .export-wrapper .brand-name { display: flex; background: transparent !important; }
    .export-wrapper .brand-conta { color: #3b82f6 !important; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-prazo { color: #16a34a !important; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-separator { color: #d1d5db; font-weight: 300; }
    .export-wrapper .brand-subtitle { font-size: 0.875rem; color: #6b7280; }
    .export-wrapper .header { background: linear-gradient(to right, #f0fdf4, #dbeafe); padding: 30px; border: 4px solid #86efac; border-radius: 12px; margin-bottom: 30px; }
    .export-wrapper h1 { color: #1f2937; font-size: 28px; margin: 0 0 25px 0; border-bottom: 2px solid #d1d5db; padding-bottom: 15px; }
    .export-wrapper .info { margin: 15px 0; font-size: 16px; }
    .export-wrapper .destaque { color: #15803d; font-size: 20px; font-weight: bold; }
</style>
<div class="export-wrapper">
    <div class="brand-header">
        <div class="logo-cp">CP</div>
        <div class="brand-title">
            <div class="brand-name">
                <span class="brand-conta" style="background: none; background-color: transparent;">Conta</span><span class="brand-prazo" style="background: none; background-color: transparent;">Prazo</span>
            </div>
            <span class="brand-separator">|</span>
            <span class="brand-subtitle">Calculadora de Prazos</span>
        </div>
    </div>
    <div class="header">
        <h1>Resultado do Cálculo de Prazo</h1>
        ${descricaoHTML}
        <div class="info"><strong>Data de Início:</strong> ${dataInicioFormatada}</div>
        <div class="info"><strong>Dias ${tipoDias} Contados:</strong> ${diasUteis} dias</div>
        <div class="info"><strong>Data Final do Prazo:</strong> <span class="destaque">${dataFinalFormatada}</span></div>
        <div class="info" style="margin-top: 25px; border-top: 2px solid #e5e7eb; padding-top: 20px;">
            <div style="margin-bottom: 12px;"><strong>Dias considerados:</strong></div>
            <div style="line-height: 36px; text-align: left;">${diasVisuaisHTML}</div>
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; font-size: 13px; line-height: 24px;">
                <span style="display: inline-block; width: 14px; height: 14px; background: #3b82f6; border: 1px solid #2563eb; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Início</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #16a34a; border: 1px solid #15803d; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Final</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #fef3c7; border: 1px solid #fbbf24; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Dias contados</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #e5e7eb; border: 1px solid #d1d5db; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">FDS</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #fecaca; border: 1px solid #f87171; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span style="margin-right: 12px;">Feriado</span>
                <span style="display: inline-block; width: 14px; height: 14px; background: #e9d5ff; border: 1px solid #c084fc; border-radius: 3px; margin-right: 4px; vertical-align: middle;"></span><span>Personalizado</span>
            </div>
        </div>
    </div>
</div>`;

            // Criar elemento temporário invisível
            const container = document.createElement('div');
            container.style.position = 'absolute';
            container.style.left = '-9999px';
            container.style.top = '0';
            container.style.width = '900px';
            container.innerHTML = htmlContent;
            document.body.appendChild(container);

            // Usar html2canvas para renderizar
            html2canvas(container, {
                backgroundColor: '#ffffff',
                scale: 2, // Melhor qualidade
                logging: false,
                width: 900
            }).then(canvas => {
                // Remover elemento temporário
                document.body.removeChild(container);

                // Fazer download da imagem
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    const prefixo = sanitizarNomeArquivo(descricaoPrazo);
                    link.download = prefixo ? `${prefixo}contaprazo-resumo.png` : `contaprazo-resumo-${Date.now()}.png`;
                    link.click();
                    URL.revokeObjectURL(url);
                });
            }).catch(error => {
                document.body.removeChild(container);
                console.error('Erro ao gerar imagem:', error);
                alert('Erro ao gerar imagem. Por favor, tente novamente.');
            });
        }

        function exportarImagemCompleta() {
            if (!dataFinal) {
                alert('Calcule um prazo primeiro.');
                return;
            }

            const dataInicioFormatada = new Date(dataInicio + 'T00:00:00').toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const dataFinalFormatada = dataFinal.toLocaleDateString('pt-BR', { dateStyle: 'full' });
            const tipoDias = usarDiasUteis ? 'Úteis' : 'Corridos';

            let descricaoHTML = '';
            if (descricaoPrazo) {
                descricaoHTML = `
                    <div style="margin: 20px 0 30px 0; padding: 15px; background: white; border-left: 4px solid #3b82f6; border-radius: 6px;">
                        <p style="color: #1f2937; font-size: 18px; font-weight: bold; font-style: italic; line-height: 1.6; margin: 0; text-align: left;">${descricaoPrazo}</p>
                    </div>
                `;
            }

            let listaHTML = '';
            todosOsDias.forEach(dia => {
                const dataFormatada = dia.data.toLocaleDateString('pt-BR', {
                    weekday: 'short',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric'
                });

                if (dia.contado) {
                    listaHTML += `<div style="padding: 12px; background: #dcfce7; margin: 5px 0; border-left: 4px solid #22c55e; border-radius: 4px; display: flex;">
                        <span style="color: #166534; font-weight: bold; min-width: 40px;">${dia.numero}</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada}</span>
                    </div>`;
                } else {
                    listaHTML += `<div style="padding: 12px; background: #fef2f2; margin: 5px 0; border-left: 4px solid #ef4444; border-radius: 4px; display: flex;">
                        <span style="color: #991b1b; font-weight: bold; min-width: 40px;">X</span>
                        <span style="color: #1f2937; margin-left: 20px;">${dataFormatada} - ${dia.motivo}</span>
                    </div>`;
                }
            });

            const htmlContent = `
<style>
    .export-wrapper { font-family: system-ui; padding: 30px; max-width: 900px; margin: 0 auto; background: white; }
    .export-wrapper .brand-header { display: flex; align-items: center; gap: 15px; margin-bottom: 25px; }
    .export-wrapper .logo-cp { width: 48px; height: 48px; background: linear-gradient(135deg, #3b82f6, #16a34a); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 20px; color: white; }
    .export-wrapper .brand-title { font-size: 1.8rem; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .export-wrapper .brand-name { display: flex; background: transparent !important; }
    .export-wrapper .brand-conta { color: #3b82f6 !important; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-prazo { color: #16a34a !important; background: transparent !important; background-color: transparent !important; }
    .export-wrapper .brand-separator { color: #d1d5db; font-weight: 300; }
    .export-wrapper .brand-subtitle { font-size: 0.875rem; color: #6b7280; }
    .export-wrapper .header { background: linear-gradient(to right, #f0fdf4, #dbeafe); padding: 30px; border: 4px solid #86efac; border-radius: 12px; margin-bottom: 30px; }
    .export-wrapper h1 { color: #1f2937; font-size: 28px; margin: 0 0 25px 0; border-bottom: 2px solid #d1d5db; padding-bottom: 15px; }
    .export-wrapper .info { margin: 15px 0; font-size: 16px; }
    .export-wrapper .destaque { color: #15803d; font-size: 20px; font-weight: bold; }
    .export-wrapper .secao { margin: 30px 0; padding: 20px; background: #f9fafb; border-radius: 8px; border: 1px solid #e5e7eb; }
    .export-wrapper h3 { color: #374151; font-size: 18px; margin: 0 0 15px 0; }
</style>
<div class="export-wrapper">
    <div class="brand-header">
        <div class="logo-cp">CP</div>
        <div class="brand-title">
            <div class="brand-name">
                <span class="brand-conta" style="background: none; background-color: transparent;">Conta</span><span class="brand-prazo" style="background: none; background-color: transparent;">Prazo</span>
            </div>
            <span class="brand-separator">|</span>
            <span class="brand-subtitle">Calculadora de Prazos</span>
        </div>
    </div>
    <div class="header">
        <h1>Resultado do Cálculo de Prazo</h1>
        ${descricaoHTML}
        <div class="info"><strong>Data de Início:</strong> ${dataInicioFormatada}</div>
        <div class="info"><strong>Dias ${tipoDias} Contados:</strong> ${diasUteis} dias</div>
        <div class="info"><strong>Data Final do Prazo:</strong> <span class="destaque">${dataFinalFormatada}</span></div>
    </div>
    <div class="secao">
        <h3>Detalhamento</h3>
        ${listaHTML}
    </div>
</div>`;

            // Criar elemento temporário invisível
            const container = document.createElement('div');
            container.style.position = 'absolute';
            container.style.left = '-9999px';
            container.style.top = '0';
            container.style.width = '900px';
            container.innerHTML = htmlContent;
            document.body.appendChild(container);

            // Usar html2canvas para renderizar
            html2canvas(container, {
                backgroundColor: '#ffffff',
                scale: 2, // Melhor qualidade
                logging: false,
                width: 900
            }).then(canvas => {
                // Remover elemento temporário
                document.body.removeChild(container);

                // Fazer download da imagem
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    const prefixo = sanitizarNomeArquivo(descricaoPrazo);
                    link.download = prefixo ? `${prefixo}contaprazo-completo.png` : `contaprazo-completo-${Date.now()}.png`;
                    link.click();
                    URL.revokeObjectURL(url);
                });
            }).catch(error => {
                document.body.removeChild(container);
                console.error('Erro ao gerar imagem:', error);
                alert('Erro ao gerar imagem. Por favor, tente novamente.');
            });
        }

        function baixarCalculadora() {
            const htmlCompleto = document.documentElement.outerHTML;
            const blob = new Blob([htmlCompleto], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'contaprazo-calculadora.html';
            link.click();
            URL.revokeObjectURL(url);

            alert('✅ Calculadora baixada com sucesso!\n\nAgora você pode compartilhar este arquivo HTML com outras pessoas. Basta abrir o arquivo em qualquer navegador para usar a calculadora offline.');
        }

        // Polyfill para roundRect (compatibilidade com navegadores antigos)
        if (!CanvasRenderingContext2D.prototype.roundRect) {
            CanvasRenderingContext2D.prototype.roundRect = function(x, y, w, h, r) {
                if (w < 2 * r) r = w / 2;
                if (h < 2 * r) r = h / 2;
                this.beginPath();
                this.moveTo(x + r, y);
                this.arcTo(x + w, y, x + w, y + h, r);
                this.arcTo(x + w, y + h, x, y + h, r);
                this.arcTo(x, y + h, x, y, r);
                this.arcTo(x, y, x + w, y, r);
                this.closePath();
                return this;
            };
        }

        // Função para trocar de página
        function trocarPagina(pagina) {
            // Inicializa cache se necessário
            if (!cacheDom) inicializarCacheDom();

            // Esconder todas as páginas
            cacheDom.paginas.calculo.classList.remove('active');
            cacheDom.paginas.gerenciamento.classList.remove('active');
            cacheDom.paginas.ajuda.classList.remove('active');

            // Remover active de todas as tabs
            Object.values(cacheDom.navTabs).forEach(tab => tab.classList.remove('active'));

            // Mostrar página selecionada e ativar tab
            if (pagina === 'calculo') {
                cacheDom.paginas.calculo.classList.add('active');
                cacheDom.navTabs.calculo.classList.add('active');
            } else if (pagina === 'gerenciamento') {
                cacheDom.paginas.gerenciamento.classList.add('active');
                cacheDom.navTabs.gerenciamento.classList.add('active');
                carregarEditoresFeriados();
            } else if (pagina === 'ajuda') {
                cacheDom.paginas.ajuda.classList.add('active');
                cacheDom.navTabs.ajuda.classList.add('active');
            }
        }

        // Carregar editores de feriados
        function carregarEditoresFeriados() {
            // Carregar feriados fixos no formato brasileiro DD-MM
            let textoFixos = '';
            for (let [data, nome] of Object.entries(feriadosFixos)) {
                textoFixos += `${converterMesDiaParaBrasileiro(data)} ${nome}\n`;
            }
            document.getElementById('editorFeriadosFixos').value = textoFixos.trim();

            // Carregar feriados móveis no formato brasileiro DD-MM-YYYY
            let textoMoveis = '';
            for (let [ano, feriados] of Object.entries(feriadosMoveis)) {
                for (let [data, nome] of Object.entries(feriados)) {
                    textoMoveis += `${converterMesDiaParaBrasileiro(data)}-${ano} ${nome}\n`;
                }
            }
            document.getElementById('editorFeriadosMoveis').value = textoMoveis.trim();

            // Carregar feriados personalizados no formato brasileiro DD-MM-YYYY Nome
            let textoPersonalizados = '';
            const feriadosArray = Array.from(feriadosPersonalizados.entries()).sort((a, b) => a[0].localeCompare(b[0]));
            for (let [data, nome] of feriadosArray) {
                const dataBR = converterParaFormatoBrasileiro(data);
                textoPersonalizados += nome ? `${dataBR} ${nome}\n` : `${dataBR}\n`;
            }
            document.getElementById('editorFeriadosPersonalizados').value = textoPersonalizados.trim();

            // Atualizar visualizações
            atualizarVisualizacaoFeriados();
        }

        // Atualizar visualização de feriados
        function atualizarVisualizacaoFeriados() {
            // Feriados fixos - exibir no formato brasileiro DD-MM
            let htmlFixos = '';
            for (let [data, nome] of Object.entries(feriadosFixos)) {
                const dataBR = converterMesDiaParaBrasileiro(data);
                htmlFixos += `
                    <div class="feriado-item fixo">
                        <span><strong>${dataBR}</strong> - ${nome}</span>
                    </div>
                `;
            }
            document.getElementById('listaFeriadosFixos').innerHTML = htmlFixos || '<p style="color: #6b7280; text-align: center; padding: 20px;">Nenhum feriado fixo configurado</p>';

            // Feriados móveis - exibir no formato brasileiro DD-MM-YYYY
            let htmlMoveis = '';
            for (let [ano, feriados] of Object.entries(feriadosMoveis)) {
                for (let [data, nome] of Object.entries(feriados)) {
                    const dataBR = `${converterMesDiaParaBrasileiro(data)}-${ano}`;
                    htmlMoveis += `
                        <div class="feriado-item movel">
                            <span><strong>${dataBR}</strong> - ${nome}</span>
                        </div>
                    `;
                }
            }
            document.getElementById('listaFeriadosMoveis').innerHTML = htmlMoveis || '<p style="color: #6b7280; text-align: center; padding: 20px;">Nenhum feriado móvel configurado</p>';

            // Feriados personalizados - exibir no formato brasileiro DD-MM-YYYY Nome
            let htmlPersonalizados = '';
            const feriadosArray = Array.from(feriadosPersonalizados.entries()).sort((a, b) => a[0].localeCompare(b[0]));
            for (let [data, nome] of feriadosArray) {
                const dataBR = converterParaFormatoBrasileiro(data);
                const conteudo = nome ? `<strong>${dataBR}</strong> - ${nome}` : `<strong>${dataBR}</strong>`;
                htmlPersonalizados += `
                    <div class="feriado-item personalizado">
                        <span>${conteudo}</span>
                    </div>
                `;
            }
            document.getElementById('listaFeriadosPersonalizados').innerHTML = htmlPersonalizados || '<p style="color: #6b7280; text-align: center; padding: 20px;">Nenhum feriado personalizado configurado</p>';
        }

        // Salvar feriados personalizados do editor
        function salvarFeriadosPersonalizadosEditor() {
            try {
                const texto = document.getElementById('editorFeriadosPersonalizados').value;
                const novosFeriados = new Map();

                if (texto.trim()) {
                    const linhas = texto.split('\n');
                    for (let linha of linhas) {
                        linha = linha.trim();
                        if (!linha) continue;

                        // Aceita formato DD-MM-YYYY Nome ou DD-MM-YYYY
                        const matchComNome = linha.match(/^(\d{2})-(\d{2})-(\d{4})\s+(.+)$/);
                        const matchSemNome = linha.match(/^(\d{2})-(\d{2})-(\d{4})$/);

                        if (matchComNome) {
                            const [, dia, mes, ano, nome] = matchComNome;
                            // Converte para formato interno YYYY-MM-DD
                            novosFeriados.set(`${ano}-${mes}-${dia}`, nome.trim());
                        } else if (matchSemNome) {
                            const [, dia, mes, ano] = matchSemNome;
                            // Converte para formato interno YYYY-MM-DD
                            novosFeriados.set(`${ano}-${mes}-${dia}`, '');
                        } else {
                            throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM-YYYY Nome (nome é opcional)`);
                        }
                    }
                }

                if (confirm(`Deseja salvar ${novosFeriados.size} feriado(s) personalizado(s)?\n\nIsso substituirá todos os feriados personalizados atuais.`)) {
                    feriadosPersonalizados = novosFeriados;

                    // Salva no formato novo: array de objetos {data, nome}
                    const dadosParaSalvar = Array.from(feriadosPersonalizados.entries()).map(([data, nome]) => ({
                        data,
                        nome: nome || ''
                    }));
                    localStorage.setItem('feriadosPersonalizados', JSON.stringify(dadosParaSalvar));

                    atualizarVisualizacaoFeriados();
                    renderizarCalendario();
                    alert('✅ Feriados personalizados salvos com sucesso!');
                    mostrarAvisoRecalculo();
                }
            } catch (error) {
                alert('❌ Erro ao processar os feriados:\n\n' + error.message);
            }
        }

        // Salvar feriados em batch
        function salvarFeriadosBatch() {
            try {
                // Processar feriados fixos
                const textoFixos = document.getElementById('editorFeriadosFixos').value;
                const novosFeriadosFixos = {};

                if (textoFixos.trim()) {
                    const linhasFixos = textoFixos.split('\n');
                    for (let linha of linhasFixos) {
                        linha = linha.trim();
                        if (!linha) continue;

                        // Tenta formato brasileiro DD-MM (preferencial)
                        let match = linha.match(/^(\d{2})-(\d{2})\s+(.+)$/);
                        if (match) {
                            const dia = match[1];
                            const mes = match[2];
                            const nome = match[3];

                            // Valida se é formato brasileiro (dia válido 01-31)
                            const diaNum = parseInt(dia);
                            const mesNum = parseInt(mes);

                            if (diaNum >= 1 && diaNum <= 31 && mesNum >= 1 && mesNum <= 12) {
                                // Formato brasileiro DD-MM - converte para formato interno MM-DD
                                novosFeriadosFixos[`${mes}-${dia}`] = nome;
                            } else if (mesNum >= 1 && mesNum <= 31 && diaNum >= 1 && diaNum <= 12) {
                                // Formato americano MM-DD (retrocompatibilidade)
                                novosFeriadosFixos[`${dia}-${mes}`] = nome;
                            } else {
                                throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM Nome do Feriado`);
                            }
                        } else {
                            throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM Nome do Feriado`);
                        }
                    }
                }

                // Processar feriados móveis
                const textoMoveis = document.getElementById('editorFeriadosMoveis').value;
                const novosFeriadosMoveis = {};

                if (textoMoveis.trim()) {
                    const linhasMoveis = textoMoveis.split('\n');
                    for (let linha of linhasMoveis) {
                        linha = linha.trim();
                        if (!linha) continue;

                        // Tenta formato brasileiro DD-MM-YYYY
                        let matchBR = linha.match(/^(\d{2})-(\d{2})-(\d{4})\s+(.+)$/);
                        if (matchBR) {
                            const dia = matchBR[1];
                            const mes = matchBR[2];
                            const ano = matchBR[3];
                            const nome = matchBR[4];

                            // Converte para formato interno YYYY-MM-DD (mas armazena como MM-DD no objeto)
                            if (!novosFeriadosMoveis[ano]) {
                                novosFeriadosMoveis[ano] = {};
                            }
                            novosFeriadosMoveis[ano][`${mes}-${dia}`] = nome;
                        } else {
                            // Tenta formato americano YYYY-MM-DD (retrocompatibilidade)
                            let matchUS = linha.match(/^(\d{4})-(\d{2})-(\d{2})\s+(.+)$/);
                            if (matchUS) {
                                const ano = matchUS[1];
                                const mes = matchUS[2];
                                const dia = matchUS[3];
                                const nome = matchUS[4];

                                if (!novosFeriadosMoveis[ano]) {
                                    novosFeriadosMoveis[ano] = {};
                                }
                                novosFeriadosMoveis[ano][`${mes}-${dia}`] = nome;
                            } else {
                                throw new Error(`Formato inválido na linha: "${linha}"\nUse o formato: DD-MM-YYYY Nome do Feriado`);
                            }
                        }
                    }
                }

                // Confirmar antes de salvar
                const totalFixos = Object.keys(novosFeriadosFixos).length;
                const totalMoveis = Object.values(novosFeriadosMoveis).reduce((acc, f) => acc + Object.keys(f).length, 0);

                if (confirm(`Deseja salvar as configurações?\n\n✓ ${totalFixos} feriado(s) fixo(s)\n✓ ${totalMoveis} feriado(s) móvel(is)\n\nIsso substituirá as configurações atuais.`)) {
                    // Atualizar variáveis globais
                    Object.keys(feriadosFixos).forEach(key => delete feriadosFixos[key]);
                    Object.assign(feriadosFixos, novosFeriadosFixos);

                    Object.keys(feriadosMoveis).forEach(key => delete feriadosMoveis[key]);
                    Object.assign(feriadosMoveis, novosFeriadosMoveis);

                    // Salvar no localStorage
                    localStorage.setItem('feriadosFixos', JSON.stringify(feriadosFixos));
                    localStorage.setItem('feriadosMoveis', JSON.stringify(feriadosMoveis));

                    atualizarVisualizacaoFeriados();
                    renderizarCalendario();

                    alert('✅ Configurações salvas com sucesso!\n\nA página será recarregada para aplicar as mudanças.');

                    // Marca flag para voltar à primeira aba após reload
                    sessionStorage.setItem('reloadToTop', 'true');

                    // Recarrega a página para aplicar as configurações
                    location.reload();
                }
            } catch (error) {
                alert('❌ Erro ao processar os feriados:\n\n' + error.message);
            }
        }

        // Resetar feriados para padrão
        function resetarFeriadosPadrao() {
            if (!confirm('🔄 Deseja restaurar os feriados padrão?\n\nIsso irá substituir todas as configurações atuais de feriados fixos e móveis pelos valores padrão do Brasil.\n\nA página será recarregada para aplicar as mudanças.')) {
                return;
            }

            // Feriados fixos padrão do Brasil
            const feriadosFixosPadrao = {
                '01-01': 'Ano Novo',
                '04-21': 'Tiradentes',
                '05-01': 'Dia do Trabalho',
                '09-07': 'Independência',
                '10-12': 'Nossa Senhora Aparecida',
                '11-02': 'Finados',
                '11-15': 'Proclamação da República',
                '11-20': 'Consciência Negra',
                '12-25': 'Natal'
            };

            // Feriados móveis padrão
            const feriadosMoveisPadrao = {
                2025: {
                    '03-03': 'Carnaval (seg)',
                    '03-04': 'Carnaval (ter)',
                    '04-18': 'Sexta-feira Santa',
                    '06-19': 'Corpus Christi'
                },
                2026: {
                    '02-16': 'Carnaval (seg)',
                    '02-17': 'Carnaval (ter)',
                    '04-03': 'Sexta-feira Santa',
                    '06-04': 'Corpus Christi'
                }
            };

            // Atualizar variáveis globais
            Object.keys(feriadosFixos).forEach(key => delete feriadosFixos[key]);
            Object.assign(feriadosFixos, feriadosFixosPadrao);

            Object.keys(feriadosMoveis).forEach(key => delete feriadosMoveis[key]);
            Object.assign(feriadosMoveis, feriadosMoveisPadrao);

            // Salvar no localStorage
            localStorage.setItem('feriadosFixos', JSON.stringify(feriadosFixos));
            localStorage.setItem('feriadosMoveis', JSON.stringify(feriadosMoveis));

            alert('✅ Feriados padrão restaurados com sucesso!\n\nA página será recarregada para aplicar as mudanças.');

            // Marca flag para voltar à primeira aba após reload
            sessionStorage.setItem('reloadToTop', 'true');

            // Recarrega a página para aplicar as configurações
            location.reload();
        }

        // Inicializar
        // Carregar feriados do localStorage se existirem
        const feriadosFixosSalvos = localStorage.getItem('feriadosFixos');
        if (feriadosFixosSalvos) {
            Object.assign(feriadosFixos, JSON.parse(feriadosFixosSalvos));
        }

        const feriadosMoveisSalvos = localStorage.getItem('feriadosMoveis');
        if (feriadosMoveisSalvos) {
            Object.assign(feriadosMoveis, JSON.parse(feriadosMoveisSalvos));
        }

        // Adiciona listeners para mostrar aviso quando modificar parâmetros do cálculo
        document.getElementById('dataInicio').addEventListener('change', function() {
            mostrarAvisoRecalculo();
        });

        document.getElementById('diasUteis').addEventListener('input', function() {
            mostrarAvisoRecalculo();
        });

        renderizarCalendario();

        // Função para scroll suave ao topo
        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Controlar visibilidade do botão scroll to top
        const scrollToTopBtn = document.getElementById('scrollToTopBtn');
        window.addEventListener('scroll', function() {
            if (window.pageYOffset > 300) {
                scrollToTopBtn.classList.add('visible');
            } else {
                scrollToTopBtn.classList.remove('visible');
            }
        });

        // Desabilitar restauração automática de scroll do navegador
        if ('scrollRestoration' in history) {
            history.scrollRestoration = 'manual';
        }

        // Event listener para executar após load completo da página
        window.addEventListener('load', function() {
            // Verifica se deve voltar ao topo após reload
            if (sessionStorage.getItem('reloadToTop') === 'true') {
                sessionStorage.removeItem('reloadToTop');
                // Força scroll ao topo e primeira aba
                setTimeout(() => {
                    window.scrollTo(0, 0);
                    trocarPagina('calculo');
                }, 0);
            }
        });
    </script>

    <!-- Modal de Aviso de Recálculo -->
    <div id="modalAvisoRecalculo" class="modal-aviso">
        <div class="modal-aviso-content">
            <div class="modal-aviso-icon">ℹ️</div>
            <h3>Recálculo Necessário</h3>
            <p>Você modificou os parâmetros do cálculo. Para ver o resultado atualizado, clique no botão <strong>"Calcular Prazo"</strong> novamente.</p>
            <div class="modal-aviso-checkbox">
                <label>
                    <input type="checkbox" id="naoMostrarAvisoNovamente">
                    Não mostrar este aviso novamente
                </label>
            </div>
            <button class="btn btn-primary" onclick="fecharAvisoRecalculo()">Entendi</button>
        </div>
    </div>

    <!-- Modal de Confirmação de Reset -->
    <div id="modalResetCompleto" class="modal-aviso">
        <div class="modal-aviso-content" style="max-width: 500px;">
            <div class="modal-aviso-icon">⚠️</div>
            <h3>Restaurar Configurações Padrão</h3>
            <p style="text-align: left; margin-bottom: 20px;">
                Esta ação irá <strong>restaurar todas as configurações</strong> para os valores originais:
            </p>
            <ul style="text-align: left; margin: 0 0 20px 20px; color: #374151; line-height: 1.8;">
                <li>Todos os <strong>feriados personalizados</strong> serão removidos</li>
                <li>Feriados <strong>fixos e móveis</strong> voltarão ao padrão</li>
                <li>Preferência de <strong>avisos</strong> será resetada</li>
            </ul>
            <p style="text-align: left; color: #991b1b; font-weight: 600; margin-bottom: 20px;">
                ⚠️ Esta ação não pode ser desfeita!
            </p>
            <div style="display: flex; gap: 10px; justify-content: center;">
                <button class="btn btn-secondary" onclick="fecharModalReset()">Cancelar</button>
                <button class="btn" onclick="executarResetCompleto()" style="background: #dc2626; color: white;">
                    Confirmar Reset
                </button>
            </div>
        </div>
    </div>

</body>
</html>
